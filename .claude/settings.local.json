{
  "permissions": {
    "allow": [
      "Bash(npm test:*)",
      "Bash(ls:*)",
      "Bash(git push:*)",
      "Bash(ln:*)",
      "Bash(python:*)",
      "Bash(node keeps.mjs deploy:*)",
      "Bash(node:*)",
      "Bash(git commit:*)",
      "Bash(curl:*)",
      "Bash(git pull:*)",
      "Bash(git stash:*)",
      "Bash(xxd:*)",
      "Bash(python3:*)",
      "Bash(git mv:*)",
      "WebFetch(domain:api.tzkt.io)",
      "Bash(test:*)",
      "Bash(tr:*)",
      "Bash(npm list:*)",
      "Bash(du:*)",
      "Bash(wc:*)",
      "Bash(npm install:*)",
      "Bash(doctl version:*)",
      "Bash(doctl auth init:*)",
      "Bash(doctl compute droplet list:*)",
      "Bash(doctl compute ssh-key import:*)",
      "Bash(doctl compute droplet get:*)",
      "Bash(ssh:*)",
      "Bash(SSH_KEY=~/.ssh/silo-deploy-key:*)",
      "Bash(DROPLET=root@64.23.151.169:*)",
      "Bash(__NEW_LINE_ab5fea399d263566__ ssh -i $SSH_KEY -o StrictHostKeyChecking=no $DROPLET 'bash -s' << 'FIX_EOF'\nset -e\n\necho \"=== Fix: Install MongoDB 8.0 ===\"\n# Remove bad 7.0 repo\nrm -f /etc/apt/sources.list.d/mongodb-org-7.0.list\n\n# Add MongoDB 8.0 repo \\(has noble support\\)\ncurl -fsSL https://www.mongodb.org/static/pgp/server-8.0.asc | gpg --dearmor -o /usr/share/keyrings/mongodb-server-8.0.gpg\necho \"deb [ signed-by=/usr/share/keyrings/mongodb-server-8.0.gpg ] https://repo.mongodb.org/apt/ubuntu noble/mongodb-org/8.0 multiverse\" > /etc/apt/sources.list.d/mongodb-org-8.0.list\napt-get update -qq\nDEBIAN_FRONTEND=noninteractive apt-get install -y -qq mongodb-org\n\n# Configure MongoDB for 1GB RAM\ncat > /etc/mongod.conf << 'MONGO_CONF'\nstorage:\n  dbPath: /var/lib/mongodb\n  journal:\n    enabled: true\n  wiredTiger:\n    engineConfig:\n      cacheSizeGB: 0.25\nsystemLog:\n  destination: file\n  logAppend: true\n  path: /var/log/mongodb/mongod.log\nnet:\n  port: 27017\n  bindIp: 127.0.0.1\nprocessManagement:\n  timeZoneInfo: /usr/share/zoneinfo\nMONGO_CONF\n\nsystemctl daemon-reload\nsystemctl enable mongod\nsystemctl start mongod\nsleep 2\nmongosh --eval \"db.version\\(\\)\" --quiet\n\necho \"=== Install Caddy ===\"\napt-get install -y -qq debian-keyring debian-archive-keyring apt-transport-https\ncurl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/gpg.key' | gpg --dearmor -o /usr/share/keyrings/caddy-stable-archive-keyring.gpg\ncurl -1sLf 'https://dl.cloudsmith.io/public/caddy/stable/debian.deb.txt' > /etc/apt/sources.list.d/caddy-stable.list\napt-get update -qq\nDEBIAN_FRONTEND=noninteractive apt-get install -y -qq caddy\n\necho \"=== Create silo user + dirs ===\"\nuseradd -m -s /bin/bash silo 2>/dev/null || true\nmkdir -p /opt/silo /var/log/silo /tmp/silo-import\nchown -R silo:silo /opt/silo /var/log/silo\n\necho \"=== Versions ===\"\nnode --version\nmongod --version | head -1\ncaddy version\necho \"=== SETUP COMPLETE ===\"\nFIX_EOF)",
      "Bash(__NEW_LINE_756fdad02b32e713__ ssh -i $SSH_KEY $DROPLET 'bash -s' << 'CHECK_EOF'\n# Check MongoDB\nsleep 5\nsystemctl status mongod --no-pager | head -10\necho \"---\"\nmongosh --eval \"db.version\\(\\)\" --quiet 2>&1\necho \"---\"\n# Check Caddy \\(should have been installed already\\)\ncaddy version 2>/dev/null || echo \"Caddy not installed yet\"\necho \"---\"\nnode --version\nCHECK_EOF)",
      "Bash(__NEW_LINE_313467e14e882a20__ ssh -i $SSH_KEY $DROPLET 'bash -s' << 'SERVICE_EOF'\nset -e\n\necho \"=== Create systemd service ===\"\ncat > /etc/systemd/system/silo.service << 'UNIT'\n[Unit]\nDescription=Silo Data Dashboard for Aesthetic Computer\nAfter=network.target mongod.service\nRequires=mongod.service\n\n[Service]\nType=simple\nUser=silo\nWorkingDirectory=/opt/silo\nEnvironment=NODE_ENV=production\nExecStart=/usr/bin/node /opt/silo/server.mjs\nRestart=always\nRestartSec=10\nStandardOutput=append:/var/log/silo/silo.log\nStandardError=append:/var/log/silo/silo-error.log\n\n[Install]\nWantedBy=multi-user.target\nUNIT\n\necho \"=== Configure Caddy ===\"\ncat > /etc/caddy/Caddyfile << 'CADDY'\n{\n    email me@jas.life\n}\n\nsilo.aesthetic.computer {\n    reverse_proxy localhost:3000\n\n    @websockets {\n        header Connection *Upgrade*\n        header Upgrade websocket\n    }\n    reverse_proxy @websockets localhost:3000\n\n    encode gzip\n\n    log {\n        output file /var/log/caddy/silo.log\n    }\n}\nCADDY\n\necho \"=== Start services ===\"\nsystemctl daemon-reload\nsystemctl enable silo\nsystemctl restart silo\nsleep 3\nsystemctl status silo --no-pager | head -8\necho \"---\"\nsystemctl restart caddy\nsleep 2\nsystemctl status caddy --no-pager | head -8\necho \"=== DONE ===\"\nSERVICE_EOF)",
      "Bash(# Test all silo endpoints echo \"\"=== Health ===\"\" curl -sk https://silo.aesthetic.computer/health 2>&1 echo \"\"\"\" echo \"\"=== Auth Config \\(public\\) ===\"\" curl -sk https://silo.aesthetic.computer/auth/config 2>&1 echo \"\"\"\" echo \"\"=== API Overview \\(should return 401 - requires auth\\) ===\"\" curl -sk https://silo.aesthetic.computer/api/overview -w \"\"\\\\nHTTP %{http_code}\"\" 2>&1 echo \"\"\"\" echo \"\"=== Dashboard HTML ===\"\" curl -sk https://silo.aesthetic.computer/ -o /dev/null -w \"\"HTTP %{http_code}, %{size_download} bytes\"\" 2>&1 echo \"\"\"\" echo \"\"=== SSL cert ===\"\" echo | openssl s_client -connect silo.aesthetic.computer:443 -servername silo.aesthetic.computer)",
      "Bash(openssl s_client:*)",
      "Bash(scp:*)",
      "Bash(git restore:*)",
      "Read(//usr/lib/**)",
      "Read(//etc/pki/ca-trust/source/anchors/**)",
      "Bash(fish:*)",
      "Bash(env nogreet=true fish:*)",
      "Bash(echo:*)",
      "Bash(bash -c 'env nogreet=true fish ./ssl-install.fish --install-only 2>&1; echo \"\"Exit code: $?\"\"')",
      "Bash(sudo cp:*)",
      "Bash(sudo update-ca-trust:*)",
      "Bash(bash -c 'fish ./ssl-install.fish --install-only 2>&1; echo \"\"Exit: $?\"\"')",
      "Read(//home/me/.config/fish/**)",
      "Bash(/usr/bin/fish -c 'pwd')",
      "Bash(/usr/bin/fish:*)",
      "Bash(git checkout:*)",
      "Bash(git log:*)"
    ],
    "additionalDirectories": [
      "/home/me/.claude",
      "/tmp"
    ]
  }
}
