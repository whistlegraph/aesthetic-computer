<!DOCTYPE html>
<html>
<head>
  <title>give ¬∑ Aesthetic Computer</title>
  <meta name="description" content="Support Aesthetic Computer / St√∏t Aesthetic Computer" />
  <link rel="icon" href="https://aesthetic.computer/purple-pals.svg" type="image/svg+xml" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Social sharing meta tags -->
  <meta property="og:title" content="give ¬∑ Aesthetic Computer" />
  <meta property="og:description" content="" />
  <meta property="og:image" content="https://assets.aesthetic.computer/give-og.png?v=3" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:video" content="https://assets.aesthetic.computer/give-og.mp4?v=3" />
  <meta property="og:video:type" content="video/mp4" />
  <meta property="og:video:width" content="1200" />
  <meta property="og:video:height" content="630" />
  <meta property="og:url" content="https://give.aesthetic.computer" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="give ¬∑ Aesthetic Computer" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:image" content="https://assets.aesthetic.computer/give-og.gif" />
  <meta name="twitter:site" content="@aestheticco_mp" />
  
  <!-- Fonts -->
  <link rel="stylesheet" href="https://aesthetic.computer/type/webfonts/ywft-processing-regular.css">
  <link rel="stylesheet" href="https://aesthetic.computer/type/webfonts/berkeley-mono-variable.css">
  
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
  <script src="https://cdn.auth0.com/js/auth0-spa-js/2.0/auth0-spa-js.production.js"></script>
  <!--
    TODO: Give Page Improvements (2026.01.03)
    =========================================
    [x] 1. Shop module: Show multiple images per product before switching to next product
        - Cycle through all product images with a faster interval (2.5s)
        - Only switch to next product after showing all images
        - Added image counter dots indicator
    
    [x] 2. Shop module: Product descriptions - support newlines and proper spacing
        - Added white-space: pre-line for newline support
        - Increased line-height to 1.6 and margin
        - Increased truncation limit to 150 chars
    
    [x] 3. SOLD badges: Change from pink to red/white in red box
        - Background: #d32f2f (red)
        - Text: white
        - Style: bold badge with padding and border-radius
    
    [x] 4. KidLisp panel links: Change from aesthetic.computer/$code to kidlisp.com/$code
        - Updated pieceUrl generation
        - Updated QR code URL generation
    
    All tasks completed! üéâ
  -->
  <style>
    /* Dark mode only */
    :root {
      --bg: #1a1a2e;
      --text: #e8e8e8;
      --dim: #888;
      --pink: #ff6b9d;
      --cyan: #4ecdc4;
      --gold: #ffd93d;
      --green: #6bcb77;
      --box-bg: rgba(255,255,255,0.03);
      --box-border: rgba(255,255,255,0.1);
      --mono: 'Berkeley Mono Variable', 'Menlo', monospace;
    }

    * { box-sizing: border-box; }

    html {
      overflow-x: hidden;
    }

    body {
      font-family: var(--mono);
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 2em;
      min-height: 100vh;
      font-size: 14px;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* Top bar with logo and language chooser */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      max-width: 100vw;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      z-index: 1000;
      background: var(--bg);
    }

    /* Simple gift label */
    .logo {
      font-size: 18px;
      cursor: pointer;
      user-select: none;
    }

    .logo:hover {
      opacity: 0.8;
    }

    .logo-give {
      font-family: var(--mono);
      font-weight: 500;
      color: var(--text);
    }

    .logo-ac {
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 1.15em;
      color: var(--pink);
    }

    .logo-dot {
      color: var(--cyan);
    }

    .logo-sep {
      color: var(--dim);
      margin: 0 0.3em;
      font-family: var(--mono);
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding-top: 3.5em;
      overflow: hidden;
    }

    /* Grid layout for wider screens */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr;
      max-width: 100%;
      gap: 1em;
    }

    @media (min-width: 700px) {
      .content-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .content-grid .full-width {
        grid-column: 1 / -1;
      }
    }

    @media (min-width: 1000px) {
      .content-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .content-grid .span-2 {
        grid-column: span 2;
      }
    }

    h1 {
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-weight: normal;
      font-size: 1.8em;
      margin: 0 0 0.5em 0;
      color: var(--text);
      grid-column: 1 / -1;
    }

    h1::before {
      content: "‚ùÑ ";
      opacity: 0.6;
    }

    h1::after {
      content: " ‚ú¶";
      opacity: 0.6;
    }

    h1 .bounce-dot {
      display: inline-block;
      font-weight: 900;
      font-size: 1.1em;
      color: var(--pink);
      animation: dotBounce 1.2s ease-in-out 3;
    }

    @keyframes dotBounce {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-6px) scale(1.2); }
    }

    .holiday-banner {
      font-family: var(--mono);
      font-size: 0.75em;
      color: var(--dim);
      padding: 0.6em;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 3px;
      text-align: center;
      grid-column: 1 / -1;
    }

    .holiday-banner span { color: var(--gold); }

    /* Prose blocks - language-switchable */
    .prose {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 1em 1.2em;
      font-size: 0.9em;
      line-height: 1.7;
    }

    .prose.full-width {
      grid-column: 1 / -1;
    }

    /* Language content visibility - Danish hidden by default */
    /* Exclude dropdown options from language hiding */
    [data-lang="da"]:not(.lang-option):not(.curr-option) { display: none !important; }
    [data-lang="en"]:not(.lang-option):not(.curr-option) { display: block; }
    
    /* When Danish is selected, flip visibility */
    body.lang-da [data-lang="da"]:not(.lang-option):not(.curr-option) { display: block !important; }
    body.lang-da [data-lang="en"]:not(.lang-option):not(.curr-option) { display: none !important; }

    /* Link description spans */
    .link-desc { display: inline; }
    .link-desc[data-lang="da"] { display: none !important; }
    body.lang-da .link-desc[data-lang="da"] { display: inline !important; }
    body.lang-da .link-desc[data-lang="en"] { display: none !important; }

    /* Feature module list items */
    .feature-module li[data-lang="da"] { display: none !important; }
    body.lang-da .feature-module li[data-lang="da"] { display: block !important; }
    body.lang-da .feature-module li[data-lang="en"] { display: none !important; }

    a { color: var(--cyan); text-decoration: none; }
    a:hover { text-decoration: underline; }

    a.handle-link { color: var(--pink); }

    code {
      background: var(--box-bg);
      padding: 0.15em 0.4em;
      border-radius: 2px;
      color: var(--pink);
    }

    code a { color: var(--pink); }

    /* Stats Section */
    .stats-section {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.6em;
      grid-column: 1 / -1;
    }

    @media (min-width: 800px) {
      .stats-section {
        grid-template-columns: repeat(6, 1fr);
      }
    }

    .stat-item {
      text-align: center;
      padding: 0.6em 0.4em;
      background: var(--stat-bg, var(--box-bg));
      border: 1px solid var(--box-border);
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
      user-select: none;
      min-height: 60px;
    }

    #stat-handles { --stat-bg: rgba(100, 200, 255, 0.08); }
    #stat-paintings { --stat-bg: rgba(255, 180, 100, 0.08); }
    #stat-moods { --stat-bg: rgba(255, 120, 180, 0.08); }
    #stat-kidlisp { --stat-bg: rgba(180, 100, 255, 0.08); }
    #stat-commands { --stat-bg: rgba(100, 255, 150, 0.08); }
    #stat-messages { --stat-bg: rgba(255, 220, 100, 0.08); }

    .stat-value {
      font-family: 'YWFTProcessing-Regular', var(--mono);
      font-size: 1.8em;
      color: var(--gold);
      position: relative;
      z-index: 2;
    }

    .stat-label {
      font-size: 0.75em;
      color: var(--dim);
      margin-top: 0.2em;
      position: relative;
      z-index: 2;
    }

    /* Floating items in stat boxes */
    .stat-floaters {
      position: absolute;
      inset: 0;
      overflow: hidden;
      z-index: 1;
      pointer-events: none;
    }

    .stat-floater {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      animation: floatUp var(--float-duration, 12s) linear forwards;
      opacity: 0.35;
    }

    .stat-floater.float-horizontal {
      animation: floatLeft var(--float-duration, 12s) linear forwards;
    }

    .stat-floater.float-horizontal-right {
      animation: floatRight var(--float-duration, 12s) linear forwards;
    }

    .stat-floater img {
      object-fit: contain;
      border-radius: 2px;
      image-rendering: pixelated;
    }

    .stat-floater .floater-code {
      font-family: var(--mono);
      font-size: 0.5em;
      color: var(--dim);
      white-space: nowrap;
    }

    @keyframes floatUp {
      0% {
        bottom: -20px;
      }
      100% {
        bottom: 120%;
      }
    }

    @keyframes floatLeft {
      0% {
        right: -50px;
      }
      100% {
        right: 120%;
      }
    }

    @keyframes floatRight {
      0% {
        left: -80px;
      }
      100% {
        left: 120%;
      }
    }

    /* Gives Feed */
    .recent-gives {
      grid-column: 1 / -1;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 8px;
      padding: 1em;
      overflow: hidden;
    }

    /* Gives Ticker - horizontal scrolling marquee */
    .gives-ticker {
      background: linear-gradient(180deg, rgba(0, 40, 20, 0.4) 0%, rgba(0, 20, 10, 0.5) 100%);
      border: 1px solid rgba(100, 255, 150, 0.2);
      border-radius: 6px;
      margin-bottom: 1em;
      position: relative;
      height: 2.4em;
      overflow: hidden;
    }

    .gives-ticker-track {
      position: absolute;
      top: 0;
      left: 0;
      display: flex;
      align-items: center;
      height: 100%;
      white-space: nowrap;
      animation: ticker-scroll 30s linear infinite;
    }

    @keyframes ticker-scroll {
      0% { transform: translateX(0); }
      100% { transform: translateX(-33.333%); }
    }

    .gives-ticker-item {
      display: inline-flex;
      align-items: center;
      padding: 0 1.5em;
      font-size: 0.85em;
      border-right: 1px solid rgba(100, 255, 150, 0.15);
      gap: 0.35em;
    }

    .gives-ticker-item .got {
      color: var(--cyan);
      font-weight: 500;
    }

    .gives-ticker-item .amount {
      color: var(--green);
      font-weight: bold;
    }

    .gives-ticker-item .time {
      color: var(--dim);
      font-style: italic;
    }

    .gives-ticker-item .note {
      color: var(--gold);
    }

    .gives-ticker-item .sep {
      color: var(--dim);
    }

    /* Monthly/recurring gives - yellow theme */
    .gives-ticker-item.monthly {
      border-right-color: rgba(255, 215, 100, 0.2);
    }

    .gives-ticker-item.monthly .got {
      color: var(--gold);
    }

    .gives-ticker-item.monthly .amount {
      color: var(--gold);
    }

    .gives-ticker-item.monthly .time {
      color: var(--gold);
      opacity: 0.7;
    }

    .gives-ticker-empty {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100%;
      min-height: 2.4em;
      color: var(--dim);
      font-size: 0.9em;
    }
    
    /* CTA as ticker item (scrolling) */
    .gives-ticker-cta-item {
      color: var(--cyan);
      padding: 0 2em !important;
      white-space: nowrap;
    }
    .gives-ticker-cta-item .pink-handle {
      color: var(--pink);
      text-decoration: none;
      padding: 0 0.3em;
    }
    .gives-ticker-cta-item .pink-handle:hover {
      text-decoration: underline;
    }

    .gives-ticker-empty a {
      color: var(--gold);
      text-decoration: none;
      margin-left: 0.3em;
    }

    .gives-ticker-empty a:hover {
      text-decoration: underline;
    }

    /* Hide old gives styles */
    .recent-gives {
      display: none;
    }

    .recent-gives-header {
      display: none;
    }

    .gives-list {
      display: none;
    }

    .give-item {
      display: none;
    }

    .gives-loading {
      text-align: center;
      color: var(--dim);
      font-size: 0.85em;
      padding: 1em;
    }

    /* Module caption - positioned at bottom of content boxes */
    .module-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 0.8em 1em;
      font-size: 0.75em;
      color: var(--dim);
      background: inherit;
      z-index: 2;
    }

    /* Fiat Currency Section */
    .fiat-section {
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 0;
    }

    .fiat-section.full-width {
      grid-column: 1 / -1;
    }

    .fiat-header {
      display: none;
    }

    .fiat-header h2 {
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 1em;
      margin: 0;
      color: var(--cyan);
    }

    /* Language and Currency selectors */
    .selector-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Language dropdown (compact, like kidlisp.com) */
    .lang-selector {
      position: relative;
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 12px;
      user-select: none;
      border-radius: 4px;
      transition: background 0.15s;
    }

    .lang-selector:hover {
      background: var(--box-bg);
    }

    .lang-selector .lang-flag { font-size: 14px; }
    .lang-selector .lang-text { 
      font-size: 12px; 
      color: var(--dim);
      font-weight: 500;
    }
    .lang-selector .lang-arrow { 
      font-size: 8px; 
      color: var(--dim); 
      opacity: 0.6;
      margin-left: 2px;
    }

    .lang-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      background: var(--bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 100;
      min-width: 100px;
      margin-top: 2px;
      display: none;
    }

    .lang-selector.open .lang-dropdown {
      display: block;
    }

    .lang-option {
      padding: 8px 12px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text);
      transition: all 0.15s;
    }

    .lang-option:hover {
      background: rgba(232, 74, 138, 0.1);
      color: var(--pink);
    }

    .lang-option:first-child { border-radius: 4px 4px 0 0; }
    .lang-option:last-child { border-radius: 0 0 4px 4px; }

    /* Currency link selector */
    .currency-links {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-right: calc(max(0px, (100vw - 1200px) / 2));
    }

    .curr-link {
      font-size: 13px;
      color: var(--dim);
      cursor: pointer;
      transition: color 0.15s;
      text-decoration: none;
      font-weight: 500;
    }

    .curr-link:hover {
      color: var(--text);
    }

    .curr-link.active {
      color: var(--pink);
    }

    .curr-link .curr-flag { margin-right: 4px; }

    /* Different active colors per currency */
    .curr-link.active[data-curr="usd"] { color: var(--green); }
    .curr-link.active[data-curr="dkk"] { color: var(--cyan); }
    .curr-link.active[data-curr="crypto"] { color: #a78bfa; }

    @media (max-width: 600px) {
      .currency-links {
        gap: 10px;
      }
      .curr-link {
        font-size: 12px;
      }
      .curr-link .curr-text { display: none; }
      .lang-selector .lang-text { display: none; }
    }

    /* Hide old dropdown styles */
    .dropdown-selector { display: none !important; }
      border: 1px solid var(--box-border);
      border-radius: 4px;
      display: none;
      min-width: 100px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 100;
    }

    .dropdown-selector.open .dropdown-menu {
      display: block;
    }

    .dropdown-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text);
    }

    .dropdown-option:hover {
      background: var(--box-bg);
    }

    .dropdown-option.active {
      color: var(--pink);
      font-weight: bold;
    }

    .currency-pickers {
      width: 100%;
    }

    .currency-picker {
      padding: 0;
    }

    .currency-picker h3 {
      font-family: var(--mono);
      font-size: 0.85em;
      margin: 0 0 0.8em 0;
      color: var(--dim);
    }

    .gift-widget {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .gift-visual {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2em 1em;
      background: linear-gradient(135deg, rgba(205, 92, 155, 0.1) 0%, rgba(0, 255, 255, 0.05) 100%);
      border: 1px solid var(--box-border);
      border-radius: 8px 8px 0 0;
    }

    .gift-logo-wrap {
      position: relative;
      display: inline-block;
    }

    /* Ground/horizon under the pals */
    .gift-logo-wrap::after {
      content: '';
      position: absolute;
      bottom: 2px;
      left: -60px;
      right: -60px;
      height: 2px;
      background: linear-gradient(90deg, transparent 0%, var(--cyan) 15%, var(--cyan) 85%, transparent 100%);
      opacity: 0.6;
      border-radius: 2px;
      box-shadow: 0 1px 0 rgba(0, 255, 255, 0.2);
    }

    /* Solid ground below horizon */
    .gift-logo-wrap::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: -60px;
      right: -60px;
      height: 3px;
      background: linear-gradient(180deg, rgba(0, 255, 255, 0.15) 0%, rgba(0, 255, 255, 0.05) 100%);
      border-radius: 0 0 4px 4px;
    }

    .gift-logo {
      width: 160px;
      height: 160px;
      opacity: 0.7;
      transition: opacity 0.4s ease-out, transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      transform-origin: bottom left;
    }

    .gift-widget:hover .gift-logo:not(.intensity-1):not(.intensity-2):not(.intensity-3):not(.intensity-4) {
      opacity: 1;
      transform: scale(1.05);
    }

    .gift-amount {
      position: absolute;
      /* Positioned at logo's top-right corner */
      top: 0;
      left: 160px;
      transform: translate(-0.5em, -50%);
      transform-origin: bottom left;
      font-family: 'YWFTProcessing-Regular', var(--mono);
      font-size: 1.3em;
      color: var(--gold);
      background: linear-gradient(135deg, #2a5a3a 0%, #1a3a2a 100%);
      border: 2px solid #4a8a5a;
      border-radius: 4px;
      padding: 0.3em 0.6em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
      white-space: nowrap;
      transition: top 0.6s cubic-bezier(0.4, 0, 0.2, 1), left 0.6s cubic-bezier(0.4, 0, 0.2, 1), transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), background 0.4s ease-out, border 0.4s ease-out;
      display: flex;
      gap: 0;
    }

    .gift-amount .wiggle-char {
      display: inline-block;
      transition: color 0.1s;
    }

    /* Logo intensity animations - shrinks like zooming out */
    .gift-logo.intensity-1 {
      animation: logo-pulse 2s ease-in-out infinite;
      transform: scale(0.9);
    }

    .gift-logo.intensity-2 {
      animation: logo-glow 1.5s ease-in-out infinite;
      transform: scale(0.75);
    }

    .gift-logo.intensity-3 {
      animation: logo-rainbow 2s linear infinite, logo-pulse 1s ease-in-out infinite;
      transform: scale(0.6);
    }

    .gift-logo.intensity-4 {
      animation: logo-rainbow 0.8s linear infinite, logo-shake 0.3s ease-in-out infinite;
      transform: scale(0.45);
    }

    @keyframes logo-pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    @keyframes logo-glow {
      0%, 100% { filter: drop-shadow(0 0 5px rgba(255,215,0,0.4)) brightness(1); }
      50% { filter: drop-shadow(0 0 20px rgba(255,215,0,0.8)) brightness(1.3); }
    }

    @keyframes logo-rainbow {
      0% { filter: drop-shadow(0 0 15px #ff6b6b) hue-rotate(0deg); }
      25% { filter: drop-shadow(0 0 15px #ffd93d) hue-rotate(90deg); }
      50% { filter: drop-shadow(0 0 15px #4ecdc4) hue-rotate(180deg); }
      75% { filter: drop-shadow(0 0 15px #9b59b6) hue-rotate(270deg); }
      100% { filter: drop-shadow(0 0 15px #ff6b6b) hue-rotate(360deg); }
    }

    @keyframes logo-shake {
      0%, 100% { transform: scale(0.45) translate(0, 0); }
      20% { transform: scale(0.45) translate(-4px, 3px); }
      40% { transform: scale(0.45) translate(4px, -3px); }
      60% { transform: scale(0.45) translate(-3px, -4px); }
      80% { transform: scale(0.45) translate(3px, 4px); }
    }

    /* Vegas intensity levels for amount */
    @keyframes vegas-pulse {
      0%, 100% { transform: scale(1); filter: brightness(1); }
      50% { transform: scale(1.05); filter: brightness(1.2); }
    }

    @keyframes vegas-glow {
      0%, 100% { box-shadow: 0 0 10px rgba(255,215,0,0.5), 0 2px 8px rgba(0,0,0,0.4); }
      50% { box-shadow: 0 0 25px rgba(255,215,0,0.8), 0 0 40px rgba(255,100,100,0.4), 0 2px 8px rgba(0,0,0,0.4); }
    }

    @keyframes vegas-rainbow {
      0% { border-color: #ff6b6b; box-shadow: 0 0 20px #ff6b6b, 0 0 40px rgba(255,107,107,0.5); }
      16% { border-color: #ffd93d; box-shadow: 0 0 20px #ffd93d, 0 0 40px rgba(255,217,61,0.5); }
      33% { border-color: #6bcb77; box-shadow: 0 0 20px #6bcb77, 0 0 40px rgba(107,203,119,0.5); }
      50% { border-color: #4ecdc4; box-shadow: 0 0 20px #4ecdc4, 0 0 40px rgba(78,205,196,0.5); }
      66% { border-color: #9b59b6; box-shadow: 0 0 20px #9b59b6, 0 0 40px rgba(155,89,182,0.5); }
      83% { border-color: #ff6b9d; box-shadow: 0 0 20px #ff6b9d, 0 0 40px rgba(255,107,157,0.5); }
      100% { border-color: #ff6b6b; box-shadow: 0 0 20px #ff6b6b, 0 0 40px rgba(255,107,107,0.5); }
    }

    @keyframes vegas-shake {
      0%, 100% { transform: translate(-0.5em, -50%) scale(1.6); }
      10%, 30%, 50%, 70%, 90% { transform: translate(calc(-0.5em - 2px), -50%) scale(1.6); }
      20%, 40%, 60%, 80% { transform: translate(calc(-0.5em + 2px), -50%) scale(1.6); }
    }

    .gift-amount.intensity-1 {
      top: 16px;
      left: 144px;
      transform: translate(-0.5em, -50%) scale(1.1);
      background: linear-gradient(135deg, #3a6a4a 0%, #2a5a3a 100%);
      border-color: #5a9a6a;
      animation: vegas-pulse-1 2s ease-in-out infinite;
    }

    .gift-amount.intensity-2 {
      top: 40px;
      left: 120px;
      transform: translate(-0.5em, -50%) scale(1.25);
      color: #ffd700;
      background: linear-gradient(135deg, #4a3a1a 0%, #3a2a0a 100%);
      border-color: #8a7a3a;
      animation: vegas-glow 1.5s ease-in-out infinite;
    }

    .gift-amount.intensity-3 {
      top: 64px;
      left: 96px;
      transform: translate(-0.5em, -50%) scale(1.4);
      color: #fff;
      background: linear-gradient(135deg, #5a2a2a 0%, #4a1a1a 100%);
      animation: vegas-rainbow 2s linear infinite, vegas-pulse-3 1s ease-in-out infinite;
    }

    .gift-amount.intensity-4 {
      top: 88px;
      left: 72px;
      transform: translate(-0.5em, -50%) scale(1.6);
      color: #fff;
      text-shadow: 0 0 10px #fff, 0 0 20px #ffd700;
      background: linear-gradient(135deg, #6a1a3a 0%, #4a0a2a 100%);
      animation: vegas-rainbow 1s linear infinite, vegas-shake 0.5s ease-in-out infinite;
    }

    @keyframes vegas-pulse-1 {
      0%, 100% { transform: translate(-0.5em, -50%) scale(1.1); }
      50% { transform: translate(-0.5em, -50%) scale(1.15); }
    }

    @keyframes vegas-pulse-3 {
      0%, 100% { transform: translate(-0.5em, -50%) scale(1.4); }
      50% { transform: translate(-0.5em, -50%) scale(1.45); }
    }

    /* Flames effect for max monthly ($500/mo) */
    .gift-amount.flames::before {
      content: 'üî•';
      position: absolute;
      top: -1.2em;
      left: 0;
      font-size: 0.8em;
      animation: flame-dance 0.3s ease-in-out infinite alternate;
      filter: drop-shadow(0 0 4px #ff6600);
    }

    .gift-amount.flames::after {
      content: 'üî•';
      position: absolute;
      top: -1.1em;
      right: 0;
      font-size: 0.7em;
      animation: flame-dance 0.25s ease-in-out infinite alternate-reverse;
      filter: drop-shadow(0 0 4px #ff6600);
    }

    @keyframes flame-dance {
      0% { transform: translateY(0) scale(1); opacity: 0.9; }
      100% { transform: translateY(-3px) scale(1.1); opacity: 1; }
    }

    /* Lightning effect for max one-time ($2500) */
    .gift-amount.lightning {
      animation: vegas-rainbow 1s linear infinite, vegas-shake 0.5s ease-in-out infinite, lightning-flash 0.8s ease-in-out infinite;
    }

    @keyframes lightning-flash {
      0%, 89%, 100% { 
        box-shadow: 0 2px 8px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
      }
      90%, 92% { 
        box-shadow: 0 0 30px #fff, 0 0 60px #00ffff, 0 0 90px #fff, inset 0 0 20px rgba(255,255,255,0.5);
      }
      94%, 96% { 
        box-shadow: 0 2px 8px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
      }
      97%, 98% { 
        box-shadow: 0 0 40px #fff, 0 0 80px #ffff00, 0 0 120px #fff, inset 0 0 30px rgba(255,255,255,0.8);
      }
    }

    .gift-amount.lightning.flames::before {
      content: '‚ö°';
      font-size: 1em;
      top: -1.3em;
      animation: lightning-bolt 0.5s ease-in-out infinite;
    }

    .gift-amount.lightning.flames::after {
      content: '‚ö°';
      font-size: 0.9em;
      top: -1.2em;
      animation: lightning-bolt 0.4s ease-in-out infinite reverse;
    }

    @keyframes lightning-bolt {
      0%, 100% { opacity: 0.7; transform: translateY(0) rotate(-5deg); }
      50% { opacity: 1; transform: translateY(-2px) rotate(5deg); }
    }

    /* Currency conversion display - to right of price */
    .gift-conversion {
      position: absolute;
      top: -0.5em;
      right: -7em;
      font-family: 'YWFTProcessing-Regular', var(--mono);
      font-size: 1.1em;
      color: var(--cyan);
      white-space: nowrap;
    }

    .gift-conversion:empty {
      display: none;
    }

    .gift-conversion span {
      margin: 0;
    }

    .gift-controls {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .gift-controls input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 12px;
      background: var(--cyan);
      border-radius: 0 0 8px 8px;
      outline: none;
      cursor: pointer;
      margin: 0;
    }

    .gift-controls input[type="range"] {
      position: relative;
      z-index: 10;
    }

    .gift-controls input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      position: relative;
      z-index: 20;
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .gift-controls input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    /* Slider intensity states */
    .gift-controls input[type="range"].intensity-1 {
      background: linear-gradient(90deg, var(--cyan) 0%, #3dbda8 100%);
    }
    .gift-controls input[type="range"].intensity-1::-webkit-slider-thumb {
      background: #4ecdc4;
      box-shadow: 0 0 8px rgba(78, 205, 196, 0.5);
    }
    .gift-controls input[type="range"].intensity-1::-moz-range-thumb {
      background: #4ecdc4;
      box-shadow: 0 0 8px rgba(78, 205, 196, 0.5);
    }

    .gift-controls input[type="range"].intensity-2 {
      background: linear-gradient(90deg, #4ecdc4 0%, #6bde8a 50%, #a8e063 100%);
    }
    .gift-controls input[type="range"].intensity-2::-webkit-slider-thumb {
      background: #7de88a;
      transform: scale(1.1);
      box-shadow: 0 0 12px rgba(125, 232, 138, 0.6);
    }
    .gift-controls input[type="range"].intensity-2::-moz-range-thumb {
      background: #7de88a;
      transform: scale(1.1);
      box-shadow: 0 0 12px rgba(125, 232, 138, 0.6);
    }

    .gift-controls input[type="range"].intensity-3 {
      background: linear-gradient(90deg, #6bde8a 0%, #ffd93d 50%, #ffb347 100%);
    }
    .gift-controls input[type="range"].intensity-3::-webkit-slider-thumb {
      background: #ffc857;
      transform: scale(1.2);
      box-shadow: 0 0 16px rgba(255, 200, 87, 0.7);
    }
    .gift-controls input[type="range"].intensity-3::-moz-range-thumb {
      background: #ffc857;
      transform: scale(1.2);
      box-shadow: 0 0 16px rgba(255, 200, 87, 0.7);
    }

    .gift-controls input[type="range"].intensity-4 {
      background: linear-gradient(90deg, #ffb347 0%, #ff6b6b 50%, #ff4757 100%);
      animation: sliderPulse 0.5s ease-in-out infinite alternate;
    }
    .gift-controls input[type="range"].intensity-4::-webkit-slider-thumb {
      background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
      transform: scale(1.35);
      box-shadow: 0 0 20px rgba(255, 71, 87, 0.8), 0 0 40px rgba(255, 107, 107, 0.4);
      animation: thumbGlow 0.3s ease-in-out infinite alternate;
    }
    .gift-controls input[type="range"].intensity-4::-moz-range-thumb {
      background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
      transform: scale(1.35);
      box-shadow: 0 0 20px rgba(255, 71, 87, 0.8), 0 0 40px rgba(255, 107, 107, 0.4);
      animation: thumbGlow 0.3s ease-in-out infinite alternate;
    }

    @keyframes sliderPulse {
      from { filter: brightness(1); }
      to { filter: brightness(1.15); }
    }

    @keyframes thumbGlow {
      from { box-shadow: 0 0 20px rgba(255, 71, 87, 0.8), 0 0 40px rgba(255, 107, 107, 0.4); }
      to { box-shadow: 0 0 25px rgba(255, 71, 87, 1), 0 0 50px rgba(255, 107, 107, 0.6); }
    }

    /* Gift mode checkbox (monthly repeat) */
    .gift-monthly-check {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0.8em 0;
      font-size: 0.85em;
      color: var(--gold);
      cursor: pointer;
      user-select: none;
    }

    .gift-monthly-check input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--gold);
      cursor: pointer;
    }

    .gift-monthly-check:hover {
      color: var(--text);
    }

    .gift-monthly-check.checked {
      color: var(--gold);
    }

    /* Monthly mode styling */
    .gift-amount {
      position: absolute;
    }

    /* Tax deductible note next to monthly checkbox */
    .gift-monthly-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
    }

    .tax-note {
      font-size: 0.85em;
      color: var(--dim);
      text-align: right;
    }

    .tax-note .faded {
      opacity: 0.5;
    }

    .tax-note a {
      color: var(--gold);
      text-decoration: none;
    }

    .tax-note a:hover {
      text-decoration: underline;
    }

    /* Bottom row: monthly checkbox left, fiat note right */
    .gift-bottom-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8em 0 0;
    }

    .gift-bottom-row .gift-monthly-check {
      padding: 0;
    }

    .gift-bottom-row .fiat-note {
      font-size: 0.7em;
      color: var(--dim);
      text-align: right;
      margin: 0;
    }

    .gift-btn {
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 1.2em;
      padding: 1em 1.5em;
      background: linear-gradient(180deg, var(--green) 0%, #3a8a4a 100%);
      color: white;
      border: 2px solid #5ab06a;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      transition: all 0.15s;
      font-weight: bold;
      letter-spacing: 0.02em;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.2);
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      margin-top: 0.5em;
    }

    .gift-btn:hover {
      background: linear-gradient(180deg, var(--pink) 0%, #c83a7a 100%);
      border-color: #ff8ab0;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.2);
    }

    .gift-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .gift-btn:disabled {
      opacity: 0.7;
      cursor: wait;
    }

    /* Crypto controls - match fiat layout */
    .crypto-controls {
      display: flex;
      flex-direction: column;
      gap: 0;
      padding: 1em;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-top: none;
      border-radius: 0 0 8px 8px;
    }
    
    /* Compact crypto header with tiny logo */
    .crypto-compact .gift-visual {
      display: none;
    }
    
    .crypto-header {
      display: flex;
      align-items: center;
      gap: 0.5em;
      padding: 0.6em 1em;
      background: linear-gradient(135deg, rgba(106, 74, 138, 0.2) 0%, rgba(0, 255, 255, 0.05) 100%);
      border: 1px solid var(--box-border);
      border-radius: 8px 8px 0 0;
    }
    
    .crypto-logo-tiny {
      width: 24px;
      height: 24px;
    }
    
    .crypto-title {
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 1em;
      color: #a78bfa;
    }
    
    .crypto-compact .crypto-controls {
      border-radius: 0 0 8px 8px;
    }
    
    /* Stacked crypto addresses for all-in-one view */
    .crypto-controls.crypto-all {
      gap: 0.8em;
    }
    
    .crypto-controls.crypto-all .crypto-address {
      padding: 0.8em 1em;
    }
    
    .crypto-controls.crypto-all .crypto-label {
      font-size: 1em;
      margin-bottom: 0.3em;
    }
    
    .crypto-controls.crypto-all .crypto-addr {
      font-size: 0.65em;
    }
    
    .crypto-controls.crypto-all .crypto-copy-hint {
      font-size: 0.75em;
      margin-top: 0.5em;
    }

    .crypto-address {
      background: linear-gradient(135deg, rgba(100, 255, 150, 0.08) 0%, rgba(0, 255, 255, 0.05) 100%);
      border: 2px solid rgba(100, 255, 150, 0.3);
      padding: 1em 1.2em;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .crypto-address::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(100, 255, 150, 0.15), transparent);
      animation: address-shimmer 3s ease-in-out infinite;
    }

    @keyframes address-shimmer {
      0% { left: -100%; }
      50%, 100% { left: 100%; }
    }

    .crypto-address:hover {
      border-color: var(--green);
      background: linear-gradient(135deg, rgba(100, 255, 150, 0.15) 0%, rgba(0, 255, 255, 0.1) 100%);
      transform: scale(1.01);
    }

    .crypto-address:active {
      transform: scale(0.99);
    }

    .crypto-address.copied {
      background: var(--green);
      border-color: var(--green);
    }

    .crypto-address.copied::before {
      animation: none;
    }

    .crypto-address.copied .crypto-label,
    .crypto-address.copied .crypto-addr,
    .crypto-address.copied .crypto-copy-hint {
      color: var(--bg);
    }

    .crypto-label {
      display: block;
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 1.3em;
      color: var(--cyan);
      margin-bottom: 0.5em;
      text-align: center;
    }

    .crypto-addr {
      display: block;
      font-family: var(--mono);
      font-size: 0.75em;
      color: var(--text);
      word-break: break-all;
      text-align: center;
      padding: 0.6em 0.8em;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      user-select: all;
      cursor: text;
    }

    .crypto-copy-hint {
      display: block;
      font-size: 0.85em;
      color: var(--gold);
      margin-top: 0.8em;
      text-align: center;
      font-weight: 500;
    }

    .crypto-address:hover .crypto-copy-hint {
      color: var(--green);
    }

    .crypto-amount {
      background: linear-gradient(135deg, #3a2a5a 0%, #2a1a4a 100%);
      border-color: #6a4a8a;
    }

    .crypto-usd {
      position: absolute;
      bottom: 0.5em;
      right: 0.5em;
      font-family: var(--mono);
      font-size: 0.85em;
      color: var(--gold);
      opacity: 0.9;
    }

    .gift-widget.crypto .gift-visual {
      background: linear-gradient(135deg, rgba(106, 74, 138, 0.2) 0%, rgba(0, 255, 255, 0.05) 100%);
    }

    .crypto-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 12px;
      background: linear-gradient(90deg, var(--pink) 0%, #6a4a8a 100%);
      border-radius: 0;
      outline: none;
      cursor: pointer;
      margin: 0;
      border-left: 1px solid var(--box-border);
      border-right: 1px solid var(--box-border);
    }

    .crypto-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .crypto-slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .crypto-buttons {
      display: flex;
      gap: 0;
    }

    .crypto-send {
      flex: 1;
      border-radius: 0 0 8px 8px;
      background: linear-gradient(135deg, #6a4a8a 0%, #4a2a6a 100%);
    }

    .crypto-send:hover {
      background: linear-gradient(135deg, #8a6aaa 0%, #6a4a8a 100%);
    }

    small {
      display: block;
      font-size: 0.7em;
      color: var(--dim);
      text-align: center;
      grid-column: 1 / -1;
      margin: 0.5em 0;
    }

    hr {
      border: none;
      border-top: 1px dashed var(--box-border);
      grid-column: 1 / -1;
      margin: 0.5em 0;
    }

    .digital-currency {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 1em 1.2em;
    }

    .digital-currency h3 {
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 0.9em;
      margin: 0 0 0.8em 0;
      color: var(--cyan);
    }

    .crypto-row {
      display: flex;
      gap: 1em;
      flex-wrap: wrap;
    }

    .crypto-item {
      flex: 1;
      min-width: 140px;
    }

    .link-block {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 0;
      display: flex;
      flex-direction: column;
      aspect-ratio: 1;
      overflow: hidden;
      position: relative;
    }

    .link-block strong {
      position: sticky;
      top: 0;
      left: 0;
      background: inherit;
      padding: 0.8em 1em;
      color: var(--pink);
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 0.9em;
      z-index: 1;
    }

    .link-block a {
      color: var(--cyan);
      font-family: var(--mono);
      font-size: 0.9em;
      padding: 0 1em;
      flex: 1;
      overflow: auto;
    }

    .link-block .link-desc {
      position: sticky;
      bottom: 0;
      left: 0;
      background: inherit;
      padding: 0.8em 1em;
      font-size: 0.75em;
      color: var(--dim);
      z-index: 1;
    }

    /* Distinct link-block colors */
    .link-block.desktop-section {
      background: linear-gradient(135deg, #2d1b4e 0%, #1a1a2e 100%);
      border-color: #3d2b5e;
    }
    .link-block.desktop-section strong,
    .link-block.desktop-section .link-desc { background: transparent; }

    /* Notepat - musical purple/blue */
    .link-block.notepat-section {
      background: linear-gradient(135deg, #1a1a3e 0%, #2a1a4e 100%);
      border-color: #3a2a5e;
    }
    .link-block.notepat-section strong { color: #a090ff; }
    .link-block.notepat-section strong,
    .link-block.notepat-section .link-desc { background: transparent; }

    /* Invest - announcement ticker style */
    .invest-section {
      background: 
        linear-gradient(135deg, rgba(10, 26, 18, 0.85) 0%, rgba(13, 32, 24, 0.9) 100%),
        url('https://assets.aesthetic.computer/jeffreys/jpg/IMG_4606.jpg');
      background-size: cover, 200%;
      background-position: center;
      border: 1px solid rgba(78, 205, 196, 0.3);
      border-radius: 8px;
      padding: 1.2em 1.5em;
      overflow: visible;
      position: relative;
      aspect-ratio: 1;
    }

    .invest-header {
      display: flex;
      align-items: center;
      gap: 0.4em;
      margin-bottom: 0.8em;
      font-family: var(--mono);
      font-size: 0.9em;
      color: #4ecdc4;
      letter-spacing: 0.05em;
    }

    .invest-content {
      font-family: 'Berkeley Mono Variable', var(--mono);
      font-size: 0.9em;
      line-height: 1.7;
      color: rgba(255, 255, 255, 0.9);
    }

    .invest-content p {
      margin: 0 0 1em 0;
    }

    .invest-content p:last-child {
      margin-bottom: 0;
    }

    .invest-content a {
      color: #4ecdc4;
      text-decoration: none;
      border-bottom: 1px solid rgba(78, 205, 196, 0.4);
      transition: border-color 0.2s, color 0.2s;
    }

    .invest-content a:hover {
      color: #6eeee6;
      border-bottom-color: #6eeee6;
    }

    .invest-content a.handle-link {
      color: var(--pink);
      border-bottom: none;
    }

    .invest-content a.handle-link:hover {
      color: #ff90d0;
    }

    .invest-content .demo-link {
      display: inline-block;
      background: rgba(78, 205, 196, 0.15);
      padding: 0.15em 0.4em;
      border-radius: 4px;
      border-bottom: none;
      font-weight: 600;
      margin: 0 0.1em;
    }

    .invest-content .demo-link:hover {
      background: rgba(78, 205, 196, 0.25);
    }

    .invest-section.blinking {
      animation: invest-blink 0.6s ease-in-out 3;
    }

    @keyframes invest-blink {
      0%, 100% { box-shadow: 0 0 0 0 rgba(78, 205, 196, 0); }
      25%, 75% { box-shadow: 0 0 20px 4px rgba(78, 205, 196, 0.6); }
      50% { box-shadow: 0 0 30px 8px rgba(78, 205, 196, 0.8); }
    }

    /* Invest suggestion styling */
    .invest-suggestion {
      font-size: 0.8em;
      color: var(--gold);
      padding: 0.6em 0.8em;
      margin-top: 0.5em;
      background: rgba(78, 205, 196, 0.15);
      border: 1px solid rgba(78, 205, 196, 0.3);
      border-radius: 4px;
      text-align: center;
    }

    .invest-suggestion a {
      color: #4ecdc4;
      font-weight: bold;
      text-decoration: underline;
    }

    .invest-suggestion a:hover {
      color: #6eeee6;
    }

    /* Apps Flip Card - Desktop/Mobile swivel */
    .apps-flip-container {
      aspect-ratio: 1;
      position: relative;
      perspective: 1200px;
      overflow: hidden;
      border-radius: 8px;
    }

    .apps-flip-face .module-caption {
      position: absolute;
      bottom: 3px; /* Above progress bar */
      left: 0;
      right: 0;
      background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
      color: rgba(255,255,255,0.6);
      padding: 1.5em 0.8em 0.6em;
    }

    .apps-flip-card {
      position: absolute;
      inset: 0;
      transform-style: preserve-3d;
      transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .apps-flip-card.tilt-left {
      transform: rotateY(-8deg);
    }

    .apps-flip-card.tilt-right {
      transform: rotateY(8deg);
    }

    .apps-flip-card.flipped {
      transform: rotateY(180deg);
    }

    .apps-flip-card.flipped.tilt-left {
      transform: rotateY(188deg);
    }

    .apps-flip-card.flipped.tilt-right {
      transform: rotateY(172deg);
    }

    .apps-flip-face {
      position: absolute;
      inset: 0;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: opacity 0.1s ease, filter 0.1s ease;
    }

    .apps-flip-front {
      z-index: 1;
      opacity: 1;
      filter: none;
    }

    .apps-flip-back {
      z-index: 3;
      transform: rotateY(180deg);
      opacity: 0.15;
      filter: blur(2px);
      pointer-events: none;
    }

    .apps-flip-card.flipped .apps-flip-front {
      z-index: 3;
      opacity: 0.15;
      filter: blur(2px);
      pointer-events: none;
    }

    .apps-flip-card.flipped .apps-flip-back {
      z-index: 1;
      opacity: 1;
      filter: none;
      pointer-events: auto;
    }

    .apps-flip-trigger {
      cursor: pointer;
      user-select: none;
    }

    .apps-flip-trigger:hover {
      opacity: 0.85;
    }

    /* Desktop face - grayscale techy */
    .desktop-face {
      background: linear-gradient(135deg, #1e1e1e 0%, #121212 100%);
      border: 1px solid #333;
      padding: 1em;
    }

    .desktop-face-header {
      display: flex;
      align-items: center;
      gap: 0.5em;
      padding-bottom: 0.8em;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 0.8em;
    }

    .face-label {
      font-size: 0.75em;
      color: #888;
      font-family: monospace;
      text-transform: lowercase;
      letter-spacing: 0.05em;
    }

    .desktop-face-header .version-badge {
      font-size: 0.65em;
      color: #6a6;
      background: rgba(100, 170, 100, 0.15);
      padding: 0.15em 0.5em;
      border-radius: 3px;
      margin-left: auto;
      font-family: monospace;
    }

    .desktop-platforms-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      margin-bottom: 0.8em;
    }

    .desktop-platform-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 0.8em 0.4em;
      background: rgba(40, 40, 40, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .desktop-platform-btn:hover {
      background: rgba(60, 60, 60, 0.9);
      border-color: rgba(255, 255, 255, 0.25);
      transform: translateY(-2px);
    }

    .desktop-platform-btn .plat-icon {
      font-size: 1.5em;
      margin-bottom: 0.2em;
    }

    .desktop-platform-btn .plat-name {
      font-size: 0.75em;
      color: var(--text);
      font-weight: bold;
    }

    .desktop-platform-btn .plat-arch {
      font-size: 0.6em;
      color: var(--dim);
    }

    .desktop-platform-btn:hover .plat-name {
      color: #fff;
    }

    .desktop-changelog-box {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
      padding: 0.6em;
      max-height: 80px;
      overflow-y: auto;
      flex: 1;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .desktop-changelog-box::-webkit-scrollbar {
      width: 3px;
    }

    .desktop-changelog-box::-webkit-scrollbar-thumb {
      background: rgba(150, 150, 150, 0.4);
      border-radius: 2px;
    }

    .desktop-changelog-header {
      display: flex;
      justify-content: space-between;
      font-size: 0.7em;
      margin-bottom: 0.3em;
    }

    .desktop-changelog-header strong {
      color: #6a6;
      font-family: monospace;
    }

    .desktop-changelog-header span {
      color: #666;
      font-family: monospace;
    }

    .desktop-changelog-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .desktop-changelog-list li {
      font-size: 0.65em;
      color: #999;
      padding: 0.15em 0;
      padding-left: 0.6em;
      position: relative;
    }

    .desktop-changelog-list li::before {
      content: '‚Ä¢';
      position: absolute;
      left: 0;
      color: #555;
    }

    .desktop-changelog-list li strong {
      color: #aaa;
    }

    .desktop-vscode-link {
      display: flex;
      align-items: center;
      gap: 0.5em;
      background: rgba(30, 30, 30, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      padding: 0.5em 0.8em;
      margin-top: 0.6em;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .desktop-vscode-link:hover {
      border-color: rgba(255, 255, 255, 0.25);
      background: rgba(50, 50, 50, 0.9);
      transform: translateY(-1px);
    }

    .desktop-vscode-link .vscode-icon-img {
      width: 18px;
      height: 18px;
      border-radius: 3px;
    }

    .desktop-vscode-link .vscode-icon {
      font-size: 1.1em;
    }

    .desktop-vscode-link .vscode-label {
      color: #aaa;
      font-weight: 600;
      font-size: 0.85em;
    }

    .desktop-vscode-link .vscode-ver {
      color: #6a6;
      font-size: 0.65em;
      margin-left: auto;
      font-family: monospace;
    }

    .desktop-ableton-link {
      display: flex;
      align-items: center;
      gap: 0.5em;
      background: rgba(30, 30, 30, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 6px;
      padding: 0.4em 0.8em;
      margin-top: 0.4em;
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .desktop-ableton-link:hover {
      border-color: rgba(255, 255, 255, 0.25);
      background: rgba(50, 50, 50, 0.9);
      transform: translateY(-1px);
    }

    .desktop-ableton-link .ableton-icon {
      font-size: 0.9em;
    }

    .desktop-ableton-link .ableton-label {
      color: #aaa;
      font-weight: 600;
      font-size: 0.8em;
    }

    .desktop-ableton-link .ableton-tag {
      color: #888;
      font-size: 0.6em;
      margin-left: auto;
      font-family: monospace;
      background: rgba(255, 255, 255, 0.08);
      padding: 0.15em 0.4em;
      border-radius: 3px;
    }

    /* Mobile face - grayscale techy */
    .mobile-face {
      background: linear-gradient(135deg, #181818 0%, #101010 100%);
      border: 1px solid #2a2a2a;
      padding: 1em;
      display: flex;
      flex-direction: column;
    }

    .mobile-face-header {
      display: flex;
      align-items: center;
      gap: 0.5em;
      padding-bottom: 0.8em;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      margin-bottom: 0.8em;
    }

    .mobile-face-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      gap: 0.8em;
    }

    .mobile-app-icon {
      width: 72px;
      height: 72px;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
    }

    .mobile-app-icon-fallback {
      width: 72px;
      height: 72px;
      border-radius: 16px;
      background: linear-gradient(135deg, #444 0%, #222 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
    }

    .mobile-app-title {
      font-size: 0.85em;
      color: #aaa;
      font-weight: 500;
      text-align: center;
    }

    .mobile-store-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      padding: 0.6em 1.2em;
      background: rgba(30, 30, 30, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 8px;
      color: #ccc;
      text-decoration: none;
      font-size: 0.85em;
      transition: all 0.2s ease;
    }

    .mobile-store-link:hover {
      background: rgba(50, 50, 50, 0.9);
      border-color: rgba(255, 255, 255, 0.3);
      transform: scale(1.02);
      color: #fff;
    }

    .mobile-store-link .store-icon {
      font-size: 1.2em;
    }

    /* VS Code Extension - Simple link block */
    .vscode-section {
      background: linear-gradient(135deg, rgba(0, 122, 204, 0.15) 0%, rgba(0, 80, 150, 0.1) 100%);
      border: 1px solid rgba(0, 122, 204, 0.3);
    }

    .vscode-section strong {
      color: #0078d4;
    }

    .vscode-section .link-desc {
      background: transparent;
    }

    .vscode-features-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4em;
      margin-top: 0.6em;
    }

    .vscode-feature-tag {
      font-size: 0.7em;
      padding: 0.2em 0.5em;
      background: rgba(0, 122, 204, 0.15);
      border: 1px solid rgba(0, 122, 204, 0.25);
      border-radius: 3px;
      color: var(--text);
    }

    .vscode-install-link {
      display: inline-block;
      margin-top: 0.6em;
      padding: 0.4em 0.8em;
      background: #0078d4;
      border-radius: 4px;
      color: #fff;
      text-decoration: none;
      font-size: 0.8em;
      transition: background 0.2s ease;
    }

    .vscode-install-link:hover {
      background: #1a8fe8;
    }

    .feature-module {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 1em 1.2em;
    }

    .feature-module h3 {
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 0.95em;
      margin: 0 0 0.7em 0;
      color: var(--cyan);
    }

    .feature-module ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
    }

    .feature-module li {
      font-size: 0.85em;
      line-height: 1.4;
      padding-left: 0.5em;
      border-left: 2px solid var(--box-border);
    }

    .feature-module li strong {
      color: var(--pink);
    }

    .feature-module li a {
      color: inherit;
      text-decoration: none;
    }

    .feature-module li a:hover {
      text-decoration: underline;
    }

    .feature-module li a strong {
      color: var(--pink);
    }

    .addr {
      font-size: 0.85em;
      background: var(--box-bg);
      padding: 0.3em 0.5em;
      border-radius: 2px;
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      margin-top: 0.2em;
    }

    .addr button {
      font-family: var(--mono);
      font-size: 0.75em;
      padding: 0.2em 0.4em;
      background: transparent;
      border: 1px solid var(--dim);
      color: var(--dim);
      border-radius: 2px;
      cursor: pointer;
    }

    .addr button:hover {
      border-color: var(--cyan);
      color: var(--cyan);
    }

    /* Shop Section - clean white background like shop.aesthetic.computer */
    .shop-section {
      background: #000;
      border: none;
      border-radius: 8px;
      padding: 0;
      color: #1a1a1a;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
      aspect-ratio: 1;
    }

    .shop-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 3;
      background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, transparent 100%);
      padding: 0.8em 1em 2em 1em;
      text-align: left;
    }

    .shop-title {
      font-family: var(--mono);
      font-size: 1.3em;
      font-weight: 600;
      color: #fff;
      text-decoration: none;
      text-shadow: 0 2px 8px rgba(0,0,0,0.8);
    }

    .shop-title:hover {
      color: var(--pink);
    }

    .shop-section .module-caption {
      background: #000;
      color: rgba(255,255,255,0.5);
      font-family: var(--mono);
      z-index: 3;
      position: relative;
    }

    .shop-products {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      overflow: hidden;
    }

    .shop-product {
      display: block;
      width: 100%;
      height: 100%;
      text-decoration: none;
      color: #fff;
      position: relative;
      opacity: 0;
      animation: shopFadeIn 0.5s ease forwards;
    }

    .shop-product-img-wrap {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
    }

    .shop-product img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.15);
      animation: kenBurns 15s ease-in-out infinite alternate;
    }

    @keyframes kenBurns {
      0% { transform: scale(1.15) translate(0, 0); }
      25% { transform: scale(1.25) translate(-3%, -2%); }
      50% { transform: scale(1.2) translate(2%, -3%); }
      75% { transform: scale(1.3) translate(-2%, 2%); }
      100% { transform: scale(1.2) translate(2%, -1%); }
    }

    .shop-product:hover img {
      animation-play-state: paused;
      transform: scale(1.05);
      transition: transform 0.4s ease;
    }

    .shop-product-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, 
        transparent 0%, 
        transparent 50%,
        rgba(0,0,0,0.8) 100%);
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 1em;
      text-align: left;
    }

    .shop-product-top {
      display: inline-flex;
      flex-direction: row;
      align-items: baseline;
      gap: 0.4em;
      flex-wrap: nowrap;
      margin-bottom: 0.3em;
      justify-content: flex-start;
      width: auto;
    }

    .shop-product-title {
      font-family: 'YWFTProcessing-Regular', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 1.2em;
      font-weight: 600;
      color: #fff;
      text-shadow: 0 2px 8px rgba(0,0,0,0.9), 0 1px 2px rgba(0,0,0,1);
      line-height: 1.2;
      white-space: nowrap;
      flex-shrink: 0;
      flex-grow: 0;
    }

    .shop-product-vendor {
      font-family: var(--mono);
      font-size: 0.7em;
      color: var(--pink);
      text-shadow: 0 1px 4px rgba(0,0,0,0.9), 0 0 8px rgba(205, 92, 155, 0.5);
      flex-shrink: 0;
      white-space: nowrap;
      text-align: left;
    }

    .shop-product-vendor a {
      color: var(--pink);
      text-decoration: none;
    }

    .shop-product-vendor a:hover {
      text-decoration: underline;
    }

    .shop-product-info {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      gap: 1em;
    }

    .shop-product-desc {
      font-family: var(--mono);
      font-size: 0.65em;
      color: rgba(255, 255, 255, 0.75);
      line-height: 1.4;
      text-shadow: 0 1px 4px rgba(0,0,0,0.8);
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .shop-product-price {
      font-family: var(--mono);
      font-size: 1.1em;
      color: #fff;
      font-weight: 600;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      white-space: nowrap;
    }

    .shop-product-sold {
      display: inline-block;
      background: #d32f2f;
      color: #fff;
      font-size: 0.85em;
      font-weight: 700;
      text-transform: uppercase;
      padding: 0.25em 0.6em;
      border-radius: 3px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
      white-space: nowrap;
    }

    @keyframes shopFadeIn {
      to { opacity: 1; }
    }

    .shop-loading {
      color: #999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 0.85em;
      text-align: center;
      padding: 2em;
    }

    /* Shop auto-advance progress bar - inside panel */
    .shop-auto-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.15);
      z-index: 15;
      overflow: hidden;
    }

    .shop-auto-progress-bar {
      height: 100%;
      width: 0%;
      background: var(--pink);
      transition: width 0.05s linear;
    }

    /* TV Section - letterbox video feed */
    .tv-section {
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
      aspect-ratio: 1;
    }

    .tv-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 10;
      padding: 0.8em 1em;
      text-decoration: none;
      cursor: pointer;
      background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.4) 60%, transparent 100%);
    }

    .tv-header strong {
      color: #fff;
      font-family: var(--mono);
      font-size: 1.1em;
      text-shadow: 0 2px 8px rgba(0,0,0,0.9), 0 1px 3px rgba(0,0,0,0.8);
    }

    .tv-header:hover strong {
      color: var(--pink);
    }

    .tv-section .module-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 10;
      background: rgba(0,0,0,0.85);
      color: rgba(255,255,255,0.6);
      padding: 0.5em 0.8em;
    }

    .tv-player {
      position: absolute;
      inset: 0;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tv-player video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      background: #000;
    }

    .tv-loading {
      font-size: 2em;
      opacity: 0.3;
      animation: tvPulse 1.5s ease-in-out infinite;
    }

    @keyframes tvPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    .tv-no-signal {
      color: rgba(255,255,255,0.3);
      font-size: 0.8em;
      font-family: var(--mono);
    }

    .tv-progress {
      position: absolute;
      bottom: 2.8em;
      left: 0;
      right: 0;
      height: 44px;
      background: linear-gradient(0deg, rgba(0,0,0,0.6) 0%, rgba(0,0,0,0.3) 70%, transparent 100%);
      z-index: 12;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }

    .tv-progress-bar {
      height: 4px;
      background: #e53935;
      width: 0%;
    }

    .tv-timer {
      position: absolute;
      bottom: calc(2.8em + 10px);
      left: 10px;
      font-family: var(--mono);
      font-size: 1em;
      color: rgba(255,255,255,0.95);
      text-shadow: 0 1px 2px rgba(0,0,0,0.5);
      z-index: 13;
      cursor: pointer;
    }

    .tv-timer:hover {
      color: var(--pink);
    }

    .tv-play-indicator {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 15;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .tv-play-indicator::after {
      content: '';
      display: block;
      width: 0;
      height: 0;
      border-style: solid;
      border-width: 12px 0 12px 20px;
      border-color: transparent transparent transparent rgba(255,255,255,0.9);
      margin-left: 4px;
    }

    .tv-play-indicator.paused {
      opacity: 1;
    }

    .tv-play-indicator.paused::after {
      /* Pause icon - two bars */
      border: none;
      width: 20px;
      height: 24px;
      background: linear-gradient(to right, 
        rgba(255,255,255,0.9) 0%, rgba(255,255,255,0.9) 35%,
        transparent 35%, transparent 65%,
        rgba(255,255,255,0.9) 65%, rgba(255,255,255,0.9) 100%);
      margin-left: 0;
    }

    .tv-slide:hover .tv-play-indicator {
      opacity: 0.7;
    }

    .tv-slide:hover .tv-play-indicator.paused {
      opacity: 1;
    }

    /* Tape slide animation - vertical swipe like TikTok */
    .tv-slide {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tv-slide video {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      background: #000;
    }

    .tv-slide.entering {
      animation: tvSlideIn 0.4s ease-out forwards;
    }

    .tv-slide.exiting {
      animation: tvSlideOut 0.4s ease-out forwards;
    }

    @keyframes tvSlideIn {
      from {
        transform: translateY(100%);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes tvSlideOut {
      from {
        transform: translateY(0);
        opacity: 1;
      }
      to {
        transform: translateY(-100%);
        opacity: 0;
      }
    }

    /* Flip Card System - Desktop App Style (ghost overlay approach) */
    .chat-flip-container {
      aspect-ratio: 1;
      position: relative;
      perspective: 1200px;
      overflow: hidden;
      border-radius: 8px;
    }

    /* The flipping card - this rotates in 3D */
    .chat-flip-card {
      position: absolute;
      inset: 0;
      transform-style: preserve-3d;
      transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Hover tilt effect - subtle swivel preview */
    .chat-flip-card.tilt-left {
      transform: rotateY(-8deg);
    }

    .chat-flip-card.tilt-right {
      transform: rotateY(8deg);
    }

    .chat-flip-card.flipped {
      transform: rotateY(180deg);
    }

    /* Tilt when flipped (reversed direction since we're looking at the back) */
    .chat-flip-card.flipped.tilt-left {
      transform: rotateY(188deg);
    }

    .chat-flip-card.flipped.tilt-right {
      transform: rotateY(172deg);
    }

    /* Both faces positioned together */
    .chat-flip-face {
      position: absolute;
      inset: 0;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: opacity 0.1s ease, filter 0.1s ease;
    }

    /* Front face - laer-klokken - active when NOT flipped */
    .chat-flip-front {
      z-index: 1;
      opacity: 1;
      filter: none;
    }

    /* Back face - chat-system - ghost ON TOP when NOT flipped */
    .chat-flip-back {
      z-index: 3;
      transform: rotateY(180deg); /* Shows mirrored when viewed from front */
      opacity: 0.15;
      filter: blur(2px);
      pointer-events: none;
    }

    /* When FLIPPED: front becomes ghost, back becomes active */
    .chat-flip-card.flipped .chat-flip-front {
      z-index: 3;
      opacity: 0.15;
      filter: blur(2px);
      pointer-events: none;
    }

    .chat-flip-card.flipped .chat-flip-back {
      z-index: 1;
      opacity: 1;
      filter: none;
      pointer-events: auto;
    }

    /* Clickable areas for flip */
    .chat-flip-trigger {
      cursor: pointer;
      user-select: none;
    }

    .chat-flip-trigger:hover {
      opacity: 0.85;
    }

    /* Embedded progress bar inside flip faces */
    .flip-face-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: rgba(0, 0, 0, 0.3);
      overflow: hidden;
      z-index: 10;
    }

    .flip-face-progress-bar {
      height: 100%;
      width: 0%;
      background: var(--gold);
      transition: width 0.1s linear;
    }

    /* Chat flip - gold for laer-klokken, purple for chat */
    .chat-preview .flip-face-progress-bar {
      background: var(--gold);
    }
    
    .chat-preview-system .flip-face-progress-bar {
      background: #8844ff;
    }
    
    /* Apps flip - silvery for both faces */
    .desktop-face .flip-face-progress-bar,
    .mobile-face .flip-face-progress-bar {
      background: linear-gradient(90deg, #666 0%, #888 50%, #aaa 100%);
    }

    /* Chat Rolodex - laer-klokken warm gold theme */
    .chat-preview {
      background: linear-gradient(135deg, #2a2010 0%, #1a1508 100%);
      border: 1px solid #3d3520;
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .chat-preview::-webkit-scrollbar { display: none; }

    .chat-preview-header {
      position: sticky;
      top: 0;
      z-index: 1;
      padding: 0.8em 1em;
      text-decoration: none;
      background: linear-gradient(135deg, #2a2010 0%, #1a1508 100%);
    }

    .chat-preview-header strong {
      color: var(--gold);
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 0.9em;
    }

    .chat-preview-header:hover strong {
      color: #ffe066;
    }

    .chat-preview .module-caption {
      background: linear-gradient(135deg, #2a2010 0%, #1a1508 100%);
      color: #a08050;
    }

    .chat-messages {
      flex: 1;
      overflow: hidden;
      background: #111;
      pointer-events: none;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .chat-messages::-webkit-scrollbar {
      display: none;
    }

    .chat-msg {
      padding: 0.5em 1em;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      animation: chatFadeIn 0.3s ease;
    }

    .chat-msg:last-child {
      border-bottom: none;
    }

    @keyframes chatFadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .chat-msg-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 0.2em;
    }

    .chat-handle {
      font-family: var(--mono);
      font-size: 0.75em;
      color: var(--cyan);
    }

    .chat-handle:hover {
      color: var(--pink);
    }

    .chat-time {
      font-family: var(--mono);
      font-size: 0.6em;
      color: var(--dim);
    }

    .chat-text {
      font-size: 0.8em;
      color: var(--text);
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .chat-text .chat-link-url {
      color: var(--cyan);
      text-decoration: none;
    }

    .chat-text .chat-link-url:hover {
      text-decoration: underline;
    }

    .chat-text .chat-link-handle {
      color: var(--pink);
      text-decoration: none;
    }

    .chat-text .chat-link-handle:hover {
      text-decoration: underline;
    }

    .chat-text .chat-link-prompt {
      color: var(--gold);
      text-decoration: none;
      font-family: var(--mono);
    }

    .chat-text .chat-link-prompt:hover {
      text-decoration: underline;
    }

    .chat-text .chat-link-painting {
      color: #95E1D3;
      text-decoration: none;
    }

    .chat-text .chat-link-painting:hover {
      text-decoration: underline;
    }

    /* Painting thumbnail previews in chat */
    .chat-painting-thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .chat-painting-thumb {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      overflow: hidden;
      background: #1a1a1a;
      position: relative;
    }

    .chat-painting-thumb a {
      display: block;
      width: 100%;
      height: 100%;
    }

    .chat-painting-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .chat-painting-thumb img.loaded {
      opacity: 1;
    }

    .chat-painting-thumb:hover {
      outline: 2px solid var(--cyan);
    }

    .chat-painting-thumb .thumb-code {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      font-family: var(--mono);
      font-size: 0.5em;
      color: #fff;
      background: rgba(0,0,0,0.7);
      padding: 1px 3px;
      text-align: center;
    }

    /* Chat System (back face) - purple theme (lighter) */
    .chat-preview-system {
      background: linear-gradient(135deg, #252540 0%, #1a1230 100%);
      border: 1px solid rgba(160, 100, 255, 0.35);
    }

    .chat-system-header {
      position: sticky;
      top: 0;
      z-index: 1;
      padding: 0.8em 1em;
      text-decoration: none;
      background: linear-gradient(135deg, #252540 0%, #1a1230 100%);
    }

    .chat-system-header strong {
      color: rgba(180, 140, 255, 0.95);
      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 0.9em;
    }

    .chat-system-header:hover strong {
      color: rgba(210, 170, 255, 1);
    }

    .chat-preview-system .module-caption {
      background: linear-gradient(135deg, #252540 0%, #1a1230 100%);
      color: rgba(160, 120, 255, 0.8);
    }

    .chat-preview-system .chat-messages {
      background: rgba(20, 18, 35, 0.9);
    }

    .chat-preview-system .chat-handle {
      color: rgba(180, 140, 255, 0.95);
    }

    .chat-preview-system .chat-handle:hover {
      color: var(--pink);
    }

    /* KidLisp Preview - Full-bleed animated webp like shop */
    .kidlisp-preview {
      background: #0d0d1a;
      border: none;
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .kidlisp-preview-header:hover .kidlisp-logo {
      filter: brightness(1.2);
    }

    .kidlisp-preview .module-caption {
      background: linear-gradient(135deg, rgba(20,10,30,0.85) 0%, rgba(10,5,20,0.9) 100%);
      color: rgba(200,180,255,0.9);
      z-index: 10;
    }

    /* KidLisp auto-advance progress bar */
    .kidlisp-auto-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.15);
      z-index: 15;
      overflow: hidden;
    }

    .kidlisp-auto-progress-bar {
      height: 100%;
      width: 0%;
      background: #AA96DA;
      /* No transition - smooth continuous updates from requestAnimationFrame */
    }

    .kidlisp-preview-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 0.6em 0.8em;
      display: flex;
      align-items: center;
      gap: 0.5em;
      text-decoration: none;
      z-index: 10;
      background: linear-gradient(135deg, rgba(20,10,30,0.85) 0%, rgba(10,5,20,0.8) 100%);
    }

    /* Single rotating KidLisp preview carousel */
    .kidlisp-carousel {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }

    .kidlisp-slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: translateX(30px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      pointer-events: none;
    }

    .kidlisp-slide.active {
      opacity: 1;
      transform: translateX(0);
      pointer-events: auto;
    }

    .kidlisp-slide.exiting {
      opacity: 0;
      transform: translateX(-30px);
    }

    .kidlisp-slide a {
      display: block;
      width: 100%;
      height: 100%;
      position: absolute;
      inset: 0;
    }

    .kidlisp-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      image-rendering: pixelated;
      opacity: 0;
      transition: opacity 0.5s ease;
      transform: scale(1.1);
    }

    .kidlisp-slide img.loaded {
      opacity: 0.5;
    }

    .kidlisp-slide:hover img.loaded {
      opacity: 0.7;
    }

    .kidlisp-slide-code {
      position: absolute;
      top: 4.5em;
      left: 0.8em;
      right: 1em;
      bottom: 4em;
      padding: 0.4em 0.6em;
      font-family: var(--mono);
      font-size: 0.75em;
      line-height: 1.35;
      color: #fff;
      overflow: hidden;
      text-shadow: 0 1px 3px rgba(0,0,0,0.95), 0 0 6px rgba(0,0,0,0.7);
      white-space: pre-wrap;
      word-break: break-word;
      pointer-events: none;
      z-index: 2;
    }

    .kidlisp-slide-plays {
      position: absolute;
      bottom: 4em;
      left: 1em;
      font-family: var(--mono);
      font-size: 0.7em;
      color: var(--gold);
      background: rgba(0,0,0,0.5);
      padding: 0.15em 0.4em;
      border-radius: 3px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.9);
      z-index: 5;
    }

    .kidlisp-slide-author {
      position: absolute;
      bottom: 4em;
      left: 5em;
      font-family: var(--mono);
      font-size: 0.6em;
      color: rgba(255,255,255,0.7);
      background: rgba(0,0,0,0.4);
      padding: 0.15em 0.4em;
      border-radius: 3px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.9);
      z-index: 5;
    }

    .kidlisp-slide-qr-wrap {
      position: absolute;
      bottom: 3.2em;
      right: 1em;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      z-index: 5;
    }

    .kidlisp-slide-label {
      font-family: var(--mono);
      font-size: 0.55em;
      color: #fff;
      background: #000;
      padding: 0.15em 0.4em;
    }

    .kidlisp-slide-qr {
      background: #fff;
      padding: 2px;
      line-height: 0;
    }

    .kidlisp-slide-qr img {
      display: block;
      image-rendering: pixelated;
    }

    /* KidLisp syntax highlighting - matches kidlisp.com */
    .kidlisp-slide-code .hl-comment { color: #6272a4; font-style: italic; }
    .kidlisp-slide-code .hl-string { color: orange; }
    .kidlisp-slide-code .hl-number { color: lime; }
    .kidlisp-slide-code .hl-keyword { color: pink; }
    .kidlisp-slide-code .hl-api { color: cyan; }
    .kidlisp-slide-code .hl-color { color: magenta; }
    .kidlisp-slide-code .hl-timing { color: #ffb86c; font-weight: bold; }
    .kidlisp-slide-code .hl-paren { color: #888; }

    /* Timing blink animation - uses CSS custom property for duration */
    @keyframes hl-timing-blink {
      0%, 90% { opacity: 1; text-shadow: 0 0 8px currentColor, 0 0 2px rgba(0,0,0,0.9); }
      95% { opacity: 0.3; text-shadow: 0 0 12px lime, 0 0 4px rgba(0,255,0,0.9); color: lime; }
      100% { opacity: 1; text-shadow: 0 0 8px currentColor, 0 0 2px rgba(0,0,0,0.9); }
    }

    .hl-timing-active {
      animation: hl-timing-blink var(--timing-duration, 1s) ease-in-out infinite;
    }

    .kidlisp-slide-loading {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      color: #555;
    }

    @keyframes kidlisp-spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .kidlisp-slide-loading::after {
      content: "‚è≥";
      animation: kidlisp-spin 2s linear infinite;
    }

    #pals {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.2em;
      grid-column: 1 / -1;
      color: rgba(255,255,255,0.3);
      font-family: var(--mono);
      font-size: 0.9em;
      text-decoration: none;
      cursor: pointer;
      transition: color 0.2s, filter 0.2s;
      padding: 0 0 1em 0;
      margin-top: -1em;
    }

    #pals img {
      width: 96px;
      height: auto;
      filter: grayscale(100%) opacity(0.3);
      transition: filter 0.2s;
      order: 2;
    }

    #pals span {
      order: 1;
    }

    #pals:hover {
      color: rgba(255,255,255,0.8);
    }

    #pals:hover img {
      filter: grayscale(100%) opacity(0.5);
    }

    .page-footer {
      grid-column: 1 / -1;
      text-align: center;
      padding: 1.5em 0 0.5em 0;
      font-family: var(--mono);
      font-size: 0.85em;
      color: rgba(255,255,255,0.25);
    }

    .page-footer a {
      color: rgba(255,255,255,0.4);
      text-decoration: none;
    }

    .page-footer a:hover {
      color: rgba(255,255,255,0.7);
    }

    /* Footer auth section */
    .footer-auth {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-bottom: 0.5em;
    }

    .footer-auth-buttons {
      display: flex;
      gap: 8px;
    }

    .footer-login-btn {
      padding: 6px 14px;
      background: rgba(30, 50, 120, 0.95);
      color: white;
      border: 1px solid white;
      border-radius: 0;
      font-size: 12px;
      font-weight: normal;
      cursor: pointer;
      transition: all 0.15s;
      font-family: var(--mono);
    }

    .footer-login-btn:hover {
      background: rgba(40, 60, 140, 0.95);
      box-shadow: 0 0 8px rgba(100, 150, 255, 0.4);
    }

    .footer-signup-btn {
      padding: 6px 14px;
      background: rgba(30, 90, 50, 0.95);
      color: white;
      border: 1px solid white;
      border-radius: 0;
      font-size: 12px;
      font-weight: normal;
      cursor: pointer;
      transition: all 0.15s;
      font-family: var(--mono);
    }

    .footer-signup-btn:hover {
      background: rgba(40, 110, 60, 0.95);
      box-shadow: 0 0 8px rgba(100, 255, 150, 0.4);
    }

    .footer-user-menu {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 12px;
      background: black;
      border: 2px solid white;
      border-radius: 0;
      cursor: pointer;
      transition: all 0.15s;
    }

    .footer-user-menu:hover {
      background: rgb(30, 30, 30);
      box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }

    .footer-user-handle {
      font-size: 12px;
      color: white;
      font-weight: bold;
      font-family: var(--mono);
    }

    .footer-logout-btn {
      padding: 4px 8px;
      background: transparent;
      border: 1px solid rgba(255,255,255,0.3);
      color: rgba(255,255,255,0.6);
      font-size: 11px;
      cursor: pointer;
      font-family: var(--mono);
      margin-left: 8px;
    }

    .footer-logout-btn:hover {
      border-color: white;
      color: white;
    }

    /* Mobile adjustments */
    @media (max-width: 699px) {
      .stats-section {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 400px) {
      .stats-section {
        grid-template-columns: repeat(2, 1fr);
      }
      .stat-item { min-width: unset; }
    }

    /* Thank You Mode */
    .thanks-section {
      display: none;
      grid-column: 1 / -1;
      text-align: center;
      padding: 2em 1em;
    }

    body.thanks-mode .thanks-section {
      display: block;
    }

    body.thanks-mode .fiat-section {
      display: none !important;
    }

    body.thanks-mode .currency-links {
      display: none !important;
    }

    .thanks-canvas-wrap {
      display: inline-block;
      margin-bottom: 1.5em;
    }

    .thanks-canvas {
      width: 280px;
      height: 280px;
      border-radius: 12px;
    }

    .thanks-message {

      font-family: 'YWFTProcessing-Regular', sans-serif;
      font-size: 1.4em;
      color: var(--text);
      max-width: 500px;
      margin: 0 auto 1.5em auto;
      line-height: 1.5;
    }

    .thanks-amount {
      color: var(--green);
      font-weight: bold;
    }

    .thanks-actions {
      display: flex;
      gap: 1em;
      justify-content: center;
      flex-wrap: wrap;
    }

    .thanks-again {
      display: inline-block;
      padding: 0.8em 1.5em;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 6px;
      color: var(--cyan);
      text-decoration: none;
      transition: all 0.15s;
      font-size: 0.95em;
    }

    .thanks-again:hover {
      background: var(--cyan);
      color: var(--bg);
      text-decoration: none;
    }

    .thanks-share {
      display: inline-block;
      padding: 0.8em 1.5em;
      background: #000;
      border: 1px solid #333;
      border-radius: 6px;
      color: #fff;
      font-family: var(--mono);
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.15s;
    }

    .thanks-share:hover {
      background: #1da1f2;
      border-color: #1da1f2;
    }

    /* Ken Burns Canvas Slideshow - Nostalgic Photo Background */
    .jeffreys-slideshow {
      position: absolute;
      inset: 0;
      overflow: hidden;
      border-radius: 8px 8px 0 0;
      z-index: 0;
    }

    .jeffreys-canvas {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      /* Nostalgic filter on the canvas */
      filter: sepia(0.2) saturate(0.6) brightness(0.5) contrast(0.9);
    }

    /* Purple/magenta blend overlay */
    .jeffreys-slideshow::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(148, 0, 211, 0.4) 0%,
        rgba(205, 92, 155, 0.45) 50%,
        rgba(138, 43, 226, 0.35) 100%
      );
      mix-blend-mode: overlay;
      pointer-events: none;
      z-index: 2;
    }

    /* Vignette overlay for extra nostalgia */
    .jeffreys-slideshow::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, transparent 20%, rgba(26, 26, 46, 0.7) 100%);
      pointer-events: none;
      z-index: 3;
    }

    /* Make sure gift-logo-wrap stays above slideshow */
    .gift-logo-wrap {
      position: relative;
      z-index: 4;
    }

    /* Brighter logo with glow on slideshow background */
    .gift-visual:has(.jeffreys-slideshow) .gift-logo {
      filter: drop-shadow(0 2px 12px rgba(205, 92, 155, 0.6)) drop-shadow(0 0 20px rgba(255,255,255,0.3));
    }
  </style>
</head>

<body>
  <div class="top-bar">
    <div style="display: flex; align-items: center; gap: 8px;">
      <div class="logo" onclick="window.location.href='https://aesthetic.computer'"><span class="logo-give">give</span><span class="logo-sep">‚Äî</span><span class="logo-ac">Aesthetic<span class="logo-dot">.</span>Computer</span></div>
      <div class="lang-selector" id="langSelector">
        <span class="lang-flag" id="lang-flag">üá∫üá∏</span>
        <span class="lang-text" id="lang-text">English</span>
        <span class="lang-arrow">‚ñº</span>
        <div class="lang-dropdown" id="lang-dropdown">
          <div class="lang-option" data-lang="en">üá∫üá∏ English</div>
          <div class="lang-option" data-lang="da">üá©üá∞ Dansk</div>
        </div>
      </div>
    </div>
    <div class="currency-links" id="currSelector">
      <span class="curr-link active" data-curr="usd"><span class="curr-flag">üíµ</span><span class="curr-text">USD</span></span>
      <span class="curr-link" data-curr="dkk"><span class="curr-flag">üí∂</span><span class="curr-text">DKK</span></span>
      <span class="curr-link" data-curr="crypto"><span class="curr-flag">Íú©</span><span class="curr-text">CRYPTO</span></span>
    </div>
  </div>

  <main>
    <div class="content-grid">
      <!-- Thank You Section (shown when ?thanks=1) -->
      <div class="thanks-section">
        <div class="thanks-canvas-wrap">
          <canvas class="thanks-canvas" id="thanksCanvas" width="560" height="560"></canvas>
        </div>
        <p class="thanks-message" data-lang="en">
          Thank you for giving <span class="thanks-amount" id="thanksAmountEn">$25</span> and keeping Aesthetic.Computer online and free to use.
        </p>
        <p class="thanks-message" data-lang="da">
          Tak for at give <span class="thanks-amount" id="thanksAmountDa">$25</span> og holde Aesthetic.Computer online og gratis at bruge.
        </p>
        <div class="thanks-actions">
          <a href="./" class="thanks-again" data-lang="en">Give again?</a>
          <a href="./" class="thanks-again" data-lang="da">Giv igen?</a>
          <button class="thanks-share" id="shareBtn" data-lang="en">Share to ùïè</button>
          <button class="thanks-share" id="shareBtnDa" data-lang="da">Del p√• ùïè</button>
        </div>
      </div>

      <!-- Gives Ticker - cycles through recent gives -->
      <div class="fiat-section full-width">
        <div class="gives-ticker" id="givesTicker">
          <div class="gives-ticker-empty">Loading gives...</div>
        </div>
        <div class="currency-pickers">
          <div class="currency-picker" data-for="usd">
            <div class="gift-widget" data-currency="usd">
              <div class="gift-visual">
                <div class="jeffreys-slideshow" id="jeffreysSlideshow"></div>
                <div class="gift-logo-wrap">
                  <img src="https://aesthetic.computer/purple-pals.svg" class="gift-logo" alt="">
                  <div class="gift-amount">$125<span class="monthly-infinity">‚àû</span></div>
                </div>
              </div>
              <div class="gift-controls">
                <input type="range" min="1" max="2500" step="1" value="125">
                <div class="invest-suggestion" style="display: none;">
                  <span data-lang="en">At this level, consider <a href="#invest" class="invest-link">investing</a> for equity!</span>
                  <span data-lang="da">P√• dette niveau, overvej at <a href="#invest" class="invest-link">investere</a> for ejerandel!</span>
                </div>
                <button class="gift-btn" data-currency="usd">Give $125</button>
                <div class="gift-monthly-row">
                  <label class="gift-monthly-check">
                    <input type="checkbox" class="monthly-checkbox">
                    <span data-lang="en">Monthly</span>
                    <span data-lang="da">M√•nedligt</span>
                  </label>
                  <span class="tax-note">
                    <span data-lang="en">Not tax deductible. <a href="#invest" class="invest-link">Investor?</a></span>
                    <span data-lang="da">Ikke fradragsberettiget. <a href="#invest" class="invest-link">Investor?</a></span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="currency-picker" data-for="dkk" style="display: none;">
            <div class="gift-widget" data-currency="dkk">
              <div class="gift-visual">
                <div class="gift-logo-wrap">
                  <img src="https://aesthetic.computer/purple-pals.svg" class="gift-logo" alt="">
                  <div class="gift-amount">200 kr<span class="monthly-infinity">‚àû</span></div>
                  <div class="gift-conversion" id="dkkConversion"></div>
                </div>
              </div>
              <div class="gift-controls">
                <input type="range" min="25" max="17500" step="25" value="200">
                <button class="gift-btn" data-currency="dkk">Giv 200 kr</button>
                <div class="gift-monthly-row">
                  <label class="gift-monthly-check">
                    <input type="checkbox" class="monthly-checkbox">
                    <span data-lang="en">Monthly</span>
                    <span data-lang="da">M√•nedligt</span>
                  </label>
                  <span class="tax-note">
                    <span data-lang="en">Not tax deductible. <a href="#invest" class="invest-link">Investor?</a></span>
                    <span data-lang="da">Ikke fradragsberettiget. <a href="#invest" class="invest-link">Investor?</a></span>
                  </span>
                </div>
              </div>
            </div>
          </div>
          <div class="currency-picker" data-for="crypto" style="display: none;">
            <div class="gift-widget crypto crypto-compact" data-currency="crypto">
              <div class="crypto-header">
                <img src="https://aesthetic.computer/purple-pals.svg" class="crypto-logo-tiny" alt="">
                <span class="crypto-title">Íú© CRYPTO</span>
              </div>
              <div class="crypto-controls crypto-all">
                <div class="crypto-address copyable" data-copy="bc1q699gnqr92gvgv62nla82typpj3wls5a8xf59as">
                  <span class="crypto-label">üü† Bitcoin</span>
                  <code class="crypto-addr">bc1q699gnqr92gvgv62nla82typpj3wls5a8xf59as</code>
                  <span class="crypto-copy-hint" data-lang="en">üìã tap to copy</span>
                  <span class="crypto-copy-hint" data-lang="da">üìã tryk for at kopiere</span>
                </div>
                <div class="crypto-address copyable" data-copy="0x1D64E3eFa983D945cBFe29Ad5b3C8ABB53Aef023">
                  <span class="crypto-label">üíé 4esthetic.eth</span>
                  <code class="crypto-addr">0x1D64E3eFa983D945cBFe29Ad5b3C8ABB53Aef023</code>
                  <span class="crypto-copy-hint" data-lang="en">üìã tap to copy</span>
                  <span class="crypto-copy-hint" data-lang="da">üìã tryk for at kopiere</span>
                </div>
                <div class="crypto-address copyable" data-copy="tz1WqvhbfEwfqAzMtEGxc7x6tpSqRMCNKPCT">
                  <span class="crypto-label">üîÆ aesthetic.tez</span>
                  <code class="crypto-addr">tz1WqvhbfEwfqAzMtEGxc7x6tpSqRMCNKPCT</code>
                  <span class="crypto-copy-hint" data-lang="en">üìã tap to copy</span>
                  <span class="crypto-copy-hint" data-lang="da">üìã tryk for at kopiere</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="prose full-width" data-lang="en">
        <a href="https://aesthetic.computer">Aesthetic<span style="color: var(--pink);">.</span>Computer</a> is the networked culture of users supported by media tooling from the full-time software engineering practice of <a href="https://aesthetic.computer/@jeffrey" class="handle-link">@jeffrey</a>, who has been building experimental software instruments for over a decade. He lives in Echo Park with <a href="https://aesthetic.computer/@fifi" class="handle-link">@fifi</a> in a house full of musicians, and regularly does show and tell at the <a href="https://nelacomputer.club">NELA Computer Club</a> in Chinatown. The next meeting is at 7pm on Tuesday, January 6th at <a href="https://plot.place">Plot</a>.
      </div>
      <div class="prose full-width" data-lang="da">
        <a href="https://aesthetic.computer">Aesthetic<span style="color: var(--pink);">.</span>Computer</a> er en kultur af sine brugere og den fuldtids softwareudviklingspraksis af <a href="https://aesthetic.computer/@jeffrey" class="handle-link">@jeffrey</a>, som har bygget eksperimentelle software-instrumenter i over et √•rti. Han bor i Echo Park med <a href="https://aesthetic.computer/@fifi" class="handle-link">@fifi</a> og et hus fuldt af musikere, og demonstrerer regelm√¶ssigt softwaren ved <a href="https://nelacomputer.club">NELA Computer Club</a> i Chinatown. Det n√¶ste m√∏de er kl. 19 tirsdag den 6. januar p√• <a href="https://plot.place">Plot</a>.
      </div>

      <div class="stats-section">
        <div class="stat-item" id="stat-handles">
          <div class="stat-floaters"></div>
          <div class="stat-value">‚Äî</div>
          <div class="stat-label">handles</div>
        </div>
        <div class="stat-item" id="stat-paintings">
          <div class="stat-floaters"></div>
          <div class="stat-value">‚Äî</div>
          <div class="stat-label">paintings</div>
        </div>
        <div class="stat-item" id="stat-moods">
          <div class="stat-floaters"></div>
          <div class="stat-value">‚Äî</div>
          <div class="stat-label">moods</div>
        </div>
        <div class="stat-item" id="stat-kidlisp">
          <div class="stat-floaters"></div>
          <div class="stat-value">‚Äî</div>
          <div class="stat-label">kidlisp pieces</div>
        </div>
        <div class="stat-item" id="stat-commands">
          <div class="stat-floaters"></div>
          <div class="stat-value">‚Äî</div>
          <div class="stat-label">commands</div>
        </div>
        <div class="stat-item" id="stat-messages">
          <div class="stat-floaters"></div>
          <div class="stat-value">‚Äî</div>
          <div class="stat-label">messages</div>
        </div>
      </div>

      <div class="kidlisp-preview">
        <a href="https://kidlisp.com" class="kidlisp-preview-header">
          <strong class="kidlisp-logo" style="font-family: 'Comic Sans MS', cursive; font-size: 1.1em;"><span style="color:#FF6B6B">K</span><span style="color:#4ECDC4">i</span><span style="color:#FFE66D">d</span><span style="color:#95E1D3">L</span><span style="color:#F38181">i</span><span style="color:#AA96DA">s</span><span style="color:#70D6FF">p</span><span style="color:var(--dim)">.</span><span style="color:#70D6FF">com</span></strong>
        </a>
        <div class="kidlisp-carousel" id="kidlispCarousel">
          <div class="kidlisp-slide-loading"></div>
        </div>
        <!-- Auto-advance progress bar -->
        <div class="kidlisp-auto-progress">
          <div class="kidlisp-auto-progress-bar" id="kidlispAutoProgress"></div>
        </div>
        <div class="module-caption">
          <span data-lang="en">The next-level pattern syntax for gen beta</span>
          <span data-lang="da">Den n√¶ste generations m√∏nstersyntaks for gen beta</span>
        </div>
      </div>

      <div class="chat-flip-container">
        <div class="chat-flip-card" id="chatFlipCard">
          <!-- Front: laer-klokken (active when not flipped) -->
          <div class="chat-flip-face chat-flip-front chat-preview">
            <div class="chat-preview-header chat-flip-trigger" onclick="toggleChatFlip()">
              <strong>üïê laer-klokken</strong>
            </div>
            <div class="chat-messages" id="chatMessages">
              <div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Loading...</div></div>
            </div>
            <div class="module-caption chat-flip-trigger" onclick="toggleChatFlip()">
              <span data-lang="en">Goodiepal's Danish music community</span>
              <span data-lang="da">Goodiepals danske musikf√¶llesskab</span>
            </div>
            <div class="flip-face-progress">
              <div class="flip-face-progress-bar" id="chatFlipProgress"></div>
            </div>
          </div>
          
          <!-- Back: chat-system (ghost overlay when not flipped, active when flipped) -->
          <div class="chat-flip-face chat-flip-back chat-preview-system">
            <div class="chat-system-header chat-flip-trigger" onclick="toggleChatFlip()">
              <strong>üí¨ chat</strong>
            </div>
            <div class="chat-messages" id="chatSystemMessages">
              <div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Loading...</div></div>
            </div>
            <div class="module-caption chat-flip-trigger" onclick="toggleChatFlip()">
              <span data-lang="en">Global Aesthetic Computer chat</span>
              <span data-lang="da">Global Aesthetic Computer chat</span>
            </div>
            <div class="flip-face-progress flip-face-progress-back">
              <div class="flip-face-progress-bar" id="chatFlipProgressBack"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- WIP: notepat module
      <div class="link-block notepat-section">
        <strong>üéπ notepat</strong>
        <a href="https://aesthetic.computer/notepat">aesthetic.computer/notepat</a>
        <span class="link-desc" data-lang="en">Musical keyboard</span>
        <span class="link-desc" data-lang="da">Musikkeyboard</span>
      </div>
      -->

      <div class="tv-section">
        <a href="https://aesthetic.computer/tapes" class="tv-header" id="tvHeader">
          <strong>üìº tapes</strong>
        </a>
        <div class="tv-player" id="tvPlayer">
          <div class="tv-loading">üì∫</div>
        </div>
        <div class="module-caption">
          <span data-lang="en">Prefix any command with 'tape' to record and post a performance video.</span>
          <span data-lang="da">S√¶t 'tape' foran en kommando for at optage og dele en performance-video.</span>
        </div>
      </div>

      <!-- Apps Flip: Desktop / Mobile -->
      <div class="apps-flip-container" id="appsFlipContainer">
        <div class="apps-flip-card" id="appsFlipCard">
          <!-- Front: Desktop (active when not flipped) -->
          <div class="apps-flip-face apps-flip-front desktop-face">
            <div class="desktop-face-header">
              <span class="face-label">desktop</span>
              <span class="version-badge" id="desktopVersion">v0.1.0</span>
            </div>
            
            <div class="desktop-platforms-grid">
              <a href="https://aesthetic.computer/desktop/mac" class="desktop-platform-btn" title="Download for macOS">
                <span class="plat-icon">üçé</span>
                <span class="plat-name">Mac</span>
                <span class="plat-arch">Universal</span>
              </a>
              <a href="https://aesthetic.computer/desktop/win" class="desktop-platform-btn" title="Download for Windows">
                <span class="plat-icon">ü™ü</span>
                <span class="plat-name">Windows</span>
                <span class="plat-arch">x64</span>
              </a>
              <a href="https://aesthetic.computer/desktop/linux" class="desktop-platform-btn" title="Download for Linux">
                <span class="plat-icon">üêß</span>
                <span class="plat-name">Linux</span>
                <span class="plat-arch">AppImage</span>
              </a>
            </div>
            
            <div class="desktop-changelog-box">
              <div class="desktop-changelog-header">
                <strong id="releaseName">Latest</strong>
                <span id="releaseDate"></span>
              </div>
              <ul class="desktop-changelog-list" id="releaseChangelog">
                <li>Loading...</li>
              </ul>
            </div>
            
            <a href="https://aesthetic.computer/code" class="desktop-vscode-link" target="_blank">
              <img class="vscode-icon-img" id="vscodeIcon" src="https://marketplace.visualstudio.com/_apis/public/gallery/publishers/aesthetic-computer/extensions/aesthetic-computer-code/latest/assets/icon" alt="VS Code" onerror="this.style.display='none';this.nextElementSibling.style.display='inline'">
              <span class="vscode-icon" style="display:none">üíú</span>
              <span class="vscode-label">VS Code</span>
              <span class="vscode-ver" id="vscodeExtVersion">v1.217.0</span>
            </a>
            
            <a href="https://assets.aesthetic.computer/ableton/notepat-ableton-2025-alpha.amxd.zip" class="desktop-ableton-link" target="_blank" download>
              <span class="ableton-icon">üéπ</span>
              <span class="ableton-label">Ableton</span>
              <span class="ableton-tag">notepat</span>
            </a>
            <div class="module-caption apps-flip-trigger" onclick="toggleAppsFlip()">
              <span data-lang="en">Desktop apps and plugins are free.</span>
              <span data-lang="da">Desktop-apps og plugins er gratis.</span>
            </div>
            <div class="flip-face-progress">
              <div class="flip-face-progress-bar" id="appsFlipProgress"></div>
            </div>
          </div>
          
          <!-- Back: Mobile (ghost overlay when not flipped, active when flipped) -->
          <div class="apps-flip-face apps-flip-back mobile-face">
            <div class="mobile-face-header">
              <span class="face-label">mobile</span>
            </div>
            
            <div class="mobile-face-content">
              <img class="mobile-app-icon" id="iosAppIcon" 
                   src="https://is1-ssl.mzstatic.com/image/thumb/Purple126/v4/91/c2/9c/91c29cd6-ff12-a9ad-0a67-1d5700352b62/AppIcon-0-0-1x_U007epad-0-85-220.png/100x100bb.jpg"
                   alt="Aesthetic Computer" 
                   onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
              <div class="mobile-app-icon-fallback" style="display:none">üé®</div>
              <div class="mobile-app-title">Aesthetic Computer</div>
              
              <a href="https://apps.apple.com/ag/app/aesthetic-computer/id6450940883" 
                 class="mobile-store-link" target="_blank">
                <span>iOS App Store</span>
              </a>
            </div>
            <div class="module-caption apps-flip-trigger" onclick="toggleAppsFlip()">
              <span data-lang="en">Mobile app is free on iOS.</span>
              <span data-lang="da">Mobil-appen er gratis p√• iOS.</span>
            </div>
            <div class="flip-face-progress flip-face-progress-back">
              <div class="flip-face-progress-bar" id="appsFlipProgressMobile"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="shop-section">
        <div class="shop-header">
          <a href="https://shop.aesthetic.computer" class="shop-title">shop</a>
        </div>
        <div class="shop-products" id="shopProducts">
          <div class="shop-loading">Loading...</div>
        </div>
        <!-- Auto-advance progress bar -->
        <div class="shop-auto-progress">
          <div class="shop-auto-progress-bar" id="shopAutoProgress"></div>
        </div>
        <div class="module-caption">
          <span data-lang="en">Get artworks, tools, analog media, and wares by the AC community.</span>
          <span data-lang="da">F√• kunstv√¶rker, v√¶rkt√∏jer, analoge medier og varer fra AC-f√¶llesskabet.</span>
        </div>
      </div>

      <div class="invest-section" id="invest">
        <div class="invest-header">
          <span>üìà</span>
          <span data-lang="en">Invest</span>
          <span data-lang="da">Invest√©r</span>
        </div>
        <div class="invest-content" data-lang="en">
          <p><a href="https://aesthetic.direct">Aesthetic Inc.</a> was <a href="https://prompt.ac/booted-by">booted by</a> a handful of early supporters.<br><br>To join this equity holding community, <a href="https://calendly.com/aesthetic-computer/demo" class="demo-link">book a remote demo</a> with <a href="https://aesthetic.computer/@jeffrey" class="handle-link">@jeffrey</a>.</p>
        </div>
        <div class="invest-content" data-lang="da">
          <p><a href="https://aesthetic.direct">Aesthetic Inc.</a> bliver <a href="https://prompt.ac/booted-by">startet af</a> en h√•ndfuld tidlige st√∏tter, der deler i at reservere virksomhedskapital.<br><br>For at blive en del af dette f√¶llesskab, <a href="https://calendly.com/aesthetic-computer/demo" class="demo-link">book en fjern-demo</a> med <a href="https://aesthetic.computer/@jeffrey" class="handle-link">@jeffrey</a>.</p>
        </div>
      </div>

      <div class="page-footer">
        <div class="footer-auth" id="footerAuth">
          <div class="footer-auth-buttons" id="footerAuthButtons">
            <button class="footer-login-btn" id="footerLoginBtn">Log in</button>
            <button class="footer-signup-btn" id="footerSignupBtn">I'm new</button>
          </div>
          <div class="footer-user-menu" id="footerUserMenu" style="display: none;">
            <span class="footer-user-handle" id="footerUserHandle"></span>
            <button class="footer-logout-btn" id="footerLogoutBtn">Logout</button>
          </div>
        </div>
      </div>

      <a id="pals" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;" href="#">
        <img src="https://aesthetic.computer/purple-pals.svg" alt="">
        <span>‚Üë Back to Top</span>
      </a>
    </div>
  </main>

  <script>
    // ====== Jeffreys Ken Burns Canvas Slideshow ======
    // POI (Points of Interest) data: faces, bodies, hands
    // Detected using OpenCV DNN + Haar cascades
    // POI types: 'f'=face, 'b'=body, 'h'=hand
    const jeffreysData = {
      'FullSizeRender': { focal: [38.5, 34.8], pois: [{"t": "f", "box": [33.8, 30.0, 9.5, 9.7]}, {"t": "b", "box": [59.5, 63.9, 20.2, 12.4]}, {"t": "b", "box": [87.6, 89.3, 8.4, 5.2]}], aspect: 0.75 },
      'IMG_0260': { focal: [41.0, 38.1], pois: [{"t": "f", "box": [32.3, 29.3, 17.4, 17.5]}, {"t": "b", "box": [15.9, 50.0, 5.9, 3.6]}], aspect: 0.75 },
      'IMG_0675': { focal: [54.0, 37.2], pois: [{"t": "f", "box": [47.8, 31.8, 12.3, 10.9]}], aspect: 0.667 },
      'IMG_0686': { focal: [57.4, 25.4], pois: [{"t": "b", "box": [53.6, 23.1, 7.5, 4.6]}, {"t": "b", "box": [54.1, 47.2, 6.9, 4.2]}], aspect: 0.75 },
      'IMG_0688': { focal: [72.3, 63.0], pois: [{"t": "b", "box": [69.1, 59.3, 6.5, 7.4]}, {"t": "b", "box": [39.4, 46.8, 4.1, 4.6]}], aspect: 0.563 },
      'IMG_0798': { focal: [46.6, 6.4], pois: [{"t": "b", "box": [44.8, 5.3, 3.7, 2.3]}], aspect: 0.75 },
      'IMG_1111': { focal: [50, 50], pois: [], aspect: 0.562 },
      'IMG_1577': { focal: [37.0, 70.6], pois: [{"t": "b", "box": [35.5, 69.7, 2.8, 1.7]}], aspect: 0.75 },
      'IMG_1616': { focal: [47.8, 51.7], pois: [{"t": "f", "box": [42.5, 45.2, 10.7, 13.0]}, {"t": "b", "box": [14.1, 68.0, 12.4, 7.6]}], aspect: 0.75 },
      'IMG_1737': { focal: [50, 50], pois: [], aspect: 0.75 },
      'IMG_1809': { focal: [48.0, 53.2], pois: [{"t": "b", "box": [45.0, 51.4, 6.1, 3.7]}], aspect: 0.75 },
      'IMG_2124': { focal: [54.8, 35.8], pois: [{"t": "f", "box": [49.7, 31.8, 10.1, 7.9]}, {"t": "b", "box": [3.1, 48.8, 32.0, 14.8]}], aspect: 0.563 },
      'IMG_2208': { focal: [40.0, 21.8], pois: [{"t": "f", "box": [33.6, 14.5, 12.8, 14.6]}, {"t": "b", "box": [23.4, 5.1, 10.6, 6.5]}], aspect: 0.75 },
      'IMG_2280': { focal: [57.4, 33.4], pois: [{"t": "f", "box": [42.5, 16.4, 29.8, 34.0]}], aspect: 0.8 },
      'IMG_2498': { focal: [21.8, 61.4], pois: [{"t": "b", "box": [12.6, 55.8, 18.3, 11.2]}], aspect: 0.75 },
      'IMG_2630': { focal: [20.3, 59.6], pois: [{"t": "b", "box": [6.8, 44.8, 27.0, 29.4]}, {"t": "b", "box": [30.7, 44.0, 8.6, 22.9]}], aspect: 1.333 },
      'IMG_2658': { focal: [46.6, 43.7], pois: [{"t": "f", "box": [39.2, 34.5, 14.8, 18.4]}, {"t": "b", "box": [58.5, 68.9, 8.4, 5.2]}], aspect: 0.75 },
      'IMG_2668': { focal: [39.4, 24.5], pois: [{"t": "b", "box": [30.4, 19.0, 18.0, 11.0]}, {"t": "b", "box": [40.7, 68.8, 8.6, 5.3]}], aspect: 0.75 },
      'IMG_2905': { focal: [47.5, 40.1], pois: [{"t": "b", "box": [28.3, 28.4, 38.3, 23.5]}], aspect: 0.75 },
      'IMG_2913': { focal: [69.9, 19.9], pois: [{"t": "b", "box": [67.7, 18.5, 4.5, 2.7]}, {"t": "b", "box": [87.0, 36.8, 4.1, 2.5]}], aspect: 0.75 },
      'IMG_3017': { focal: [37.6, 81.5], pois: [{"t": "b", "box": [31.7, 77.9, 11.8, 7.3]}], aspect: 0.75 },
      'IMG_3234': { focal: [42.4, 48.8], pois: [{"t": "f", "box": [36.9, 43.2, 11.1, 11.3]}, {"t": "b", "box": [27.1, 34.8, 15.4, 9.4]}], aspect: 0.75 },
      'IMG_4281': { focal: [50.2, 38.1], pois: [{"t": "f", "box": [44.5, 31.3, 11.4, 13.6]}, {"t": "b", "box": [70.5, 59.8, 8.4, 12.6]}], aspect: 0.75 },
      'IMG_4312': { focal: [4.1, 28.1], pois: [{"t": "f", "box": [0.0, 18.6, 8.2, 19.0]}, {"t": "b", "box": [32.5, 63.2, 3.2, 2.0]}], aspect: 0.75 },
      'IMG_4606': { focal: [53.1, 56.5], pois: [{"t": "f", "box": [28.6, 31.6, 48.9, 49.8]}], aspect: 0.75 },
      'IMG_4894': { focal: [48.0, 73.6], pois: [{"t": "b", "box": [44.4, 71.4, 7.2, 4.4]}, {"t": "b", "box": [71.8, 49.7, 4.6, 6.8]}], aspect: 0.75 },
      'IMG_4997': { focal: [54.0, 55.8], pois: [{"t": "b", "box": [52.3, 53.2, 3.4, 5.1]}], aspect: 0.75 },
      'IMG_5043': { focal: [40.8, 43.4], pois: [{"t": "f", "box": [30.8, 32.3, 20.1, 22.1]}, {"t": "b", "box": [31.9, 69.9, 4.8, 3.0]}], aspect: 0.75 },
      'IMG_5050': { focal: [65.6, 53.7], pois: [{"t": "f", "box": [60.1, 48.3, 10.9, 10.8]}, {"t": "b", "box": [21.9, 43.0, 16.5, 10.1]}], aspect: 0.75 },
      'IMG_5272': { focal: [62.3, 53.4], pois: [{"t": "b", "box": [61.0, 51.3, 2.7, 4.1]}], aspect: 0.75 },
      'IMG_5644': { focal: [49.0, 17.8], pois: [{"t": "f", "box": [44.1, 13.9, 9.8, 8.0]}, {"t": "b", "box": [32.7, 19.9, 11.0, 5.1]}], aspect: 0.563 },
      'IMG_6342': { focal: [62.3, 28.0], pois: [{"t": "f", "box": [55.1, 18.5, 14.5, 18.9]}, {"t": "b", "box": [10.7, 69.4, 23.7, 14.6]}], aspect: 0.75 },
      'IMG_6367': { focal: [44.1, 34.3], pois: [{"t": "f", "box": [37.8, 28.7, 12.7, 11.1]}, {"t": "b", "box": [60.4, 4.8, 3.6, 2.2]}], aspect: 0.75 },
      'IMG_6435': { focal: [48.0, 37.8], pois: [{"t": "f", "box": [37.9, 27.2, 20.2, 21.1]}, {"t": "b", "box": [35.9, 86.0, 4.8, 2.9]}], aspect: 0.75 },
      'IMG_8080': { focal: [42.6, 27.7], pois: [{"t": "f", "box": [36.0, 20.8, 13.1, 13.9]}, {"t": "b", "box": [15.9, 8.3, 66.6, 40.9]}], aspect: 0.75 },
      'IMG_8188': { focal: [48.9, 33.9], pois: [{"t": "f", "box": [37.9, 24.0, 21.8, 19.9]}, {"t": "b", "box": [35.0, 88.1, 9.8, 6.0]}], aspect: 0.75 },
      'IMG_8989': { focal: [79.2, 86.1], pois: [{"t": "b", "box": [76.7, 84.6, 5.0, 3.1]}], aspect: 0.75 },
      'IMG_9795': { focal: [31.2, 22.0], pois: [{"t": "f", "box": [23.8, 15.6, 14.8, 12.9]}, {"t": "b", "box": [21.3, 51.5, 4.3, 2.0]}], aspect: 0.562 }
    };

    const jeffreysImages = Object.keys(jeffreysData);
    const DEBUG_FACES = true; // Set true to show POI boxes
    const POI_GLOW = true; // Soft radial glow on detected faces/bodies

    function initJeffreysSlideshow() {
      const container = document.getElementById('jeffreysSlideshow');
      if (!container) return;

      // Create canvas
      const canvas = document.createElement('canvas');
      canvas.className = 'jeffreys-canvas';
      container.appendChild(canvas);
      const ctx = canvas.getContext('2d');

      // Separate narrow (portrait) and wide images
      const narrowImages = jeffreysImages.filter(name => jeffreysData[name].aspect < 0.7);
      const wideImages = jeffreysImages.filter(name => jeffreysData[name].aspect >= 0.7);
      
      // Shuffle both arrays
      const shuffledNarrow = [...narrowImages].sort(() => Math.random() - 0.5);
      const shuffledWide = [...wideImages].sort(() => Math.random() - 0.5);
      
      // Create display queue: singles for wide, pairs for narrow
      const displayQueue = [];
      let narrowIdx = 0;
      let wideIdx = 0;
      
      // Interleave: 2 wide singles, then 1 narrow pair, repeat
      while (wideIdx < shuffledWide.length || narrowIdx < shuffledNarrow.length) {
        // Add 2 wide singles
        for (let i = 0; i < 2 && wideIdx < shuffledWide.length; i++) {
          displayQueue.push([shuffledWide[wideIdx++]]);
        }
        // Add 1 narrow pair (collage)
        if (narrowIdx + 1 < shuffledNarrow.length) {
          displayQueue.push([shuffledNarrow[narrowIdx], shuffledNarrow[narrowIdx + 1]]);
          narrowIdx += 2;
        } else if (narrowIdx < shuffledNarrow.length) {
          displayQueue.push([shuffledNarrow[narrowIdx++]]);
        }
      }

      // Preload images
      const loadedImages = {};
      
      function preloadImage(name) {
        return new Promise(resolve => {
          if (loadedImages[name]) return resolve(loadedImages[name]);
          const img = new Image();
          img.crossOrigin = 'anonymous';
          img.onload = () => {
            loadedImages[name] = img;
            resolve(img);
          };
          img.onerror = resolve;
          img.src = `https://assets.aesthetic.computer/jeffreys/jpg/${name}.jpg`;
        });
      }

      // Resize canvas to container
      let canvasW = 0, canvasH = 0;
      function resizeCanvas() {
        const rect = container.getBoundingClientRect();
        canvasW = rect.width;
        canvasH = rect.height;
        canvas.width = canvasW * window.devicePixelRatio;
        canvas.height = canvasH * window.devicePixelRatio;
        canvas.style.width = canvasW + 'px';
        canvas.style.height = canvasH + 'px';
        ctx.setTransform(window.devicePixelRatio, 0, 0, window.devicePixelRatio, 0, 0);
      }

      let currentDisplayIndex = 0;
      let currentAlpha = 0;
      let targetImages = [];
      let floatOffset = 0;
      let poiIndex = 0; // Current POI being focused on
      let poiTimer = 0; // Timer for switching POIs
      let globalRotation = 0; // Slow global rotation
      let colorPhase = 0; // For color channel cycling

      // Easing function for smooth bouncy motion
      function easeInOutSine(t) {
        return -(Math.cos(Math.PI * t) - 1) / 2;
      }
      
      // Bouncy ease for more organic feel
      function bouncyEase(t) {
        const s = Math.sin(t * Math.PI * 2);
        const s2 = Math.sin(t * Math.PI * 4) * 0.3;
        return (s + s2 * 0.5 + 1) / 2;
      }

      // Get POI center coordinates
      function getPoiCenter(poi) {
        return {
          x: poi.box[0] + poi.box[2] / 2,
          y: poi.box[1] + poi.box[3] / 2,
          w: poi.box[2],
          h: poi.box[3],
          type: poi.t
        };
      }

      // Draw image with focal point offset to left or right (avoiding center logo)
      // Animation flow: WIDE BODY SHOT ‚Üí ZOOM INTO FACE/ACTIONS
      // drift controls progression: 0 = wide establishing shot, 1 = tight on face/action
      function drawImageFocused(img, data, destX, destY, destW, destH, alpha, drift, rotation = 0, forceOffset = null) {
        const imgW = img.width;
        const imgH = img.height;
        
        // Separate POIs by type for staged reveal
        const allPois = data.pois || [];
        const bodies = allPois.filter(poi => poi.t === 'b');
        const faces = allPois.filter(poi => poi.t === 'f');
        const hands = allPois.filter(poi => poi.t === 'h');
        
        // Priority order: bodies first (establishing), then faces, then hands (action)
        // Create a staged reveal array
        const stagedPois = [];
        
        // Stage 1: Widest body shot (largest body or default center)
        const biggestBody = bodies.sort((a, b) => (b.box[2] * b.box[3]) - (a.box[2] * a.box[3]))[0];
        if (biggestBody) {
          stagedPois.push({ ...biggestBody, stage: 'wide' });
        }
        
        // Stage 2: Face closeups
        for (const face of faces) {
          stagedPois.push({ ...face, stage: 'closeup' });
        }
        
        // Stage 3: Hand/action details (only if significant)
        for (const hand of hands) {
          const area = hand.box[2] * hand.box[3];
          if (area > 3) { // Only larger hand detections
            stagedPois.push({ ...hand, stage: 'action' });
          }
        }
        
        // If no POIs, fall back to default focal
        if (stagedPois.length === 0) {
          stagedPois.push({ t: 'default', box: [data.focal[0] - 10, data.focal[1] - 10, 20, 20], stage: 'wide' });
        }

        // Calculate focal point - progress through stages with drift
        // drift cycles 0‚Üí1, we map to staged progression
        const stagePhase = (drift * 0.4 * stagedPois.length) % stagedPois.length; // Even slower
        const stageIdx = Math.floor(stagePhase);
        const nextStageIdx = (stageIdx + 1) % stagedPois.length;
        const rawBlend = stagePhase - stageIdx;
        const blend = easeInOutSine(rawBlend);
        
        const poi1 = getPoiCenter(stagedPois[stageIdx]);
        const poi2 = getPoiCenter(stagedPois[nextStageIdx]);
        
        // Smooth blend between stages
        const focalX = poi1.x + (poi2.x - poi1.x) * blend;
        const focalY = poi1.y + (poi2.y - poi1.y) * blend;
        const currentPoi = stagedPois[stageIdx];
        
        // ZOOM: Wide for bodies, tight for faces/hands
        // Body/wide stage = 1.0-1.1 zoom (show more)
        // Face closeup = 1.4-1.6 zoom (intimate)
        // Hand/action = 1.3-1.5 zoom (detail)
        let zoomTarget1, zoomTarget2;
        const getZoomForStage = (poi) => {
          if (poi.stage === 'wide' || poi.t === 'b') return 1.05;
          if (poi.t === 'f') return 1.5;
          if (poi.t === 'h') return 1.4;
          return 1.15;
        };
        
        zoomTarget1 = getZoomForStage(stagedPois[stageIdx]);
        zoomTarget2 = getZoomForStage(stagedPois[nextStageIdx]);
        
        // Smooth zoom transition with gentle pulse
        const baseZoom = zoomTarget1 + (zoomTarget2 - zoomTarget1) * blend;
        const zoomPulse = Math.sin(drift * Math.PI * 4) * 0.03; // Subtle breathing
        const zoom = baseZoom + zoomPulse;
        
        // Calculate source rect to show focal point
        const canvasRatio = destW / destH;
        const imgRatio = imgW / imgH;
        
        let srcW, srcH, srcX, srcY;
        
        if (imgRatio > canvasRatio) {
          // Image wider than canvas - crop sides
          srcH = imgH / zoom;
          srcW = srcH * canvasRatio;
        } else {
          // Image taller than canvas - crop top/bottom
          srcW = imgW / zoom;
          srcH = srcW / canvasRatio;
        }
        
        // OFFSET: Position face LEFT or RIGHT of center (not in center where logo is)
        // Decide offset direction based on face position - if face is left of center, show it left
        // If face is right of center, show it right. This feels more natural.
        let offsetDirection = forceOffset;
        if (offsetDirection === null) {
          // Auto-detect: push face to whichever side it's already leaning toward
          offsetDirection = focalX < 50 ? 'left' : 'right';
        }
        
        // Calculate offset: we want face at ~30% or ~70% of canvas, not 50%
        // This means shifting the source crop so focal point maps to side of canvas
        const targetCanvasPercent = offsetDirection === 'left' ? 0.30 : 0.70;
        const focalImgX = imgW * focalX / 100;
        const focalImgY = imgH * focalY / 100;
        
        // Position srcX so that focalImgX lands at targetCanvasPercent of destW
        srcX = focalImgX - srcW * targetCanvasPercent;
        srcY = focalImgY - srcH / 2; // Vertical still centered on face
        
        // Clamp to image bounds
        srcX = Math.max(0, Math.min(imgW - srcW, srcX));
        srcY = Math.max(0, Math.min(imgH - srcH, srcY));
        
        ctx.save();
        ctx.globalAlpha = alpha;
        
        // Apply rotation around center of destination
        const centerX = destX + destW / 2;
        const centerY = destY + destH / 2;
        ctx.translate(centerX, centerY);
        ctx.rotate(rotation);
        ctx.translate(-centerX, -centerY);
        
        // Scale up slightly to cover corners when rotated
        const rotScale = 1 + Math.abs(rotation) * 0.5;
        ctx.translate(centerX, centerY);
        ctx.scale(rotScale, rotScale);
        ctx.translate(-centerX, -centerY);
        
        ctx.drawImage(img, srcX, srcY, srcW, srcH, destX, destY, destW, destH);
        
        // Soft radial glow highlights on faces and bodies
        if (POI_GLOW && data.pois && data.pois.length > 0) {
          for (const poi of data.pois) {
            // Only glow faces and large bodies
            const area = poi.box[2] * poi.box[3];
            if (poi.t === 'h') continue; // Skip hands
            if (poi.t === 'b' && area < 20) continue; // Skip small bodies
            
            const poiImgX = imgW * poi.box[0] / 100;
            const poiImgY = imgH * poi.box[1] / 100;
            const poiImgW = imgW * poi.box[2] / 100;
            const poiImgH = imgH * poi.box[3] / 100;
            
            // Check if POI is in visible region
            if (poiImgX + poiImgW > srcX && poiImgX < srcX + srcW &&
                poiImgY + poiImgH > srcY && poiImgY < srcY + srcH) {
              // Map POI center to canvas coords
              const poiCenterX = destX + (poiImgX + poiImgW / 2 - srcX) / srcW * destW;
              const poiCenterY = destY + (poiImgY + poiImgH / 2 - srcY) / srcH * destH;
              const poiRadius = Math.max(poiImgW / srcW * destW, poiImgH / srcH * destH) * 1.3;
              
              // Create soft radial gradient glow - warmer for faces, cooler for bodies
              const glow = ctx.createRadialGradient(
                poiCenterX, poiCenterY, 0,
                poiCenterX, poiCenterY, poiRadius
              );
              
              if (poi.t === 'f') {
                // Warm golden glow for faces
                glow.addColorStop(0, 'rgba(255, 245, 220, 0.18)');
                glow.addColorStop(0.4, 'rgba(255, 230, 200, 0.10)');
                glow.addColorStop(1, 'rgba(255, 220, 180, 0)');
              } else {
                // Subtle cool glow for bodies
                glow.addColorStop(0, 'rgba(220, 230, 255, 0.12)');
                glow.addColorStop(0.4, 'rgba(200, 215, 255, 0.06)');
                glow.addColorStop(1, 'rgba(180, 200, 255, 0)');
              }
              
              ctx.fillStyle = glow;
              ctx.fillRect(destX, destY, destW, destH);
            }
          }
        }
        
        // Debug: draw POI boxes
        if (DEBUG_FACES && data.pois) {
          const typeColors = { f: 'rgba(255, 0, 255, 0.9)', b: 'rgba(0, 255, 255, 0.7)', h: 'rgba(255, 255, 0, 0.5)' };
          ctx.lineWidth = 2;
          for (const poi of data.pois) {
            const poiImgX = imgW * poi.box[0] / 100;
            const poiImgY = imgH * poi.box[1] / 100;
            const poiImgW = imgW * poi.box[2] / 100;
            const poiImgH = imgH * poi.box[3] / 100;
            if (poiImgX + poiImgW > srcX && poiImgX < srcX + srcW &&
                poiImgY + poiImgH > srcY && poiImgY < srcY + srcH) {
              ctx.strokeStyle = typeColors[poi.t] || 'white';
              const canvasX = destX + (poiImgX - srcX) / srcW * destW;
              const canvasY = destY + (poiImgY - srcY) / srcH * destH;
              const canvasFW = poiImgW / srcW * destW;
              const canvasFH = poiImgH / srcH * destH;
              ctx.strokeRect(canvasX, canvasY, canvasFW, canvasFH);
              // Label
              ctx.font = '10px monospace';
              ctx.fillStyle = typeColors[poi.t];
              ctx.fillText(poi.t.toUpperCase(), canvasX + 2, canvasY + 10);
            }
          }
          // Crosshair on current focal point
          const focalCanvasX = destX + (focalImgX - srcX) / srcW * destW;
          const focalCanvasY = destY + (focalImgY - srcY) / srcH * destH;
          ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';
          ctx.strokeStyle = 'rgba(0, 255, 0, 0.9)';
          ctx.fillRect(focalCanvasX - 15, focalCanvasY - 2, 30, 4);
          ctx.fillRect(focalCanvasX - 2, focalCanvasY - 15, 4, 30);
        }
        
        ctx.restore();
      }

      // Pixel dissolve pattern - NOT USED anymore (too CPU intensive)
      // Using simple alpha crossfade instead
      let transitionProgress = 0; // 0 = showing old, 1 = showing new (for image crossfade)
      let isTransitioning = false;
      let previousImages = [];
      
      function render() {
        const w = canvasW;
        const h = canvasH;
        
        // Update phases slowly
        globalRotation += 0.00002;
        floatOffset += 0.00004;
        
        const rotation = Math.sin(globalRotation) * 0.003;
        
        // Subtle trail effect
        ctx.fillStyle = 'rgba(18, 14, 24, 0.08)';
        ctx.fillRect(0, 0, w, h);
        
        // Draw whole image covering canvas (no zoom, just cover)
        const drawWholeImage = (img, destX, destY, destW, destH, alpha, rot = 0) => {
          const imgW = img.width;
          const imgH = img.height;
          const canvasRatio = destW / destH;
          const imgRatio = imgW / imgH;
          
          let srcW, srcH, srcX, srcY;
          if (imgRatio > canvasRatio) {
            srcH = imgH;
            srcW = srcH * canvasRatio;
            srcX = (imgW - srcW) / 2;
            srcY = 0;
          } else {
            srcW = imgW;
            srcH = srcW / canvasRatio;
            srcX = 0;
            srcY = (imgH - srcH) / 2;
          }
          
          ctx.save();
          ctx.globalAlpha = alpha;
          const cx = destX + destW / 2;
          const cy = destY + destH / 2;
          ctx.translate(cx, cy);
          ctx.rotate(rot);
          const rotScale = 1 + Math.abs(rot) * 0.3;
          ctx.scale(rotScale, rotScale);
          ctx.translate(-cx, -cy);
          ctx.drawImage(img, srcX, srcY, srcW, srcH, destX, destY, destW, destH);
          ctx.restore();
        };
        
        // Draw images with given alpha
        const drawImages = (images, alpha) => {
          if (!images || images.length === 0) return;
          
          if (images.length === 1) {
            const name = images[0];
            const img = loadedImages[name];
            if (img) {
              drawWholeImage(img, 0, 0, w, h, alpha, rotation);
            }
          } else if (images.length === 2) {
            const overlap = 15;
            const eachW = (w + overlap) / 2;
            
            for (let i = 0; i < 2; i++) {
              const name = images[i];
              const img = loadedImages[name];
              if (img) {
                const x = i === 0 ? 0 : w - eachW;
                const yOffset = Math.sin(floatOffset * Math.PI * 2 + i * Math.PI * 0.5) * 1.5;
                const imgRotation = rotation + Math.sin(globalRotation + i * Math.PI) * 0.002;
                drawWholeImage(img, x, yOffset, eachW, h, alpha * 0.95, imgRotation);
              }
            }
          }
        };
        
        if (isTransitioning) {
          // Simple alpha crossfade
          const oldAlpha = 0.15 * (1 - transitionProgress);
          const newAlpha = 0.15 * transitionProgress;
          drawImages(previousImages, oldAlpha);
          drawImages(targetImages, newAlpha);
        } else {
          // Normal: just show current images
          drawImages(targetImages, 0.15);
        }
        
        requestAnimationFrame(render);
      }

      async function transitionToNext() {
        // Get next images
        const nextIdx = (currentDisplayIndex + 1) % displayQueue.length;
        const nextImages = displayQueue[nextIdx];
        
        // Wait for next images to load before transitioning
        await Promise.all(nextImages.map(preloadImage));
        
        // Store previous images for dissolve
        previousImages = [...targetImages];
        
        // Switch to next images (now loaded)
        currentDisplayIndex = nextIdx;
        targetImages = nextImages;
        
        // Start preloading the one after that (don't await)
        const futureIdx = (currentDisplayIndex + 1) % displayQueue.length;
        displayQueue[futureIdx].forEach(name => preloadImage(name));
        
        // Start dissolve transition
        isTransitioning = true;
        transitionProgress = 0;
        
        // Animate dissolve over ~20 seconds (super slow)
        const dissolveInterval = setInterval(() => {
          transitionProgress += 0.0015;
          if (transitionProgress >= 1) {
            clearInterval(dissolveInterval);
            transitionProgress = 1;
            isTransitioning = false;
            previousImages = [];
          }
        }, 30);
      }

      // Start slideshow
      async function start() {
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Start render loop immediately (will show dark until images load)
        render();
        
        // Load first batch in background, then start showing
        const firstImages = displayQueue[0];
        Promise.all(firstImages.map(preloadImage)).then(() => {
          targetImages = firstImages;
          currentAlpha = 0;
          
          // Fade in first image
          const fadeInInterval = setInterval(() => {
            currentAlpha += 0.02;
            if (currentAlpha >= 1) {
              clearInterval(fadeInInterval);
              currentAlpha = 1;
            }
          }, 30);
          
          // Start preloading next batch
          if (displayQueue.length > 1) {
            displayQueue[1].forEach(name => preloadImage(name));
          }
          
          // Start transitions after first image is showing
          setTimeout(() => {
            setInterval(transitionToNext, 8000);
          }, 3000);
        });
      }

      start();
    }

    // Initialize slideshow when DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initJeffreysSlideshow);
    } else {
      initJeffreysSlideshow();
    }

    // Language selector (dropdown)
    const langSelector = document.getElementById('langSelector');
    const langFlag = document.getElementById('lang-flag');
    const langText = document.getElementById('lang-text');
    const langDropdown = document.getElementById('lang-dropdown');
    const langOptions = langDropdown.querySelectorAll('.lang-option');
    
    // Currency selector (pills)
    const currSelector = document.getElementById('currSelector');
    const currOptions = currSelector.querySelectorAll('.curr-link');
    const currencyPickers = document.querySelectorAll('.currency-picker');

    // Language dropdown toggle
    langSelector.addEventListener('click', (e) => {
      if (e.target.closest('.lang-option')) return;
      e.stopPropagation();
      langSelector.classList.toggle('open');
    });
    
    // Close dropdown on outside click
    document.addEventListener('click', () => {
      langSelector.classList.remove('open');
    });

    // Language selection
    langOptions.forEach(opt => {
      opt.addEventListener('click', (e) => {
        e.stopPropagation();
        const lang = opt.dataset.lang;
        setLanguage(lang);
        updateLangUI(lang);
        langSelector.classList.remove('open');
        savePrefs({ lang });
      });
    });
    
    function updateLangUI(lang) {
      const langData = { en: { flag: 'üá∫üá∏', text: 'English' }, da: { flag: 'üá©üá∞', text: 'Dansk' } };
      const info = langData[lang] || langData.en;
      langFlag.textContent = info.flag;
      langText.textContent = info.text;
    }

    // Consolidated localStorage for gift preferences
    const STORAGE_KEY = 'gift-prefs';
    function getPrefs() {
      try {
        return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
      } catch { return {}; }
    }
    function savePrefs(updates) {
      const prefs = { ...getPrefs(), ...updates };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(prefs));
    }

    // Currency selection (pills)
    currOptions.forEach(opt => {
      opt.addEventListener('click', (e) => {
        e.stopPropagation();
        const curr = opt.dataset.curr;
        setCurrency(curr);
        savePrefs({ currency: curr });
      });
    });
    
    function setCurrency(curr) {
      currOptions.forEach(opt => opt.classList.toggle('active', opt.dataset.curr === curr));
      currencyPickers.forEach(picker => {
        picker.style.display = picker.dataset.for === curr ? '' : 'none';
      });
      
      // Toggle fiat vs crypto notes
      const isCrypto = curr === 'crypto';
      document.querySelectorAll('.fiat-only').forEach(el => el.style.display = isCrypto ? 'none' : '');
      document.querySelectorAll('.crypto-only').forEach(el => el.style.display = isCrypto ? '' : 'none');
    }

    // Check for thank-you mode
    const urlParams = new URLSearchParams(window.location.search);
    const isThanksMode = urlParams.has('thanks') || urlParams.get('thanks') === '1';
    const thanksAmount = urlParams.get('amount');
    const thanksCurrency = urlParams.get('currency') || 'usd';
    
    if (isThanksMode) {
      document.body.classList.add('thanks-mode');
      // Update amount display
      const amountEn = document.getElementById('thanksAmountEn');
      const amountDa = document.getElementById('thanksAmountDa');
      const formattedAmount = thanksAmount 
        ? (thanksCurrency === 'dkk' ? `${thanksAmount} kr` : `$${thanksAmount}`)
        : '$25';
      if (thanksAmount) {
        if (amountEn) amountEn.textContent = formattedAmount;
        if (amountDa) amountDa.textContent = formattedAmount;
      }
      
      // üåà PSYCHO THANKS CANVAS with pals.svg + heart behind
      const canvas = document.getElementById('thanksCanvas');
      if (canvas) {
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        
        // Cancel any previous animation
        if (window._thanksAnimFrame) {
          cancelAnimationFrame(window._thanksAnimFrame);
        }
        
        // Random start time so each gift looks different
        let t = Math.random() * 100;
        let palsImg = null;
        let palsLoaded = false;
        
        // Load pals.svg
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = () => { palsImg = img; palsLoaded = true; };
        img.src = 'https://aesthetic.computer/purple-pals.svg';
        
        function hslToRgb(h, s, l) {
          let r, g, b;
          if (s === 0) { r = g = b = l; }
          else {
            const hue2rgb = (p, q, t) => {
              if (t < 0) t += 1;
              if (t > 1) t -= 1;
              if (t < 1/6) return p + (q - p) * 6 * t;
              if (t < 1/2) return q;
              if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
              return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
          }
          return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }
        
        function drawHeart(cx, cy, size, color, glow = 0) {
          ctx.save();
          ctx.translate(cx, cy);
          ctx.beginPath();
          const s = size;
          ctx.moveTo(0, s * 0.3);
          ctx.bezierCurveTo(-s * 0.5, -s * 0.3, -s, s * 0.1, 0, s);
          ctx.bezierCurveTo(s, s * 0.1, s * 0.5, -s * 0.3, 0, s * 0.3);
          ctx.closePath();
          if (glow > 0) {
            ctx.shadowColor = color;
            ctx.shadowBlur = glow;
          }
          ctx.fillStyle = color;
          ctx.fill();
          ctx.restore();
        }
        
        function animate() {
          t += 0.025;
          
          // Background gradient that shifts
          const bgHue = (t * 0.02) % 1;
          const [bgr, bgg, bgb] = hslToRgb(bgHue, 0.15, 0.12);
          const [bgr2, bgg2, bgb2] = hslToRgb((bgHue + 0.5) % 1, 0.2, 0.08);
          const grad = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, W * 0.7);
          grad.addColorStop(0, `rgb(${bgr},${bgg},${bgb})`);
          grad.addColorStop(1, `rgb(${bgr2},${bgg2},${bgb2})`);
          ctx.fillStyle = grad;
          ctx.fillRect(0, 0, W, H);
          
          // Main color cycling
          const hue = (t * 0.08) % 1;
          
          // Floating particles in background
          for (let i = 0; i < 15; i++) {
            const px = (W * 0.1 + (i * 137.5 + t * 30) % (W * 0.8));
            const py = (H * 0.1 + (i * 89.3 + t * 20 + Math.sin(t + i) * 30) % (H * 0.8));
            const psize = 2 + Math.sin(t * 2 + i) * 1.5;
            const phue = (hue + i * 0.05) % 1;
            const [pr, pg, pb] = hslToRgb(phue, 0.8, 0.6);
            ctx.beginPath();
            ctx.arc(px, py, psize, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${pr},${pg},${pb},${0.25 + Math.sin(t * 3 + i) * 0.15})`;
            ctx.fill();
          }
          
          // Center position for the main composition
          const centerX = W / 2;
          const centerY = H / 2 - 20; // Slightly above center to leave room for text
          
          // Heart BEHIND the pals - pink tinted, larger
          const heartPulse = 1 + Math.sin(t * 3) * 0.05;
          const heartWobble = Math.sin(t * 2) * 0.03;
          
          const [r, g, b] = hslToRgb(0.92, 0.7, 0.65); // Pink
          const mainColor = `rgba(${r},${g},${b},0.5)`;
          const glowColor = `rgba(${r},${g},${b},0.3)`;
          
          ctx.save();
          ctx.translate(centerX, centerY + 60); // Heart positioned behind/below pals
          ctx.rotate(heartWobble);
          ctx.scale(heartPulse, heartPulse);
          
          // Large background heart (like in the actual logo)
          drawHeart(0, 0, 200, glowColor, 30);
          drawHeart(0, 0, 180, mainColor, 15);
          
          ctx.restore();
          
          // Draw pals.svg BIGGER and centered
          if (palsLoaded && palsImg) {
            const palsPulse = 1 + Math.sin(t * 2) * 0.02;
            const palsWobble = Math.sin(t * 1.5) * 0.015;
            const palsSize = 420 * palsPulse; // Much bigger!
            
            ctx.save();
            ctx.translate(centerX, centerY);
            ctx.rotate(palsWobble);
            ctx.drawImage(palsImg, -palsSize/2, -palsSize/2, palsSize, palsSize);
            ctx.restore();
          }
          
          // Sparkles around the composition
          for (let i = 0; i < 12; i++) {
            const angle = t * 1.2 + i * 0.52;
            const dist = 200 + Math.sin(t * 2 + i) * 20;
            const sx = centerX + Math.cos(angle) * dist;
            const sy = centerY + Math.sin(angle) * dist;
            const sparkSize = 3 + Math.sin(t * 4 + i * 2) * 2;
            const sparkHue = (hue + i * 0.08) % 1;
            const [sr, sg, sb] = hslToRgb(sparkHue, 1, 0.7);
            ctx.beginPath();
            ctx.arc(sx, sy, Math.max(1, sparkSize), 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${sr},${sg},${sb},${0.5 + Math.sin(t * 3 + i) * 0.3})`;
            ctx.fill();
          }
          
          // Amount text at bottom
          ctx.save();
          ctx.font = 'bold 36px "YWFTProcessing-Regular", sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          const textHue = (hue + 0.3) % 1;
          const [tr, tg, tb] = hslToRgb(textHue, 0.9, 0.65);
          ctx.fillStyle = `rgb(${tr},${tg},${tb})`;
          ctx.shadowColor = `rgba(${tr},${tg},${tb},0.5)`;
          ctx.shadowBlur = 15;
          ctx.fillText(`gave ${formattedAmount}`, W/2, H - 55);
          ctx.restore();
          
          // "give.aesthetic.computer" watermark
          ctx.save();
          ctx.font = '16px "berkeley", monospace';
          ctx.textAlign = 'center';
          ctx.fillStyle = 'rgba(255,255,255,0.35)';
          ctx.fillText('give.aesthetic.computer', W/2, H - 22);
          ctx.restore();
          
          window._thanksAnimFrame = requestAnimationFrame(animate);
        }
        animate();
        
        // Share to X functionality
        const shareBtn = document.getElementById('shareBtn');
        const shareBtnDa = document.getElementById('shareBtnDa');
        
        async function shareToX() {
          // Capture current canvas frame
          const dataUrl = canvas.toDataURL('image/png');
          
          // Try Web Share API first (mobile)
          if (navigator.share && navigator.canShare) {
            try {
              const blob = await (await fetch(dataUrl)).blob();
              const file = new File([blob], 'aesthetic-computer-gift.png', { type: 'image/png' });
              if (navigator.canShare({ files: [file] })) {
                await navigator.share({
                  text: `I just gave ${formattedAmount} to Aesthetic.Computer! üíñ give.aesthetic.computer`,
                  files: [file]
                });
                return;
              }
            } catch (e) {
              console.log('Web Share failed, falling back to Twitter intent');
            }
          }
          
          // Fallback: Download image + open Twitter
          const link = document.createElement('a');
          link.download = 'aesthetic-computer-gift.png';
          link.href = dataUrl;
          link.click();
          
          // Open Twitter intent
          const tweetText = encodeURIComponent(`I just gave ${formattedAmount} to Aesthetic.Computer! üíñ\n\ngive.aesthetic.computer`);
          window.open(`https://twitter.com/intent/tweet?text=${tweetText}`, '_blank');
        }
        
        if (shareBtn) shareBtn.addEventListener('click', shareToX);
        if (shareBtnDa) shareBtnDa.addEventListener('click', shareToX);
      }
    }

    // Load saved preferences or detect from browser
    const savedPrefs = getPrefs();
    let currentLang = savedPrefs.lang;
    if (!currentLang) {
      currentLang = navigator.language.startsWith('da') ? 'da' : 'en';
    }
    setLanguage(currentLang);
    updateLangUI(currentLang);
    
    // Restore saved currency
    if (savedPrefs.currency) {
      setCurrency(savedPrefs.currency);
    } else if (currentLang === 'da') {
      setCurrency('dkk');
    } else {
      setCurrency('usd');
    }

    function setLanguage(lang) {
      currentLang = lang;
      document.body.classList.toggle('lang-da', lang === 'da');

      // Update fiat button text (skip crypto widgets)
      document.querySelectorAll('.gift-widget:not(.crypto)').forEach(widget => {
        const currency = widget.dataset.currency;
        const slider = widget.querySelector('input[type="range"]');
        if (!slider) return;
        const value = parseInt(slider.value);
        const btn = widget.querySelector('.gift-btn');
        const isMonthly = widget._isMonthly ? widget._isMonthly() : false;
        const fmtValue = value.toLocaleString();
        if (currency === 'dkk') {
          btn.textContent = lang === 'da' ? `Giv ${fmtValue} kr` : `Give ${fmtValue} kr`;
        } else if (isMonthly) {
          btn.textContent = lang === 'da' ? `Giv $${fmtValue}/m√•ned` : `Give $${fmtValue}/month`;
        } else {
          btn.textContent = lang === 'da' ? `Giv $${fmtValue}` : `Give $${fmtValue}`;
        }
      });
      
      // Update crypto send button text
      document.querySelectorAll('.gift-widget.crypto').forEach(widget => {
        const slider = widget.querySelector('.crypto-slider');
        const sendBtn = widget.querySelector('.crypto-send');
        if (slider && sendBtn) {
          const currency = slider.dataset.currency;
          const value = currency === 'eth' ? parseFloat(slider.value).toFixed(2) : parseInt(slider.value);
          const symbol = currency === 'eth' ? 'Œû' : 'Íú©';
          sendBtn.textContent = lang === 'da' ? `Send ${value} ${symbol}` : `Send ${value} ${symbol}`;
        }
      });
    }

    // Slider functionality
    document.querySelectorAll('.gift-widget:not(.crypto)').forEach(widget => {
      const currency = widget.dataset.currency;
      const slider = widget.querySelector('input[type="range"]');
      const amountEl = widget.querySelector('.gift-amount');
      const btn = widget.querySelector('.gift-btn');
      const monthlyCheck = widget.querySelector('.monthly-checkbox');
      const monthlyLabel = widget.querySelector('.gift-monthly-check');
      let isMonthly = false;

      // Monthly checkbox
      if (monthlyCheck) {
        monthlyCheck.addEventListener('change', () => {
          isMonthly = monthlyCheck.checked;
          monthlyLabel.classList.toggle('checked', isMonthly);
          widget.classList.toggle('monthly-mode', isMonthly);
          
          // Adjust slider range for monthly vs one-time
          if (isMonthly) {
            slider.min = currency === 'dkk' ? 25 : 1;
            slider.max = currency === 'dkk' ? 3500 : 500;
            slider.step = currency === 'dkk' ? 25 : 1;
            if (parseInt(slider.value) > parseInt(slider.max)) slider.value = currency === 'dkk' ? 175 : 25;
          } else {
            slider.min = currency === 'dkk' ? 25 : 1;
            slider.max = currency === 'usd' ? 2500 : currency === 'dkk' ? 17500 : 500;
            slider.step = currency === 'dkk' ? 25 : 1;
          }
          update();
        });
      }

      function format(v) {
        const formatted = v.toLocaleString();
        return currency === 'dkk' ? `${formatted} kr` : `$${formatted}`;
      }

      const investSuggestion = widget.querySelector('.invest-suggestion');
      const conversionEl = currency === 'dkk' ? document.getElementById('dkkConversion') : null;
      const logoEl = widget.querySelector('.gift-logo');
      
      // Conversion rates (approximate)
      const USD_TO_DKK = 7.0;  // ~7 DKK per USD
      const USD_TO_XTZ = 0.85; // ~$1.18 per XTZ
      const USD_TO_ETH = 0.00029; // ~$3400 per ETH
      const USD_TO_BTC = 0.0000105; // ~$95000 per BTC

      // Character wiggle animation - only shake at intensity 4, colors change earlier
      let wiggleAnimId = null;
      function startWiggle(intensity) {
        if (wiggleAnimId) return;
        const t0 = performance.now();
        // Only shake at intensity 4
        const speed = intensity >= 4 ? 30 : 0;
        const amplitude = intensity >= 4 ? 3 : 0;
        
        function animate() {
          const t = (performance.now() - t0) / 1000;
          const chars = amountEl.querySelectorAll('.wiggle-char');
          chars.forEach((char, i) => {
            const hue = ((t * 60 * intensity) + i * 40) % 360;
            // Only translate at intensity 4
            if (intensity >= 4) {
              const x = Math.sin(t * speed + i * 2) * amplitude;
              const y = Math.cos(t * speed * 1.3 + i * 3) * amplitude;
              char.style.transform = `translate(${x}px, ${y}px)`;
            } else {
              char.style.transform = '';
            }
            // Colors change at intensity 2+
            if (intensity >= 2) {
              char.style.color = `hsl(${hue}, 100%, ${intensity >= 3 ? 75 : 60}%)`;
            }
          });
          wiggleAnimId = requestAnimationFrame(animate);
        }
        animate();
      }
      
      function stopWiggle() {
        if (wiggleAnimId) {
          cancelAnimationFrame(wiggleAnimId);
          wiggleAnimId = null;
        }
        const chars = amountEl.querySelectorAll('.wiggle-char');
        chars.forEach(char => {
          char.style.transform = '';
          char.style.color = '';
        });
      }

      function update() {
        const value = parseInt(slider.value);
        const suffix = isMonthly ? '/mo' : '';
        const text = format(value) + suffix;
        
        // Create wiggling characters
        amountEl.innerHTML = text.split('').map(c => 
          `<span class="wiggle-char">${c === ' ' ? '&nbsp;' : c}</span>`
        ).join('');
        
        const lang = document.body.classList.contains('lang-da') ? 'da' : 'en';
        if (currency === 'dkk') {
          btn.textContent = lang === 'da' ? `Giv ${format(value)}` : `Give ${format(value)}`;
        } else if (isMonthly) {
          btn.textContent = lang === 'da' ? `Giv ${format(value)}/m√•ned` : `Give ${format(value)}/month`;
        } else {
          btn.textContent = lang === 'da' ? `Giv ${format(value)}` : `Give ${format(value)}`;
        }
        
        // Show invest suggestion for USD at $1000+
        if (investSuggestion && currency === 'usd' && !isMonthly) {
          investSuggestion.style.display = value >= 1000 ? 'block' : 'none';
        }
        
        // Vegas intensity for USD (and DKK equivalent) - applies to both one-time and monthly
        if (currency === 'usd') {
          // Remove all intensity and effect classes
          amountEl.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4', 'flames', 'lightning');
          logoEl?.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          slider.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          conversionEl?.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          
          // Add appropriate intensity based on value (starts from $1)
          let intensity = 0;
          if (value >= 1500) {
            intensity = 4;
          } else if (value >= 300) {
            intensity = 3;
          } else if (value >= 75) {
            intensity = 2;
          } else if (value >= 1) {
            intensity = 1;
          }
          
          if (intensity > 0) {
            amountEl.classList.add(`intensity-${intensity}`);
            logoEl?.classList.add(`intensity-${intensity}`);
            slider.classList.add(`intensity-${intensity}`);
            conversionEl?.classList.add(`intensity-${intensity}`);
            startWiggle(intensity);
          } else {
            stopWiggle();
          }
          
          // Special effects for max amounts
          if (isMonthly && value >= 500) {
            // Max monthly ($500/mo) - flames
            amountEl.classList.add('flames');
          } else if (!isMonthly && value >= 2500) {
            // Max one-time ($2500) - flames + lightning
            amountEl.classList.add('flames', 'lightning');
          }
          
        } else if (currency === 'dkk') {
          // Vegas intensity for DKK (convert to USD equivalent for thresholds)
          const usdEquiv = value / USD_TO_DKK;
          amountEl.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          logoEl?.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          slider.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          conversionEl?.classList.remove('intensity-1', 'intensity-2', 'intensity-3', 'intensity-4');
          
          let intensity = 0;
          if (usdEquiv >= 1500) {
            intensity = 4;
          } else if (usdEquiv >= 300) {
            intensity = 3;
          } else if (usdEquiv >= 75) {
            intensity = 2;
          } else if (usdEquiv >= 1) {
            intensity = 1;
          }
          
          if (intensity > 0) {
            amountEl.classList.add(`intensity-${intensity}`);
            logoEl?.classList.add(`intensity-${intensity}`);
            slider.classList.add(`intensity-${intensity}`);
            conversionEl?.classList.add(`intensity-${intensity}`);
            startWiggle(intensity);
          } else {
            stopWiggle();
          }
          
          // Show currency conversions for DKK -> USD only
          if (conversionEl) {
            const usd = Math.round(usdEquiv);
            conversionEl.innerHTML = `<span>‚âà $${usd}</span>`;
          }
        }
      }

      slider.addEventListener('input', () => {
        update();
      });
      
      update();
      
      // Store isMonthly state on widget for button handler
      widget._isMonthly = () => isMonthly;
    });

    // Invest link click handler - scroll and blink
    document.querySelectorAll('.invest-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const investSection = document.getElementById('invest');
        if (investSection) {
          // Scroll to invest section
          investSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Add blinking animation after scroll completes
          setTimeout(() => {
            investSection.classList.add('blinking');
            // Remove class after animation completes
            setTimeout(() => {
              investSection.classList.remove('blinking');
            }, 1800); // 3 blinks √ó 0.6s
          }, 400); // Wait for scroll to start
        }
      });
    });

    // Direct checkout (no modal)
    async function goToCheckout(amount, currency, isMonthly, btn) {
      const origText = btn.textContent;
      btn.disabled = true;
      btn.textContent = currentLang === 'da' ? 'Omdirigerer...' : 'Redirecting...';

      try {
        const res = await fetch('https://aesthetic.computer/api/give', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ amount: amount * 100, currency, recurring: isMonthly })
        });
        const data = await res.json();
        if (data.url) window.location.href = data.url;
        else throw new Error(data.error || 'No URL returned');
      } catch (err) {
        console.error('Give error:', err);
        btn.disabled = false;
        btn.textContent = origText;
        alert(currentLang === 'da' ? 'Noget gik galt' : 'Something went wrong');
      }
    }

    document.querySelectorAll('.gift-widget:not(.crypto) .gift-btn').forEach(btn => {
      btn.onclick = () => {
        const currency = btn.dataset.currency;
        const widget = btn.closest('.gift-widget');
        const slider = widget.querySelector('input[type="range"]');
        const value = parseInt(slider.value);
        const isMonthly = widget._isMonthly ? widget._isMonthly() : false;
        
        goToCheckout(value, currency, isMonthly, btn);
      };
    });

    function copyAddress(el) {
      const text = el.dataset.copy;
      navigator.clipboard.writeText(text);
      el.classList.add('copied');
      
      // Update hint text to "Copied!"
      const hints = el.querySelectorAll('.crypto-copy-hint');
      hints.forEach(hint => {
        const origText = hint.textContent;
        hint.textContent = '‚úì ' + (hint.dataset.lang === 'da' ? 'Kopieret!' : 'Copied!');
        setTimeout(() => hint.textContent = origText, 1200);
      });
      
      setTimeout(() => el.classList.remove('copied'), 1200);
    }

    // Make crypto addresses/labels copyable
    document.querySelectorAll('.copyable').forEach(el => {
      el.addEventListener('click', () => copyAddress(el));
    });

    // Crypto prices
    let cryptoPrices = { xtz: null, eth: null };
    
    async function fetchCryptoPrices() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tezos,ethereum&vs_currencies=usd');
        const data = await res.json();
        cryptoPrices.xtz = data.tezos?.usd || null;
        cryptoPrices.eth = data.ethereum?.usd || null;
        updateAllCryptoDisplays();
      } catch (e) {
        console.log('Could not fetch crypto prices');
      }
    }
    
    function updateAllCryptoDisplays() {
      document.querySelectorAll('.crypto-slider').forEach(slider => {
        const currency = slider.dataset.currency;
        const widget = slider.closest('.gift-widget');
        updateCryptoDisplay(widget, slider, currency);
      });
    }
    
    function updateCryptoDisplay(widget, slider, currency) {
      const amountEl = widget.querySelector('.gift-amount');
      const sendBtn = widget.querySelector('.crypto-send');
      const usdEl = widget.querySelector('.crypto-usd');
      
      const value = currency === 'eth' ? parseFloat(slider.value).toFixed(2) : parseInt(slider.value);
      const symbol = currency === 'eth' ? 'Œû' : 'Íú©';
      const emoji = currency === 'eth' ? 'üíé' : 'üîÆ';
      
      amountEl.textContent = `${emoji} ${value} ${symbol}`;
      sendBtn.textContent = `Send ${value} ${symbol}`;
      
      const price = cryptoPrices[currency];
      if (price && usdEl) {
        const usdValue = (parseFloat(value) * price).toFixed(2);
        usdEl.textContent = `‚âà $${usdValue}`;
      }
    }

    // Crypto slider functionality
    document.querySelectorAll('.crypto-slider').forEach(slider => {
      const widget = slider.closest('.gift-widget');
      const currency = slider.dataset.currency;
      
      slider.addEventListener('input', () => updateCryptoDisplay(widget, slider, currency));
      updateCryptoDisplay(widget, slider, currency);
    });
    
    // Fetch prices on load
    fetchCryptoPrices();

    // Tezos wallet connect (Beacon)
    async function sendTezos(amount) {
      const btn = document.querySelector('[data-currency="xtz"].crypto-send');
      const origText = btn.textContent;
      
      try {
        btn.textContent = currentLang === 'da' ? 'Forbinder...' : 'Connecting...';
        btn.disabled = true;
        
        // Use Beacon SDK via script tag approach
        if (!window.beacon) {
          // Load Beacon SDK
          await new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/@airgap/beacon-sdk@4.0.12/dist/walletbeacon.min.js';
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
          });
        }
        
        const client = new window.beacon.DAppClient({ name: 'Aesthetic Computer Gift' });
        
        btn.textContent = currentLang === 'da' ? 'V√¶lg tegnebog...' : 'Select wallet...';
        await client.requestPermissions();
        
        btn.textContent = currentLang === 'da' ? 'Bekr√¶ft i tegnebog...' : 'Confirm in wallet...';
        const response = await client.requestOperation({
          operationDetails: [{
            kind: 'transaction',
            destination: 'tz1WqvhbfEwfqAzMtEGxc7x6tpSqRMCNKPCT',
            amount: String(Math.floor(amount * 1000000)), // mutez
            fee: '1500',        // suggested fee in mutez (~0.0015 XTZ)
            gasLimit: '10600',  // typical gas for simple transfer
            storageLimit: '300' // typical storage for simple transfer
          }]
        });
        
        btn.textContent = currentLang === 'da' ? '‚úì Sendt!' : '‚úì Sent!';
        console.log('TX:', response.transactionHash);
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 3000);
        
      } catch (err) {
        console.error('Tezos error:', err);
        btn.textContent = err.message?.includes('Aborted') 
          ? (currentLang === 'da' ? 'Annulleret' : 'Cancelled')
          : (currentLang === 'da' ? 'Fejl - pr√∏v igen' : 'Error - try again');
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 2000);
      }
    }

    // Ethereum wallet connect
    async function sendEthereum(amount) {
      const btn = document.querySelector('[data-currency="eth"].crypto-send');
      const origText = btn.textContent;
      
      try {
        btn.textContent = currentLang === 'da' ? 'Forbinder...' : 'Connecting...';
        btn.disabled = true;
        
        if (!window.ethereum) {
          alert(currentLang === 'da' ? 'Install√©r MetaMask eller en anden Ethereum-tegnebog' : 'Please install MetaMask or another Ethereum wallet');
          throw new Error('No wallet');
        }
        
        btn.textContent = currentLang === 'da' ? 'Godkend forbindelse...' : 'Approve connection...';
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        
        if (!accounts.length) throw new Error('No account');
        
        const amountWei = '0x' + (BigInt(Math.floor(amount * 1e18))).toString(16);
        
        btn.textContent = currentLang === 'da' ? 'Bekr√¶ft i tegnebog...' : 'Confirm in wallet...';
        const txHash = await window.ethereum.request({
          method: 'eth_sendTransaction',
          params: [{
            from: accounts[0],
            to: '0x1D64E3eFa983D945cBFe29Ad5b3C8ABB53Aef023',
            value: amountWei
          }]
        });
        
        btn.textContent = currentLang === 'da' ? '‚úì Sendt!' : '‚úì Sent!';
        console.log('TX:', txHash);
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 3000);
        
      } catch (err) {
        console.error('Ethereum error:', err);
        if (err.message !== 'No wallet') {
          btn.textContent = currentLang === 'da' ? 'Annulleret' : 'Cancelled';
        }
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 2000);
      }
    }

    // Wire up crypto send buttons
    document.querySelectorAll('.crypto-send').forEach(btn => {
      btn.addEventListener('click', () => {
        const widget = btn.closest('.gift-widget');
        const slider = widget.querySelector('.crypto-slider');
        const currency = slider.dataset.currency;
        const value = currency === 'eth' ? parseFloat(slider.value) : parseInt(slider.value);
        
        if (currency === 'xtz') {
          sendTezos(value);
        } else if (currency === 'eth') {
          sendEthereum(value);
        }
      });
    });

    // Live reload in dev mode
    if (location.hostname === 'localhost' || location.hostname.includes('local')) {
      const wsUrl = location.protocol === 'https:' 
        ? 'wss://localhost:8889' 
        : 'ws://localhost:8889';
      
      function connectWS() {
        const ws = new WebSocket(wsUrl);
        ws.onopen = () => console.log('üîÑ Live reload connected');
        ws.onmessage = (e) => {
          try {
            const msg = JSON.parse(e.data);
            if (msg.type === 'reload' && msg.content?.piece === '*refresh*') {
              console.log('üîÑ Reloading...');
              location.reload();
            }
          } catch {}
        };
        ws.onclose = () => setTimeout(connectWS, 2000);
        ws.onerror = () => ws.close();
      }
      connectWS();
    }

    // Fetch shop products - rotating display with image cycling
    let shopProducts = [];
    let shopIndex = 0;
    let shopImageIndex = 0;
    let shopProgressAnim = null;
    let shopImageInterval = null;
    const SHOP_IMAGE_INTERVAL = 2500; // 2.5 seconds between images within same product
    const SHOP_PRODUCT_INTERVAL = 4000; // Base interval, extended per image count
    
    function animateShopProgress(duration) {
      const progressBar = document.getElementById('shopAutoProgress');
      if (!progressBar) return;
      
      let startTime = null;
      
      function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const elapsed = timestamp - startTime;
        const pct = Math.min((elapsed / duration) * 100, 100);
        progressBar.style.width = pct + '%';
        
        if (elapsed < duration) {
          shopProgressAnim = requestAnimationFrame(step);
        }
      }
      
      if (shopProgressAnim) cancelAnimationFrame(shopProgressAnim);
      progressBar.style.width = '0%';
      shopProgressAnim = requestAnimationFrame(step);
    }
    
    async function loadShopProducts() {
      const container = document.getElementById('shopProducts');
      try {
        const res = await fetch('https://aesthetic.computer/api/shop');
        const data = await res.json();
        
        if (!data.products?.length) {
          container.innerHTML = '<div class="shop-loading">No products available</div>';
          return;
        }
        
        shopProducts = data.products;
        showShopProduct(0);
        startShopCycle();
      } catch (e) {
        console.error('Shop load error:', e);
        container.innerHTML = '<a href="https://shop.aesthetic.computer" class="shop-loading">Visit shop ‚Üí</a>';
      }
    }
    
    function startShopCycle() {
      // Clear any existing intervals
      if (shopImageInterval) clearInterval(shopImageInterval);
      
      const p = shopProducts[shopIndex];
      if (!p) return;
      
      const images = p.images || [p.imageUrl].filter(Boolean);
      shopImageIndex = 0;
      
      if (images.length > 1) {
        // Multiple images: cycle through them, then advance product
        const totalDuration = images.length * SHOP_IMAGE_INTERVAL;
        animateShopProgress(totalDuration);
        
        shopImageInterval = setInterval(() => {
          shopImageIndex++;
          if (shopImageIndex >= images.length) {
            // All images shown, advance to next product
            clearInterval(shopImageInterval);
            shopIndex = (shopIndex + 1) % shopProducts.length;
            shopImageIndex = 0;
            showShopProduct(shopIndex);
            startShopCycle();
          } else {
            // Show next image of same product
            updateShopImage(shopImageIndex);
          }
        }, SHOP_IMAGE_INTERVAL);
      } else {
        // Single image: just use standard interval
        animateShopProgress(SHOP_PRODUCT_INTERVAL);
        
        shopImageInterval = setInterval(() => {
          clearInterval(shopImageInterval);
          shopIndex = (shopIndex + 1) % shopProducts.length;
          shopImageIndex = 0;
          showShopProduct(shopIndex);
          startShopCycle();
        }, SHOP_PRODUCT_INTERVAL);
      }
    }
    
    function updateShopImage(imgIndex) {
      const p = shopProducts[shopIndex];
      if (!p) return;
      
      const images = p.images || [p.imageUrl].filter(Boolean);
      if (!images.length) return;
      
      const img = document.querySelector('.shop-product img');
      if (img) {
        img.style.opacity = '0';
        setTimeout(() => {
          img.src = images[imgIndex];
          img.style.opacity = '1';
        }, 150);
      }
    }
    
    function showShopProduct(index) {
      const container = document.getElementById('shopProducts');
      const p = shopProducts[index];
      if (!p) return;
      
      // Get all images
      const images = p.images || [p.imageUrl].filter(Boolean);
      const currentImage = images.length > 0 ? images[0] : '';
      
      // Extract vendor from product data if available
      const vendor = p.vendor || '';
      const vendorHtml = vendor ? `<div class="shop-product-vendor"><a href="https://aesthetic.computer/@${vendor.replace('@', '')}" target="_blank">${vendor.startsWith('@') ? vendor : '@' + vendor}</a></div>` : '';
      
      // Process description - collapse newlines, truncate
      const desc = (p.description || '').replace(/\n+/g, ' ').replace(/\s+/g, ' ').trim();
      const shortDesc = desc.length > 120 ? desc.slice(0, 120).trim() + '‚Ä¶' : desc;
      const descHtml = shortDesc ? `<div class="shop-product-desc">${escapeHtml(shortDesc)}</div>` : '';
      
      container.innerHTML = `
        <a href="${p.shopUrl}" class="shop-product" target="_blank">
          <div class="shop-product-img-wrap">
            <img src="${currentImage}" alt="${escapeHtml(p.title)}" loading="lazy" style="transition: opacity 0.15s;">
          </div>
          <div class="shop-product-overlay">
            <div class="shop-product-top">
              <div class="shop-product-title">${escapeHtml(p.title)}</div>
              ${vendorHtml}
            </div>
            <div class="shop-product-info">
              ${descHtml}
              ${p.available 
                ? `<div class="shop-product-price">${p.price}</div>`
                : `<div class="shop-product-sold">SOLD</div>`
              }
            </div>
          </div>
        </a>
      `;
    }
    setTimeout(loadShopProducts, 100);

    // Load stats from metrics API
    async function loadStats() {
      try {
        const res = await fetch('https://aesthetic.computer/api/metrics');
        const data = await res.json();
        
        const fmt = n => n?.toLocaleString() || '‚Äî';
        
        // Update stat values
        const handlesEl = document.querySelector('#stat-handles .stat-value');
        const paintingsEl = document.querySelector('#stat-paintings .stat-value');
        const moodsEl = document.querySelector('#stat-moods .stat-value');
        const commandsEl = document.querySelector('#stat-commands .stat-value');
        const messagesEl = document.querySelector('#stat-messages .stat-value');
        
        if (handlesEl) handlesEl.textContent = fmt(data.handles);
        if (paintingsEl) paintingsEl.textContent = fmt(data.paintings);
        if (moodsEl) moodsEl.textContent = fmt(data.moods);
        // Commands = pieces + prompts (from docs)
        const commandCount = (data.pieces || 0) + 107; // 107 prompts from docs.js
        if (commandsEl) commandsEl.textContent = fmt(commandCount);
        // Messages = chatMessages (laer-klokken + chat combined)
        if (messagesEl) messagesEl.textContent = fmt(data.chatMessages);
        
      } catch (e) {
        console.warn('Could not load stats:', e);
      }
    }
    setTimeout(loadStats, 200);

    // KidLisp count - loaded after apiBase is defined (see below)

    // Format detailed timestamp for gives
    // Returns { time: string, useOn: boolean } - useOn=true for date-based times
    function formatGiveTime(timestamp) {
      if (!timestamp || typeof timestamp !== 'number') return { time: '', useOn: false };
      const date = new Date(timestamp);
      const now = new Date();
      const isToday = date.toDateString() === now.toDateString();
      const isYesterday = new Date(now - 86400000).toDateString() === date.toDateString();
      
      const time = date.toLocaleTimeString('en-US', { 
        hour: 'numeric', 
        minute: '2-digit',
        hour12: true 
      }).toLowerCase();
      
      if (isToday) return { time: `today at ${time}`, useOn: false };
      if (isYesterday) return { time: `yesterday at ${time}`, useOn: false };
      
      const diff = now - date;
      const days = Math.floor(diff / 86400000);
      if (days < 7) {
        const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
        return { time: `${dayName} at ${time}`, useOn: true };
      }
      
      const dateStr = date.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric',
        year: date.getFullYear() !== now.getFullYear() ? 'numeric' : undefined
      });
      return { time: dateStr, useOn: true };
    }

    // Gives - load from Stripe via API and display as horizontal ticker
    async function loadRecentGives() {
      const ticker = document.getElementById('givesTicker');
      const ctaMessage = currentLang === 'da' 
        ? 'At give til AC holder tjenester online og gratis at bruge, og hj√¶lper<a href="https://aesthetic.computer/@jeffrey" class="pink-handle">@jeffrey</a>med at udvikle nye funktioner.'
        : 'Giving to AC keeps services online and free to use, and helps<a href="https://aesthetic.computer/@jeffrey" class="pink-handle">@jeffrey</a>develop new features.';
      
      try {
        // Use local function endpoint in dev, production URL otherwise
        const isDev = window.location.hostname === 'localhost' || window.location.hostname.includes('local.');
        const givesUrl = isDev 
          ? 'https://localhost:8888/.netlify/functions/gives'
          : 'https://aesthetic.computer/api/gives';
        const res = await fetch(givesUrl);
        const data = await res.json();
        
        if (!data.gives?.length) {
          // Show CTA message scrolling in the ticker when no gives
          const ctaItem = `<span class="gives-ticker-item gives-ticker-cta-item">${ctaMessage}</span>`;
          ticker.innerHTML = `<div class="gives-ticker-track">${ctaItem}${ctaItem}${ctaItem}</div>`;
          // Adjust speed for CTA-only ticker
          const track = ticker.querySelector('.gives-ticker-track');
          if (track) {
            const contentWidth = track.scrollWidth / 3;
            const speed = Math.max(20, contentWidth / 35);
            track.style.animationDuration = `${speed}s`;
          }
          return;
        }
        
        givesData = data.gives;
        
        // Build horizontal ticker items - "Got $5 today" or "Got $5 on Dec 15" format
        const items = givesData.map(give => {
          const { time: timeStr, useOn } = formatGiveTime(give.createdAt);
          const hasNote = give.note && give.note.trim();
          const noteHtml = hasNote ? `<span class="sep">:</span><span class="note">${give.note}</span>` : '';
          const timeHtml = useOn ? `<span class="time">on ${timeStr}</span>` : `<span class="time">${timeStr}</span>`;
          
          // Monthly donations show with /mo suffix and yellow styling
          if (give.isRecurring) {
            return `<span class="gives-ticker-item monthly"><span class="got">Got</span><span class="amount">${give.amountDisplay}/mo</span>${timeHtml}${noteHtml}</span>`;
          }
          
          return `<span class="gives-ticker-item"><span class="got">Got</span><span class="amount">${give.amountDisplay}</span>${timeHtml}${noteHtml}</span>`;
        }).join('');
        
        // Add CTA as a ticker item with special styling
        const ctaItem = `<span class="gives-ticker-item gives-ticker-cta-item">${ctaMessage}</span>`;
        
        // Duplicate content multiple times to ensure seamless infinite scroll
        ticker.innerHTML = `<div class="gives-ticker-track">${ctaItem}${items}${ctaItem}${items}${ctaItem}${items}</div>`;
        
        // Adjust animation speed based on content length (content is tripled)
        const track = ticker.querySelector('.gives-ticker-track');
        if (track) {
          const contentWidth = track.scrollWidth / 3; // one-third since tripled
          const speed = Math.max(15, contentWidth / 40); // ~40px per second
          track.style.animationDuration = `${speed}s`;
        }
        
        setLanguage(currentLang);
      } catch (e) {
        console.error('Gives load error:', e);
        ticker.innerHTML = '<div class="gives-ticker-empty">Unable to load gives</div>';
      }
    }
    
    setTimeout(loadRecentGives, 300);

    // Determine API base URL (relative for local dev, absolute for production)
    const apiBase = window.location.hostname === 'localhost' || window.location.hostname.includes('local.')
      ? '' // Use relative URLs in dev
      : 'https://aesthetic.computer';

    // KidLisp count from dedicated endpoint
    async function loadKidlispCount() {
      try {
        const res = await fetch(`${apiBase}/api/kidlisp-count`);
        const data = await res.json();
        const count = data.count || 0;
        
        const el = document.querySelector('#stat-kidlisp .stat-value');
        if (el && count) el.textContent = count.toLocaleString();
      } catch (e) {
        console.warn('Could not load kidlisp count:', e);
      }
    }
    setTimeout(loadKidlispCount, 400);

    // TV video feed - load and cycle through tape videos
    let tvTapes = [];
    let tvIndex = 0;
    let tvPlayer = null;
    let tvErrorCount = 0;
    const TV_MAX_ERRORS = 5; // Stop trying after too many consecutive errors
    
    async function loadTVFeed() {
      const container = document.getElementById('tvPlayer');
      try {
        const res = await fetch(`${apiBase}/api/tv?types=tape&limit=20&filter=recent`);
        const data = await res.json();
        
        // Get tapes from mixed array or media.tapes
        const tapes = data.mixed || data.media?.tapes || [];
        // Filter for tapes with completed MP4s (most reliable), then any with videoUrl
        tvTapes = tapes.filter(item => 
          item.media?.videoUrl && item.media?.mp4Status === "complete"
        );
        
        // Fallback to any tape with videoUrl if no complete MP4s
        if (!tvTapes.length) {
          tvTapes = tapes.filter(item => item.media?.videoUrl);
        }
        
        if (!tvTapes.length) {
          container.innerHTML = '<div class="tv-no-signal">No signal</div>';
          return;
        }
        
        playTVVideo(0);
      } catch (e) {
        console.error('TV load error:', e);
        container.innerHTML = '<div class="tv-no-signal">No signal</div>';
      }
    }
    
    function playTVVideo(index) {
      const container = document.getElementById('tvPlayer');
      const header = document.getElementById('tvHeader');
      const tape = tvTapes[index];
      if (!tape) {
        container.innerHTML = '<div class="tv-no-signal">No signal</div>';
        return;
      }
      
      // Update header with current tape code
      const tapeCode = tape.code ? `!${tape.code}` : 'tapes';
      if (header) header.innerHTML = `<strong>${tapeCode}</strong>`;
      
      // Mark old slide as exiting
      const oldSlide = container.querySelector('.tv-slide');
      if (oldSlide) {
        oldSlide.classList.add('exiting');
        setTimeout(() => oldSlide.remove(), 400);
      }
      
      // Create new slide
      const slide = document.createElement('div');
      slide.className = 'tv-slide entering';
      slide.innerHTML = `
        <video 
          src="${tape.media.videoUrl}" 
          muted 
          playsinline 
          autoplay
        ></video>
      `;
      container.appendChild(slide);
      
      // Ensure progress bar and timer exist (only once)
      if (!container.querySelector('.tv-progress')) {
        const progressEl = document.createElement('div');
        progressEl.className = 'tv-progress';
        progressEl.innerHTML = '<div class="tv-progress-bar"></div>';
        container.appendChild(progressEl);
      }
      if (!container.querySelector('.tv-timer')) {
        const timerEl = document.createElement('span');
        timerEl.className = 'tv-timer';
        timerEl.textContent = '0:00 / 0:00';
        container.appendChild(timerEl);
      }
      
      tvPlayer = slide.querySelector('video');
      const progressBar = container.querySelector('.tv-progress-bar');
      const timerEl = container.querySelector('.tv-timer');
      
      // Format seconds as m:ss
      function formatTime(sec) {
        const m = Math.floor(sec / 60);
        const s = Math.floor(sec % 60);
        return `${m}:${s.toString().padStart(2, '0')}`;
      }
      
      // Toggle play/pause
      function togglePlayback(e) {
        e.preventDefault();
        e.stopPropagation();
        const indicator = container.querySelector('.tv-play-indicator');
        if (tvPlayer.paused) {
          tvPlayer.play();
          if (indicator) indicator.classList.remove('paused');
        } else {
          tvPlayer.pause();
          if (indicator) indicator.classList.add('paused');
        }
      }
      
      // Add play/pause indicator
      if (!container.querySelector('.tv-play-indicator')) {
        const indicator = document.createElement('div');
        indicator.className = 'tv-play-indicator';
        container.appendChild(indicator);
      }
      
      // Make video, timer, and header clickable to pause/play
      slide.addEventListener('click', togglePlayback);
      timerEl.addEventListener('click', togglePlayback);
      header.addEventListener('click', (e) => {
        // Only toggle if not navigating (let link work on right-click)
        if (e.button === 0) togglePlayback(e);
      });
      
      // Attach all event listeners once
      function attachListeners() {
        // Update progress bar and timer
        tvPlayer.addEventListener('timeupdate', () => {
          if (tvPlayer.duration) {
            const pct = (tvPlayer.currentTime / tvPlayer.duration) * 100;
            progressBar.style.width = pct + '%';
            // Update timer: current / total
            const current = formatTime(tvPlayer.currentTime);
            const total = formatTime(tvPlayer.duration);
            if (timerEl) timerEl.textContent = `${current} / ${total}`;
          }
        });
        
        tvPlayer.addEventListener('ended', () => {
          tvErrorCount = 0; // Reset error count on successful play
          tvIndex = (tvIndex + 1) % tvTapes.length;
          playTVVideo(tvIndex);
        });
        tvPlayer.addEventListener('canplay', () => {
          tvErrorCount = 0; // Reset error count when video loads successfully
        });
        tvPlayer.addEventListener('error', () => {
          tvErrorCount++;
          if (tvErrorCount >= TV_MAX_ERRORS) {
            container.innerHTML = '<div class="tv-no-signal">No signal</div>';
            return;
          }
          // Skip broken videos
          tvIndex = (tvIndex + 1) % tvTapes.length;
          setTimeout(() => playTVVideo(tvIndex), 500);
        });
      }
      
      attachListeners();
      
      tvPlayer.play().catch(() => {
        // Autoplay blocked - add click overlay (keep video and listeners intact)
        const overlay = document.createElement('div');
        overlay.className = 'tv-loading';
        overlay.style.cursor = 'pointer';
        overlay.textContent = '‚ñ∂Ô∏è';
        overlay.onclick = () => {
          tvPlayer.play();
          overlay.remove();
        };
        container.insertBefore(overlay, container.firstChild);
      });
    }
    setTimeout(loadTVFeed, 500);
    
    // Linkify text - parse URLs, @handles, 'prompts', #paintings
    // Works on raw text, escapes only plain text segments
    function linkifyText(text) {
      // Parse elements with positions on RAW text (before escaping)
      const elements = [];
      
      // URLs (http://, https://, www.)
      const urlRegex = /(https?:\/\/[^\s<]+|www\.[^\s<]+)/gi;
      let match;
      while ((match = urlRegex.exec(text)) !== null) {
        elements.push({ type: 'url', text: match[0], start: match.index, end: match.index + match[0].length });
      }
      
      // @handles
      const handleRegex = /@[a-z0-9]+([._][a-z0-9]+)*/gi;
      while ((match = handleRegex.exec(text)) !== null) {
        // Don't match inside URLs
        const inUrl = elements.some(e => e.type === 'url' && match.index >= e.start && match.index < e.end);
        if (!inUrl) {
          elements.push({ type: 'handle', text: match[0], start: match.index, end: match.index + match[0].length });
        }
      }
      
      // 'prompts' (single-quoted words)
      const promptRegex = /'([^']+)'/g;
      while ((match = promptRegex.exec(text)) !== null) {
        const inUrl = elements.some(e => e.type === 'url' && match.index >= e.start && match.index < e.end);
        if (!inUrl) {
          elements.push({ type: 'prompt', text: match[0], inner: match[1], start: match.index, end: match.index + match[0].length });
        }
      }
      
      // #paintings (hashtag codes)
      const paintingRegex = /#[a-z0-9]+/gi;
      while ((match = paintingRegex.exec(text)) !== null) {
        const inUrl = elements.some(e => e.type === 'url' && match.index >= e.start && match.index < e.end);
        if (!inUrl) {
          elements.push({ type: 'painting', text: match[0], start: match.index, end: match.index + match[0].length });
        }
      }
      
      // Sort by position
      elements.sort((a, b) => a.start - b.start);
      
      // Build result string - escape plain text, but not the HTML links we create
      let result = '';
      let lastEnd = 0;
      
      for (const el of elements) {
        // Add escaped text before this element
        result += escapeHtml(text.slice(lastEnd, el.start));
        
        // Add linked element (escape the display text)
        if (el.type === 'url') {
          const href = el.text.startsWith('www.') ? 'https://' + el.text : el.text;
          result += `<a href="${escapeHtml(href)}" class="chat-link-url" target="_blank" rel="noopener">${escapeHtml(el.text)}</a>`;
        } else if (el.type === 'handle') {
          result += `<a href="https://aesthetic.computer/${escapeHtml(el.text)}" class="chat-link-handle" target="_blank">${escapeHtml(el.text)}</a>`;
        } else if (el.type === 'prompt') {
          result += `<a href="https://aesthetic.computer/${escapeHtml(el.inner)}" class="chat-link-prompt" target="_blank">${escapeHtml(el.text)}</a>`;
        } else if (el.type === 'painting') {
          const code = el.text.slice(1); // Remove #
          result += `<a href="https://aesthetic.computer/painting~${escapeHtml(code)}" class="chat-link-painting" target="_blank">${escapeHtml(el.text)}</a>`;
        }
        
        lastEnd = el.end;
      }
      
      // Add remaining escaped text
      result += escapeHtml(text.slice(lastEnd));
      
      return result;
    }
    
    // Extract painting codes from text and generate thumbnail HTML
    function getPaintingThumbnails(text) {
      const codes = [];
      const paintingRegex = /#([a-z0-9]+)/gi;
      let match;
      while ((match = paintingRegex.exec(text)) !== null) {
        codes.push(match[1]);
      }
      if (!codes.length) return '';
      
      const thumbs = codes.map(code => `
        <div class="chat-painting-thumb">
          <a href="https://aesthetic.computer/painting~${escapeHtml(code)}" target="_blank">
            <img 
              src="https://art.aesthetic.computer/${escapeHtml(code)}.png" 
              alt="#${escapeHtml(code)}"
              loading="lazy"
              onload="this.classList.add('loaded')"
              onerror="this.parentElement.parentElement.style.display='none'"
            >
            <span class="thumb-code">#${escapeHtml(code)}</span>
          </a>
        </div>
      `).join('');
      
      return `<div class="chat-painting-thumbs">${thumbs}</div>`;
    }
    
    // Chat Messages - L√¶er-Klokken messages (scrolling list)
    async function loadChatMessages() {
      const container = document.getElementById('chatMessages');
      try {
        const res = await fetch(`${apiBase}/api/chat/messages?instance=clock&limit=25`);
        const data = await res.json();
        const messages = data.messages || [];
        
        if (!messages.length) {
          container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">No messages yet</div></div>';
          return;
        }
        
        // Messages come oldest-first from API, we want newest at top
        const html = messages.map(msg => {
          const when = new Date(msg.when);
          const ago = formatTimeAgo(when);
          // API returns 'from' field with '@' prefix if handle exists
          const handle = msg.from || 'anon';
          const thumbs = getPaintingThumbnails(msg.text || '');
          return `
            <div class="chat-msg">
              <div class="chat-msg-header">
                <a href="https://aesthetic.computer/${handle}" class="chat-handle">${handle}</a>
                <span class="chat-time">${ago}</span>
              </div>
              <div class="chat-text">${linkifyText(msg.text || '')}</div>
              ${thumbs}
            </div>
          `;
        }).reverse().join('');
        
        container.innerHTML = html;
        
      } catch (e) {
        console.error('Chat load error:', e);
        container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Could not load</div></div>';
      }
    }
    
    function formatTimeAgo(date) {
      const now = new Date();
      const diff = now - date;
      const mins = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (mins < 1) return 'just now';
      if (mins < 60) return `${mins}m ago`;
      if (hours < 24) return `${hours}h ago`;
      if (days < 7) return `${days}d ago`;
      return date.toLocaleDateString();
    }
    
    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    
    setTimeout(loadChatMessages, 600);
    
    // Auto-scroll chat messages
    function autoScrollChat(containerId, speed = 0.5) {
      const container = document.getElementById(containerId);
      if (!container) return;
      
      let scrollPos = 0;
      let isPaused = false;
      
      // Pause on hover
      container.addEventListener('mouseenter', () => isPaused = true);
      container.addEventListener('mouseleave', () => isPaused = false);
      
      function scroll() {
        if (!isPaused && container.scrollHeight > container.clientHeight) {
          scrollPos += speed;
          // Reset to top when reaching bottom
          if (scrollPos >= container.scrollHeight - container.clientHeight) {
            scrollPos = 0;
          }
          container.scrollTop = scrollPos;
        }
        requestAnimationFrame(scroll);
      }
      requestAnimationFrame(scroll);
    }
    
    // Start auto-scroll for both chat containers at different speeds
    setTimeout(() => {
      autoScrollChat('chatMessages', 0.25);      // laer-klokken: slower
      autoScrollChat('chatSystemMessages', 0.35); // chat: slightly faster
    }, 2000); // Wait for content to load
    
    // Chat System Messages (back face of flip card)
    async function loadChatSystemMessages() {
      const container = document.getElementById('chatSystemMessages');
      if (!container) return;
      try {
        const res = await fetch(`${apiBase}/api/chat/messages?instance=system&limit=25`);
        const data = await res.json();
        const messages = data.messages || [];
        
        if (!messages.length) {
          container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">No messages yet</div></div>';
          return;
        }
        
        // Messages come oldest-first from API, we want newest at top
        const html = messages.map(msg => {
          const when = new Date(msg.when);
          const ago = formatTimeAgo(when);
          const handle = msg.from || 'anon';
          const thumbs = getPaintingThumbnails(msg.text || '');
          return `
            <div class="chat-msg">
              <div class="chat-msg-header">
                <a href="https://aesthetic.computer/${handle}" class="chat-handle">${handle}</a>
                <span class="chat-time">${ago}</span>
              </div>
              <div class="chat-text">${linkifyText(msg.text || '')}</div>
              ${thumbs}
            </div>
          `;
        }).reverse().join('');
        
        container.innerHTML = html;
        
      } catch (e) {
        console.error('Chat system load error:', e);
        container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Could not load</div></div>';
      }
    }
    
    setTimeout(loadChatSystemMessages, 700);
    
    // Flip card toggle function with direction support
    function toggleChatFlip(direction) {
      const card = document.getElementById('chatFlipCard');
      const container = document.querySelector('.chat-flip-container');
      if (card && container) {
        const isFlipped = card.classList.contains('flipped');
        // If direction specified, only flip if it makes sense
        if (direction === 'left' && isFlipped) {
          card.classList.remove('flipped');
          container.classList.remove('flipped');
          resetFlipProgress();
        } else if (direction === 'right' && !isFlipped) {
          card.classList.add('flipped');
          container.classList.add('flipped');
          resetFlipProgress();
        } else if (!direction) {
          card.classList.toggle('flipped');
          container.classList.toggle('flipped');
          resetFlipProgress();
        }
      }
    }
    // Expose to global scope for onclick
    window.toggleChatFlip = toggleChatFlip;
    
    // Hover tilt effect for swivel preview
    function setupHoverTilt() {
      const container = document.querySelector('.chat-flip-container');
      const card = document.getElementById('chatFlipCard');
      if (!container || !card) return;
      
      container.addEventListener('mousemove', (e) => {
        if (card.classList.contains('flipped')) return; // Don't tilt when flipped
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const width = rect.width;
        const third = width / 3;
        
        card.classList.remove('tilt-left', 'tilt-right');
        if (x < third) {
          card.classList.add('tilt-left');
        } else if (x > third * 2) {
          card.classList.add('tilt-right');
        }
      });
      
      container.addEventListener('mouseleave', () => {
        card.classList.remove('tilt-left', 'tilt-right');
      });
      
      // Click zones for directional swivel
      container.addEventListener('click', (e) => {
        // Don't trigger if clicking on a link or explicit trigger
        if (e.target.closest('a') || e.target.closest('.chat-flip-trigger')) return;
        
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const width = rect.width;
        const isFlipped = card.classList.contains('flipped');
        
        if (x < width / 2) {
          // Left side - swivel to show front (unflip)
          if (isFlipped) toggleChatFlip('left');
        } else {
          // Right side - swivel to show back (flip)
          if (!isFlipped) toggleChatFlip('right');
        }
      });
    }
    setTimeout(setupHoverTilt, 100);
    
    // Auto-flip with progress bar
    const FLIP_INTERVAL = 12000; // 12 seconds between flips
    let flipProgress = 0;
    let flipPaused = false;
    
    function resetFlipProgress() {
      flipProgress = 0;
      const bar = document.getElementById('chatFlipProgress');
      const barBack = document.getElementById('chatFlipProgressBack');
      if (bar) bar.style.width = '0%';
      if (barBack) barBack.style.width = '0%';
    }
    
    function updateFlipProgress() {
      const bar = document.getElementById('chatFlipProgress');
      const barBack = document.getElementById('chatFlipProgressBack');
      const card = document.getElementById('chatFlipCard');
      const container = document.querySelector('.chat-flip-container');
      const isFlipped = card && card.classList.contains('flipped');
      
      // Pause on hover
      if (container && !container.dataset.hoverBound) {
        container.dataset.hoverBound = 'true';
        container.addEventListener('mouseenter', () => flipPaused = true);
        container.addEventListener('mouseleave', () => flipPaused = false);
      }
      
      if (!flipPaused) {
        flipProgress += 100 / (FLIP_INTERVAL / 100); // Update every 100ms
        // Only update the visible face's progress bar
        if (isFlipped) {
          if (barBack) barBack.style.width = flipProgress + '%';
          if (bar) bar.style.width = '0%';
        } else {
          if (bar) bar.style.width = flipProgress + '%';
          if (barBack) barBack.style.width = '0%';
        }
        
        if (flipProgress >= 100) {
          toggleChatFlip();
          // resetFlipProgress is called inside toggleChatFlip
        }
      }
      
      setTimeout(updateFlipProgress, 100);
    }
    
    // Start auto-flip after a short delay
    setTimeout(updateFlipProgress, 3000);
    
    // KidLisp Carousel - Single rotating preview with animated WebP and syntax highlighting
    const OVEN_URL = 'https://oven.aesthetic.computer';
    
    async function loadKidlispCarousel() {
      const carousel = document.getElementById('kidlispCarousel');
      try {
        // Fetch top hits from the TV API
        const res = await fetch(`${apiBase}/api/tv?types=kidlisp&sort=hits&limit=20`);
        const data = await res.json();
        const hits = data.media?.kidlisp || data.mixed || [];
        
        if (!hits.length) {
          carousel.innerHTML = '<div style="text-align: center; color: #555; padding: 2em;">No pieces found</div>';
          return;
        }
        
        // KidLisp syntax highlighter - matches kidlisp.com/index.html
        function highlightKidlisp(code) {
          if (!code) return '';
          // Escape HTML first
          let html = code
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
          
          // Use token placeholders to prevent double-replacement
          // Use \x01T{idx}T\x01 format to avoid number regex matching the idx
          const tokens = [];
          function token(match, cls) {
            const idx = tokens.length;
            tokens.push(`<span class="${cls}">${match}</span>`);
            return `\x01T${idx}T\x01`;
          }
          
          // Order matters - most specific first
          // Comments (lines starting with ;)
          html = html.replace(/(^|\n)(;[^\n]*)/g, (m, pre, comment) => pre + token(comment, 'hl-comment'));
          // Timing patterns - match kidlisp.mjs exactly:
          // 1. Cycle timers: 2s..., 3f..., 0.5s... (number + s/f + one or more dots)
          // 2. Delay timers: 1s, 0.5s, 3f, 1s! (number + s/f + optional !)
          // Match from start of token (after space or open paren) to avoid partial matches
          // Include data-duration for dynamic animation timing
          html = html.replace(/(^|[\s(])(\d*\.?\d+)([sf](\.{1,3}|!?))/g, (m, pre, num, suffix) => {
            const full = num + suffix;
            const unit = suffix[0]; // 's' or 'f'
            // Convert to seconds (frames assume 60fps)
            const duration = unit === 's' ? parseFloat(num) : parseFloat(num) / 60;
            const idx = tokens.length;
            tokens.push(`<span class="hl-timing hl-timing-active" data-duration="${duration}">${full}</span>`);
            return pre + `\x01T${idx}T\x01`;
          });
          // Strings
          html = html.replace(/("[^"]*")/g, m => token(m, 'hl-string'));
          // Numbers (now safe since timing already tokenized)
          html = html.replace(/\b(\d+\.?\d*)\b/g, m => token(m, 'hl-number'));
          // Keywords (control flow)
          const keywords = ['def', 'fn', 'if', 'cond', 'let', 'loop', 'repeat', 'later', 'tap', 'drag', 'lift', 'key', 'draw', 'frame', 'now', 'once'];
          keywords.forEach(kw => {
            html = html.replace(new RegExp(`\\b(${kw})\\b`, 'g'), m => token(m, 'hl-keyword'));
          });
          // API calls (drawing/commands)
          const apiCalls = ['wipe', 'ink', 'line', 'box', 'circle', 'text', 'pan', 'zoom', 'blur', 'noise', 'width', 'height', 'rainbow', 'wiggle', 'grid', 'plot', 'stamp', 'scroll', 'contrast', 'fps'];
          apiCalls.forEach(api => {
            html = html.replace(new RegExp(`\\b(${api})\\b`, 'g'), m => token(m, 'hl-api'));
          });
          // Colors
          const colors = ['black', 'white', 'red', 'green', 'blue', 'yellow', 'cyan', 'magenta', 'orange', 'purple', 'pink', 'brown', 'gray', 'grey', 'lime'];
          colors.forEach(c => {
            html = html.replace(new RegExp(`\\b(${c})\\b`, 'g'), m => token(m, 'hl-color'));
          });
          // Parens
          html = html.replace(/([()])/g, m => token(m, 'hl-paren'));
          
          // Replace tokens back
          html = html.replace(/\x01T(\d+)T\x01/g, (_, idx) => tokens[parseInt(idx)]);
          return html;
        }
        
        // Create all slides (hidden initially)
        const slides = hits.slice(0, 8);
        let currentSlide = 0;
        let slideInterval = null;
        
        carousel.innerHTML = slides.map((item, i) => {
          const code = item.code || 'unknown';
          const hitCount = item.hits || 0;
          const source = item.source || '';
          const author = item.handle || item.author || '';
          const pieceUrl = `https://kidlisp.com/$${code}`;
          
          // Truncate source to fit in preview (more generous for single view)
          const truncatedSource = source.length > 400 ? source.slice(0, 400) + '...' : source;
          const highlighted = highlightKidlisp(truncatedSource);
          
          const authorHtml = author && author !== 'anon' ? `<div class="kidlisp-slide-author">@${escapeHtml(author)}</div>` : '';
          
          return `
            <div class="kidlisp-slide${i === 0 ? ' active' : ''}" data-index="${i}" data-code="${escapeHtml(code)}" data-hits="${hitCount}">
              <a href="${pieceUrl}" target="_blank" title="Play $${escapeHtml(code)}">
                <div class="kidlisp-slide-loading"></div>
              </a>
              <div class="kidlisp-slide-code">${highlighted}</div>
              <div class="kidlisp-slide-qr-wrap">
                <div class="kidlisp-slide-label">$${escapeHtml(code)}</div>
                <div class="kidlisp-slide-qr" data-url="${pieceUrl}"></div>
              </div>
              <div class="kidlisp-slide-plays">‚ñ∂ ${hitCount.toLocaleString()}</div>
              ${authorHtml}
            </div>
          `;
        }).join('');
        
        // Apply timing durations to all timing elements
        carousel.querySelectorAll('.hl-timing-active[data-duration]').forEach(el => {
          const duration = parseFloat(el.dataset.duration) || 1;
          // Clamp duration between 0.1s and 10s for reasonable animation
          const clampedDuration = Math.max(0.1, Math.min(duration, 10));
          el.style.setProperty('--timing-duration', clampedDuration + 's');
        });
        
        // Advance to next slide
        function nextSlide() {
          const slideEls = carousel.querySelectorAll('.kidlisp-slide');
          if (slideEls.length <= 1) return;
          
          const current = slideEls[currentSlide];
          currentSlide = (currentSlide + 1) % slideEls.length;
          const next = slideEls[currentSlide];
          
          // Transition
          current.classList.remove('active');
          current.classList.add('exiting');
          next.classList.add('active');
          
          // Clean up exiting class after transition
          setTimeout(() => current.classList.remove('exiting'), 500);
          
          // Restart progress bar
          animateKidlispProgress();
        }
        
        // Progress bar animation
        const KIDLISP_INTERVAL = 6000;
        let kidlispProgressAnim = null;
        
        function animateKidlispProgress() {
          const progressBar = document.getElementById('kidlispAutoProgress');
          if (!progressBar) return;
          
          let startTime = null;
          
          function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;
            const pct = Math.min((elapsed / KIDLISP_INTERVAL) * 100, 100);
            progressBar.style.width = pct + '%';
            
            if (elapsed < KIDLISP_INTERVAL) {
              kidlispProgressAnim = requestAnimationFrame(step);
            }
          }
          
          if (kidlispProgressAnim) cancelAnimationFrame(kidlispProgressAnim);
          progressBar.style.width = '0%';
          kidlispProgressAnim = requestAnimationFrame(step);
        }
        
        // Start initial progress animation
        animateKidlispProgress();
        
        // Start rotation every 6 seconds (match webp duration)
        slideInterval = setInterval(nextSlide, KIDLISP_INTERVAL);
        
        // No pause on hover - slides continue advancing
        
        // Load webp images for all slides (staggered to not overwhelm oven)
        const slideEls = carousel.querySelectorAll('.kidlisp-slide');
        for (let i = 0; i < slideEls.length; i++) {
          const slide = slideEls[i];
          const code = slide.dataset.code;
          // Stagger each request by 300ms
          if (i > 0) await new Promise(r => setTimeout(r, 300));
          
          const webpUrl = `${OVEN_URL}/grab/webp/256/256/$${code}?duration=6000&fps=10&quality=85&density=1`;
          const img = document.createElement('img');
          img.src = webpUrl;
          img.alt = code;
          img.loading = i === 0 ? 'eager' : 'lazy';
          img.onload = () => {
            img.classList.add('loaded');
            const loader = slide.querySelector('.kidlisp-slide-loading');
            if (loader) loader.remove();
          };
          img.onerror = () => {
            const link = slide.querySelector('a');
            if (link) link.innerHTML = '<div style="color:#444;font-size:0.8em;padding:2em;">‚ö†Ô∏è</div>';
          };
          
          const link = slide.querySelector('a');
          if (link) {
            link.innerHTML = '';
            link.appendChild(img);
          }
          
          // Generate QR code for this slide
          const qrContainer = slide.querySelector('.kidlisp-slide-qr');
          if (qrContainer && typeof qrcode !== 'undefined') {
            try {
              const qrUrl = `https://kidlisp.com/$${code}`;
              const qrGen = qrcode(0, 'L');
              qrGen.addData(qrUrl);
              qrGen.make();
              // Use SVG for better rendering
              const svg = qrGen.createSvgTag(2, 0);
              qrContainer.innerHTML = svg;
              const svgEl = qrContainer.querySelector('svg');
              if (svgEl) {
                svgEl.style.display = 'block';
                svgEl.style.width = '32px';
                svgEl.style.height = '32px';
              }
            } catch (e) {
              console.error('QR generation error:', e);
            }
          }
        }
        
      } catch (e) {
        console.error('KidLisp carousel load error:', e);
        carousel.innerHTML = '<div style="text-align: center; color: #555; padding: 2em;">Could not load</div>';
      }
    }
    
    setTimeout(loadKidlispCarousel, 800);
    
    // Desktop Release Info - Fetch from GitHub
    async function loadDesktopReleaseInfo() {
      try {
        const res = await fetch('https://api.github.com/repos/whistlegraph/aesthetic-computer/releases/latest');
        if (!res.ok) return;
        
        const release = await res.json();
        
        // Update version badge
        const versionEl = document.getElementById('desktopVersion');
        if (versionEl) versionEl.textContent = release.tag_name;
        
        // Parse release name
        const nameEl = document.getElementById('releaseName');
        if (nameEl) nameEl.textContent = release.name || release.tag_name;
        
        // Format date
        const dateEl = document.getElementById('releaseDate');
        if (dateEl && release.published_at) {
          const date = new Date(release.published_at);
          dateEl.textContent = date.toLocaleDateString('en-US', { 
            year: 'numeric', month: 'short', day: 'numeric' 
          });
        }
        
        // Parse changelog - convert markdown to list items
        const changelogEl = document.getElementById('releaseChangelog');
        if (changelogEl && release.body) {
          const body = release.body;
          const items = [];
          
          // Extract list items from markdown
          const lines = body.split('\n');
          for (const line of lines) {
            // Match "- **Something** - Description" or "- **Something**" or "- Item"
            const boldMatch = line.match(/^[\-\*]\s*\*\*(.+?)\*\*\s*[-‚Äì]?\s*(.*)$/);
            const simpleMatch = line.match(/^[\-\*]\s+(.+)$/);
            
            if (boldMatch) {
              const [, bold, rest] = boldMatch;
              items.push(`<strong>${bold}</strong>${rest ? ' ‚Äî ' + rest : ''}`);
            } else if (simpleMatch && !simpleMatch[1].startsWith('**')) {
              items.push(simpleMatch[1]);
            }
          }
          
          if (items.length > 0) {
            changelogEl.innerHTML = items.map(i => `<li>${i}</li>`).join('');
          } else {
            changelogEl.innerHTML = '<li>See release notes for details</li>';
          }
        }
        
      } catch (e) {
        console.warn('Could not load release info:', e);
        const changelogEl = document.getElementById('releaseChangelog');
        if (changelogEl) changelogEl.innerHTML = '<li>Could not load changelog</li>';
      }
    }
    
    // Fetch VS Code extension version from marketplace
    async function loadVSCodeExtVersion() {
      try {
        // Use the VS Code Marketplace API
        const res = await fetch('https://marketplace.visualstudio.com/_apis/public/gallery/extensionquery', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json;api-version=6.0-preview.1'
          },
          body: JSON.stringify({
            filters: [{
              criteria: [{ filterType: 7, value: 'aesthetic-computer.aesthetic-computer-code' }]
            }],
            flags: 0x200 // Include versions
          })
        });
        
        if (res.ok) {
          const data = await res.json();
          const ext = data.results?.[0]?.extensions?.[0];
          if (ext?.versions?.[0]?.version) {
            const versionEl = document.getElementById('vscodeExtVersion');
            if (versionEl) versionEl.textContent = 'v' + ext.versions[0].version;
          }
        }
      } catch (e) {
        console.warn('Could not load VS Code extension version:', e);
      }
    }
    
    setTimeout(loadDesktopReleaseInfo, 900);
    setTimeout(loadVSCodeExtVersion, 1000);

    // Apps Flip Card - Desktop / Mobile swivel
    function toggleAppsFlip(direction) {
      const card = document.getElementById('appsFlipCard');
      const container = document.getElementById('appsFlipContainer');
      if (card && container) {
        const isFlipped = card.classList.contains('flipped');
        // If direction specified, only flip if it makes sense
        if (direction === 'left' && isFlipped) {
          card.classList.remove('flipped');
          container.classList.remove('flipped');
          resetAppsFlipProgress();
        } else if (direction === 'right' && !isFlipped) {
          card.classList.add('flipped');
          container.classList.add('flipped');
          resetAppsFlipProgress();
        } else if (!direction) {
          card.classList.toggle('flipped');
          container.classList.toggle('flipped');
          resetAppsFlipProgress();
        }
      }
    }
    window.toggleAppsFlip = toggleAppsFlip;
    
    // Apps flip hover tilt effect
    (function setupAppsHoverTilt() {
      const container = document.getElementById('appsFlipContainer');
      const card = document.getElementById('appsFlipCard');
      if (!container || !card) return;
      
      container.addEventListener('mousemove', (e) => {
        if (card.classList.contains('flipped')) return; // Don't tilt when flipped
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const width = rect.width;
        const third = width / 3;
        
        card.classList.remove('tilt-left', 'tilt-right');
        if (x < third) {
          card.classList.add('tilt-left');
        } else if (x > third * 2) {
          card.classList.add('tilt-right');
        }
      });
      
      container.addEventListener('mouseleave', () => {
        card.classList.remove('tilt-left', 'tilt-right');
      });
      
      // Click zones for directional swivel
      container.addEventListener('click', (e) => {
        // Don't trigger if clicking on a link
        if (e.target.closest('a')) return;
        
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const width = rect.width;
        const isFlipped = card.classList.contains('flipped');
        
        if (x < width / 2) {
          // Left side - swivel to show front (unflip)
          if (isFlipped) toggleAppsFlip('left');
        } else {
          // Right side - swivel to show back (flip)
          if (!isFlipped) toggleAppsFlip('right');
        }
      });
    })();
    
    // Apps flip auto-flip with progress bar
    const APPS_FLIP_INTERVAL = 10000; // 10 seconds between flips
    let appsFlipProgress = 0;
    
    function resetAppsFlipProgress() {
      appsFlipProgress = 0;
      const bar = document.getElementById('appsFlipProgress');
      const barMobile = document.getElementById('appsFlipProgressMobile');
      if (bar) bar.style.width = '0%';
      if (barMobile) barMobile.style.width = '0%';
    }
    
    function updateAppsFlipProgress() {
      const bar = document.getElementById('appsFlipProgress');
      const barMobile = document.getElementById('appsFlipProgressMobile');
      const card = document.getElementById('appsFlipCard');
      const isFlipped = card && card.classList.contains('flipped');
      
      appsFlipProgress += 100 / (APPS_FLIP_INTERVAL / 100); // Update every 100ms
      // Only update the visible face's progress bar
      if (isFlipped) {
        if (barMobile) barMobile.style.width = appsFlipProgress + '%';
        if (bar) bar.style.width = '0%';
      } else {
        if (bar) bar.style.width = appsFlipProgress + '%';
        if (barMobile) barMobile.style.width = '0%';
      }
      
      if (appsFlipProgress >= 100) {
        toggleAppsFlip();
      }
      
      setTimeout(updateAppsFlipProgress, 100);
    }
    
    // Start apps auto-flip after a short delay
    setTimeout(updateAppsFlipProgress, 2000);

    // üé® Floating Paintings in Stats
    async function loadFloatingPaintings() {
      const statItem = document.getElementById('stat-paintings');
      if (!statItem) return;
      
      const floatersContainer = statItem.querySelector('.stat-floaters');
      if (!floatersContainer) return;
      
      try {
        // Fetch paintings from TV endpoint
        const res = await fetch(`${apiBase}/api/tv?types=painting&limit=50`);
        if (!res.ok) throw new Error('Failed to fetch paintings');
        
        const data = await res.json();
        const paintings = data.media?.paintings || [];
        if (!paintings.length) {
          console.log('No paintings found');
          return;
        }
        console.log(`Loaded ${paintings.length} paintings for floating`);
        
        // Group paintings by handle and take max 3-4 per user for variety
        const byHandle = {};
        for (const p of paintings) {
          if (!p.media?.url) continue;
          if (!p.owner?.handle) continue;
          const h = p.owner.handle;
          if (!byHandle[h]) byHandle[h] = [];
          if (byHandle[h].length < 4) byHandle[h].push(p);
        }
        
        // Interleave paintings from different handles
        const mixed = [];
        const handles = Object.keys(byHandle);
        let moreToAdd = true;
        let idx = 0;
        while (moreToAdd) {
          moreToAdd = false;
          for (const h of handles) {
            if (byHandle[h][idx]) {
              mixed.push(byHandle[h][idx]);
              moreToAdd = true;
            }
          }
          idx++;
        }
        
        // Don't preload all - lazy load as needed
        let index = 0;
        
        function spawnFloater() {
          if (!mixed.length) return;
          
          const p = mixed[index % mixed.length];
          index++;
          
          const floater = document.createElement('div');
          floater.className = 'stat-floater';
          
          // Random pixel size: 2x (32px), 3x (48px), or 4x (64px)
          const sizes = [32, 48, 64];
          const size = sizes[Math.floor(Math.random() * sizes.length)];
          
          // Random horizontal position (5% to 95%)
          const xPos = 5 + Math.random() * 90;
          floater.style.left = `calc(${xPos}% - ${size/2}px)`;
          floater.style.bottom = '-20px';
          
          // Random duration between 10-20s (independent of size)
          const duration = 10 + Math.random() * 10;
          floater.style.setProperty('--float-duration', `${duration}s`);
          
          // Thumbnail - lazy load this image
          const thumb = document.createElement('img');
          thumb.src = p.media.url;
          thumb.alt = p.code || 'painting';
          thumb.style.width = `${size}px`;
          thumb.style.height = `${size}px`;
          thumb.loading = 'lazy';
          floater.appendChild(thumb);
          
          // Code label
          if (p.code) {
            const code = document.createElement('span');
            code.className = 'floater-code';
            code.style.fontSize = '0.8em';
            code.style.color = 'var(--gold)';
            code.textContent = `#${p.code}`;
            floater.appendChild(code);
          }
          
          floatersContainer.appendChild(floater);
          
          // Remove after animation completes
          floater.addEventListener('animationend', () => floater.remove());
        }
        
        // Spawn one immediately, then every 3 seconds
        spawnFloater();
        setInterval(spawnFloater, 3000);
        
      } catch (e) {
        console.warn('Could not load floating paintings:', e);
      }
    }
    
    setTimeout(loadFloatingPaintings, 2000);

    // üè∑Ô∏è Floating Handles in Stats
    async function loadFloatingHandles() {
      const statItem = document.getElementById('stat-handles');
      if (!statItem) return;
      
      const floatersContainer = statItem.querySelector('.stat-floaters');
      if (!floatersContainer) return;
      
      try {
        // Get handles from moods API (each mood has a handle)
        const res = await fetch(`${apiBase}/api/mood/all`);
        if (!res.ok) throw new Error('Failed to fetch moods for handles');
        
        const data = await res.json();
        const moods = data.moods || [];
        
        // Extract unique handles
        const handleSet = new Set();
        for (const m of moods) {
          if (m.handle) handleSet.add(m.handle);
        }
        const handles = Array.from(handleSet);
        
        if (!handles.length) return;
        console.log(`Loaded ${handles.length} unique handles for floating`);
        
        let index = 0;
        
        function spawnFloater() {
          const handle = handles[index % handles.length];
          index++;
          
          const floater = document.createElement('div');
          
          // Randomly choose left or right direction
          const goRight = Math.random() > 0.5;
          floater.className = goRight ? 'stat-floater float-horizontal-right' : 'stat-floater float-horizontal';
          
          // Random vertical position (10% to 90%)
          const yPos = 10 + Math.random() * 80;
          floater.style.top = `${yPos}%`;
          if (goRight) {
            floater.style.left = '-80px';
          } else {
            floater.style.right = '-50px';
          }
          
          // Random duration between 8-14s
          const duration = 8 + Math.random() * 6;
          floater.style.setProperty('--float-duration', `${duration}s`);
          
          // Handle text
          const text = document.createElement('span');
          text.className = 'floater-code';
          text.style.fontSize = '0.9em';
          text.style.color = 'var(--cyan)';
          text.textContent = handle;
          floater.appendChild(text);
          
          floatersContainer.appendChild(floater);
          floater.addEventListener('animationend', () => floater.remove());
        }
        
        spawnFloater();
        setInterval(spawnFloater, 4000);
        
      } catch (e) {
        console.warn('Could not load floating handles:', e);
      }
    }
    
    setTimeout(loadFloatingHandles, 2500);

    // üòä Floating Moods in Stats
    async function loadFloatingMoods() {
      const statItem = document.getElementById('stat-moods');
      if (!statItem) return;
      
      const floatersContainer = statItem.querySelector('.stat-floaters');
      if (!floatersContainer) return;
      
      try {
        const res = await fetch(`${apiBase}/api/mood/all`);
        if (!res.ok) throw new Error('Failed to fetch moods');
        
        const data = await res.json();
        const moods = data.moods || [];
        
        // Group by handle, max 3 per user for variety
        const byHandle = {};
        for (const m of moods) {
          if (!m.mood || !m.handle) continue;
          if (!byHandle[m.handle]) byHandle[m.handle] = [];
          if (byHandle[m.handle].length < 3) byHandle[m.handle].push(m);
        }
        
        // Interleave moods from different handles
        const mixed = [];
        const handles = Object.keys(byHandle);
        let moreToAdd = true;
        let idx = 0;
        while (moreToAdd) {
          moreToAdd = false;
          for (const h of handles) {
            if (byHandle[h][idx]) {
              mixed.push(byHandle[h][idx]);
              moreToAdd = true;
            }
          }
          idx++;
        }
        
        if (!mixed.length) return;
        console.log(`Loaded ${mixed.length} moods from ${handles.length} users for floating`);
        
        let index = 0;
        
        function spawnFloater() {
          const m = mixed[index % mixed.length];
          index++;
          
          const floater = document.createElement('div');
          
          // Randomly choose left or right direction
          const goRight = Math.random() > 0.5;
          floater.className = goRight ? 'stat-floater float-horizontal-right' : 'stat-floater float-horizontal';
          
          // Random vertical position (10% to 90%)
          const yPos = 10 + Math.random() * 80;
          floater.style.top = `${yPos}%`;
          if (goRight) {
            floater.style.left = '-80px';
          } else {
            floater.style.right = '-50px';
          }
          
          // Random duration between 10-18s (moods float slower)
          const duration = 10 + Math.random() * 8;
          floater.style.setProperty('--float-duration', `${duration}s`);
          
          // Mood text (truncate if too long)
          const text = document.createElement('span');
          text.className = 'floater-code';
          text.style.fontSize = '0.7em';
          text.style.maxWidth = '80px';
          text.style.overflow = 'hidden';
          text.style.textOverflow = 'ellipsis';
          text.style.color = 'var(--gold)';
          const moodText = m.mood.length > 20 ? m.mood.slice(0, 18) + '‚Ä¶' : m.mood;
          text.textContent = moodText;
          floater.appendChild(text);
          
          floatersContainer.appendChild(floater);
          floater.addEventListener('animationend', () => floater.remove());
        }
        
        spawnFloater();
        setInterval(spawnFloater, 3500);
        
      } catch (e) {
        console.warn('Could not load floating moods:', e);
      }
    }
    
    setTimeout(loadFloatingMoods, 3000);

    // üíª Floating KidLisp Codes in Stats
    async function loadFloatingKidlisp() {
      const statItem = document.getElementById('stat-kidlisp');
      if (!statItem) return;
      
      const floatersContainer = statItem.querySelector('.stat-floaters');
      if (!floatersContainer) return;
      
      try {
        const res = await fetch(`${apiBase}/api/tv?types=kidlisp&limit=100`);
        if (!res.ok) throw new Error('Failed to fetch kidlisp');
        
        const data = await res.json();
        const kidlisps = data.media?.kidlisp || [];
        
        // Group by handle, max 4 per user for variety
        const byHandle = {};
        for (const k of kidlisps) {
          if (!k.code) continue;
          const h = k.owner?.handle || 'anonymous';
          if (!byHandle[h]) byHandle[h] = [];
          if (byHandle[h].length < 4) byHandle[h].push(k);
        }
        
        // Interleave from different handles
        const mixed = [];
        const handles = Object.keys(byHandle);
        let moreToAdd = true;
        let idx = 0;
        while (moreToAdd) {
          moreToAdd = false;
          for (const h of handles) {
            if (byHandle[h][idx]) {
              mixed.push(byHandle[h][idx]);
              moreToAdd = true;
            }
          }
          idx++;
        }
        
        if (!mixed.length) return;
        console.log(`Loaded ${mixed.length} kidlisp codes from ${handles.length} users for floating`);
        
        let index = 0;
        
        function spawnFloater() {
          const k = mixed[index % mixed.length];
          index++;
          
          const floater = document.createElement('div');
          floater.className = 'stat-floater';
          
          // Random horizontal position (5% to 95%)
          const xPos = 5 + Math.random() * 90;
          floater.style.left = `${xPos}%`;
          floater.style.bottom = '-20px';
          
          // Random duration between 10-18s
          const duration = 10 + Math.random() * 8;
          floater.style.setProperty('--float-duration', `${duration}s`);
          
          // Code text
          const text = document.createElement('span');
          text.className = 'floater-code';
          text.style.fontSize = '0.8em';
          text.style.color = 'var(--magenta)';
          text.textContent = `$${k.code}`;
          floater.appendChild(text);
          
          floatersContainer.appendChild(floater);
          floater.addEventListener('animationend', () => floater.remove());
        }
        
        spawnFloater();
        setInterval(spawnFloater, 3000);
        
      } catch (e) {
        console.warn('Could not load floating kidlisp:', e);
      }
    }
    
    setTimeout(loadFloatingKidlisp, 3500);

    // üß© Floating Commands (pieces + prompts) in Stats
    async function loadFloatingCommands() {
      const statItem = document.getElementById('stat-commands');
      if (!statItem) return;
      
      const floatersContainer = statItem.querySelector('.stat-floaters');
      if (!floatersContainer) return;
      
      try {
        // Fetch pieces from API
        const res = await fetch(`${apiBase}/api/piece-hit?top=50`);
        if (!res.ok) throw new Error('Failed to fetch pieces');
        
        const data = await res.json();
        const pieces = (data.pieces || []).filter(p => {
          return p.piece && !p.piece.startsWith('api/') && !p.piece.includes('.');
        }).map(p => ({ name: p.piece, type: 'piece' }));
        
        // Hard-coded prompts (commands you type in prompt)
        const prompts = [
          'tape', 'cut', 'keep', 'mint', 'print', 'scream', 'me', 'selfie',
          'cam', 'flower', 'petal', 'sparkle', 'done', 'tezos', 'notifs',
          'bro', 'sis', 'bf', 'gf', 'email', 'handle', 'logout', 'leave',
          'join', 'mood', 'profile', 'code', 'upload', 'download', 'delete'
        ].map(name => ({ name, type: 'prompt' }));
        
        // Interleave pieces and prompts
        const commands = [];
        const maxLen = Math.max(pieces.length, prompts.length);
        for (let i = 0; i < maxLen; i++) {
          if (pieces[i]) commands.push(pieces[i]);
          if (prompts[i]) commands.push(prompts[i]);
        }
        
        if (!commands.length) return;
        console.log(`Loaded ${commands.length} commands (${pieces.length} pieces, ${prompts.length} prompts)`);
        
        let index = 0;
        
        function spawnFloater() {
          const cmd = commands[index % commands.length];
          index++;
          
          const floater = document.createElement('div');
          floater.className = 'stat-floater';
          
          // Random horizontal position (5% to 95%)
          const xPos = 5 + Math.random() * 90;
          floater.style.left = `${xPos}%`;
          floater.style.bottom = '-20px';
          
          // Random duration between 10-18s
          const duration = 10 + Math.random() * 8;
          floater.style.setProperty('--float-duration', `${duration}s`);
          
          // Command name - color coded
          const text = document.createElement('span');
          text.className = 'floater-code';
          text.style.fontSize = '0.7em';
          // Green for pieces (apps), Yellow/gold for prompts (commands)
          text.style.color = cmd.type === 'piece' ? 'var(--green)' : 'var(--gold)';
          text.textContent = cmd.name;
          floater.appendChild(text);
          
          floatersContainer.appendChild(floater);
          floater.addEventListener('animationend', () => floater.remove());
        }
        
        spawnFloater();
        setInterval(spawnFloater, 2500);
        
      } catch (e) {
        console.warn('Could not load floating commands:', e);
      }
    }
    
    setTimeout(loadFloatingCommands, 4000);

    // üí¨ Floating Messages in Stats
    async function loadFloatingMessages() {
      const statItem = document.getElementById('stat-messages');
      if (!statItem) return;
      
      const floatersContainer = statItem.querySelector('.stat-floaters');
      if (!floatersContainer) return;
      
      try {
        // Fetch recent messages from both laer-klokken and main chat
        const [clockRes, chatRes] = await Promise.all([
          fetch(`${apiBase}/api/chat/messages?instance=clock&limit=30`),
          fetch(`${apiBase}/api/chat/messages?limit=30`)
        ]);
        
        const clockData = await clockRes.json();
        const chatData = await chatRes.json();
        
        const clockMsgs = (clockData.messages || []).map(m => ({ ...m, source: 'clock' }));
        const chatMsgs = (chatData.messages || []).map(m => ({ ...m, source: 'chat' }));
        
        // Interleave messages from both sources
        const allMsgs = [];
        const maxLen = Math.max(clockMsgs.length, chatMsgs.length);
        for (let i = 0; i < maxLen; i++) {
          if (clockMsgs[i]) allMsgs.push(clockMsgs[i]);
          if (chatMsgs[i]) allMsgs.push(chatMsgs[i]);
        }
        
        if (!allMsgs.length) return;
        console.log(`Loaded ${allMsgs.length} messages for floating (${clockMsgs.length} clock, ${chatMsgs.length} chat)`);
        
        let index = 0;
        
        function spawnFloater() {
          const msg = allMsgs[index % allMsgs.length];
          index++;
          
          const floater = document.createElement('div');
          floater.className = 'stat-floater float-horizontal';
          
          // Random vertical position (10% to 90%)
          const yPos = 10 + Math.random() * 80;
          floater.style.top = `${yPos}%`;
          floater.style.right = '-80px';
          
          // Random duration between 8-14s
          const duration = 8 + Math.random() * 6;
          floater.style.setProperty('--float-duration', `${duration}s`);
          
          // Message text (truncated)
          const text = document.createElement('span');
          text.className = 'floater-code';
          text.style.fontSize = '0.65em';
          text.style.maxWidth = '100px';
          text.style.overflow = 'hidden';
          text.style.textOverflow = 'ellipsis';
          // Yellow for clock messages, cyan for chat
          text.style.color = msg.source === 'clock' ? 'var(--gold)' : 'var(--cyan)';
          
          // Truncate message
          const msgText = (msg.text || '').slice(0, 25);
          const handle = msg.from || 'anon';
          text.textContent = `${handle}: ${msgText}${msg.text?.length > 25 ? '‚Ä¶' : ''}`;
          floater.appendChild(text);
          
          floatersContainer.appendChild(floater);
          floater.addEventListener('animationend', () => floater.remove());
        }
        
        spawnFloater();
        setInterval(spawnFloater, 2000);
        
      } catch (e) {
        console.warn('Could not load floating messages:', e);
      }
    }
    
    setTimeout(loadFloatingMessages, 4500);
    
    // ====== Auth0 Authentication ======
    let auth0Client = null;
    let acUser = null;
    let acHandle = null;
    
    async function initAuth0() {
      try {
        auth0Client = await auth0.createAuth0Client({
          domain: 'aesthetic.us.auth0.com',
          clientId: 'LVdZaMbyXctkGfZDnpzDATB5nR0ZhmMt',
          authorizationParams: {
            redirect_uri: window.location.origin + window.location.pathname,
            audience: 'https://aesthetic.us.auth0.com/api/v2/'
          },
          cacheLocation: 'localstorage'
        });
        
        // Handle redirect callback
        if (window.location.search.includes('code=') || window.location.search.includes('error=')) {
          await auth0Client.handleRedirectCallback();
          window.history.replaceState({}, document.title, window.location.pathname);
        }
        
        // Check if logged in
        const isAuthenticated = await auth0Client.isAuthenticated();
        if (isAuthenticated) {
          acUser = await auth0Client.getUser();
          // Fetch handle from AC API
          try {
            const token = await auth0Client.getTokenSilently();
            const res = await fetch('https://aesthetic.computer/api/me', {
              headers: { 'Authorization': `Bearer ${token}` }
            });
            if (res.ok) {
              const data = await res.json();
              acHandle = data.handle;
            }
          } catch (e) {
            console.warn('Could not fetch handle:', e);
          }
        }
        
        updateFooterAuthUI();
      } catch (e) {
        console.error('Auth0 init error:', e);
        updateFooterAuthUI();
      }
    }
    
    function updateFooterAuthUI() {
      const authButtons = document.getElementById('footerAuthButtons');
      const userMenu = document.getElementById('footerUserMenu');
      const userHandle = document.getElementById('footerUserHandle');
      
      if (acUser) {
        // Logged in - show user menu with handle
        if (authButtons) authButtons.style.display = 'none';
        if (userMenu) {
          userMenu.style.display = 'flex';
          const displayName = acHandle ? `@${acHandle}` : acUser.email?.split('@')[0] || 'User';
          if (userHandle) userHandle.textContent = displayName;
        }
      } else {
        // Logged out - show auth buttons
        if (authButtons) authButtons.style.display = 'flex';
        if (userMenu) userMenu.style.display = 'none';
      }
    }
    
    async function footerLogin() {
      if (!auth0Client) await initAuth0();
      if (!auth0Client) return;
      await auth0Client.loginWithRedirect();
    }
    
    async function footerSignup() {
      if (!auth0Client) await initAuth0();
      if (!auth0Client) return;
      await auth0Client.loginWithRedirect({
        authorizationParams: { screen_hint: 'signup' }
      });
    }
    
    async function footerLogout() {
      if (!auth0Client) return;
      await auth0Client.logout({
        logoutParams: { returnTo: window.location.origin + window.location.pathname }
      });
    }
    
    // Footer auth button event listeners
    document.getElementById('footerLoginBtn')?.addEventListener('click', footerLogin);
    document.getElementById('footerSignupBtn')?.addEventListener('click', footerSignup);
    document.getElementById('footerLogoutBtn')?.addEventListener('click', footerLogout);
    
    // Initialize auth
    initAuth0();
  </script>
  
  <!-- üîÑ Development live reload via session-server -->
  <script>
    (function() {
      // Only run in development (localhost)
      if (window.location.hostname !== 'localhost' && !window.location.hostname.includes('local.')) return;
      
      let sessionWs = null;
      let reconnectInterval = null;
      
      function connect() {
        if (sessionWs && sessionWs.readyState === WebSocket.OPEN) return;
        if (reconnectInterval) {
          clearInterval(reconnectInterval);
          reconnectInterval = null;
        }
        
        const connectionUrl = window.location.hostname.includes('local.') 
          ? 'wss://session.local.aesthetic.computer' 
          : 'wss://localhost:8889';
        
        console.log('üîÑ [give] Connecting to session server for live reload...');
        
        try {
          sessionWs = new WebSocket(connectionUrl);
        } catch (error) {
          console.warn('üîÑ [give] Connection failed:', error.message);
          scheduleReconnect();
          return;
        }

        sessionWs.onopen = () => {
          console.log('üîÑ [give] Connected to session server');
        };

        sessionWs.onmessage = (e) => {
          try {
            const msg = JSON.parse(e.data);
            if (msg.type === 'reload') {
              const piece = msg.content?.piece;
              if (piece === '*refresh*' || piece === 'give.aesthetic.computer' || piece?.includes('give')) {
                console.log('üîÑ [give] Reloading page...');
                setTimeout(() => window.location.reload(), 150);
              }
            }
          } catch (error) {
            // Ignore parse errors
          }
        };

        sessionWs.onerror = () => {
          console.warn('üîÑ [give] WebSocket error');
        };

        sessionWs.onclose = () => {
          console.log('üîÑ [give] Disconnected from session server');
          sessionWs = null;
          scheduleReconnect();
        };
      }
      
      function scheduleReconnect() {
        if (!reconnectInterval) {
          reconnectInterval = setInterval(connect, 3000);
        }
      }
      
      // Connect on load
      connect();
    })();
  </script>
</body>
</html>
