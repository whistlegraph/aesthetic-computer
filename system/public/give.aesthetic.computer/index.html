<!DOCTYPE html>
<html>
<head>
  <title>give ¬∑ Aesthetic Computer</title>
  <meta name="description" content="Support Aesthetic Computer / St√∏t Aesthetic Computer" />
  <link rel="icon" href="https://aesthetic.computer/purple-pals.svg" type="image/svg+xml" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
  <style>
    @font-face {
      font-family: 'ywft';
      src: url('https://aesthetic.computer/type/webfonts/ywft-processing-regular.woff2') format('woff2'),
           url('https://aesthetic.computer/type/webfonts/ywft-processing-regular.woff') format('woff');
    }
    @font-face {
      font-family: 'berkeley';
      src: url('https://aesthetic.computer/type/webfonts/BerkeleyMonoVariable-Regular.woff2') format('woff2');
    }

    :root {
      --bg: #f4f4f0;
      --text: #1a1a1a;
      --dim: #666;
      --pink: #e84a8a;
      --cyan: #2a9d8f;
      --gold: #d4a017;
      --green: #4a9e5b;
      --box-bg: rgba(0,0,0,0.03);
      --box-border: rgba(0,0,0,0.08);
      --mono: 'berkeley', 'Menlo', monospace;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1a1a2e;
        --text: #e8e8e8;
        --dim: #888;
        --pink: #ff6b9d;
        --cyan: #4ecdc4;
        --gold: #ffd93d;
        --green: #6bcb77;
        --box-bg: rgba(255,255,255,0.03);
        --box-border: rgba(255,255,255,0.1);
      }
    }

    * { box-sizing: border-box; }

    body {
      font-family: var(--mono);
      background: var(--bg);
      color: var(--text);
      margin: 0;
      padding: 2em;
      min-height: 100vh;
      font-size: 14px;
      line-height: 1.6;
    }

    /* Top bar with logo and language chooser */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 16px;
      z-index: 1000;
      background: var(--bg);
    }

    /* Simple gift label */
    .logo {
      font-size: 18px;
      cursor: pointer;
      user-select: none;
    }

    .logo:hover {
      opacity: 0.8;
    }

    .logo-give {
      font-family: var(--mono);
      font-weight: 500;
      color: var(--text);
    }

    .logo-ac {
      font-family: 'ywft', sans-serif;
      color: var(--pink);
    }

    .logo-dot {
      color: var(--cyan);
    }

    .logo-sep {
      color: var(--dim);
      margin: 0 0.3em;
      font-family: var(--mono);
    }

    main {
      max-width: 1200px;
      margin: 0 auto;
      padding-top: 3.5em;
    }

    /* Grid layout for wider screens */
    .content-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1em;
    }

    @media (min-width: 700px) {
      .content-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      .content-grid .full-width {
        grid-column: 1 / -1;
      }
    }

    @media (min-width: 1000px) {
      .content-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      .content-grid .span-2 {
        grid-column: span 2;
      }
    }

    h1 {
      font-family: 'ywft', sans-serif;
      font-weight: normal;
      font-size: 1.8em;
      margin: 0 0 0.5em 0;
      color: var(--text);
      grid-column: 1 / -1;
    }

    h1::before {
      content: "‚ùÑ ";
      opacity: 0.6;
    }

    h1::after {
      content: " ‚ú¶";
      opacity: 0.6;
    }

    h1 .bounce-dot {
      display: inline-block;
      font-weight: 900;
      font-size: 1.1em;
      color: var(--pink);
      animation: dotBounce 1.2s ease-in-out 3;
    }

    @keyframes dotBounce {
      0%, 100% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-6px) scale(1.2); }
    }

    .holiday-banner {
      font-family: var(--mono);
      font-size: 0.75em;
      color: var(--dim);
      padding: 0.6em;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 3px;
      text-align: center;
      grid-column: 1 / -1;
    }

    .holiday-banner span { color: var(--gold); }

    /* Prose blocks - language-switchable */
    .prose {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 1em 1.2em;
      font-size: 0.9em;
      line-height: 1.7;
    }

    .prose.full-width {
      grid-column: 1 / -1;
    }

    /* Language content visibility - Danish hidden by default */
    /* Exclude dropdown options from language hiding */
    [data-lang="da"]:not(.lang-option):not(.curr-option) { display: none !important; }
    [data-lang="en"]:not(.lang-option):not(.curr-option) { display: block; }
    
    /* When Danish is selected, flip visibility */
    body.lang-da [data-lang="da"]:not(.lang-option):not(.curr-option) { display: block !important; }
    body.lang-da [data-lang="en"]:not(.lang-option):not(.curr-option) { display: none !important; }

    /* Link description spans */
    .link-desc { display: inline; }
    .link-desc[data-lang="da"] { display: none !important; }
    body.lang-da .link-desc[data-lang="da"] { display: inline !important; }
    body.lang-da .link-desc[data-lang="en"] { display: none !important; }

    /* Feature module list items */
    .feature-module li[data-lang="da"] { display: none !important; }
    body.lang-da .feature-module li[data-lang="da"] { display: block !important; }
    body.lang-da .feature-module li[data-lang="en"] { display: none !important; }

    a { color: var(--cyan); text-decoration: none; }
    a:hover { text-decoration: underline; }

    a.handle-link { color: var(--pink); }

    code {
      background: var(--box-bg);
      padding: 0.15em 0.4em;
      border-radius: 2px;
      color: var(--pink);
    }

    code a { color: var(--pink); }

    /* Stats Section */
    .stats-section {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.6em;
      grid-column: 1 / -1;
    }

    @media (min-width: 800px) {
      .stats-section {
        grid-template-columns: repeat(6, 1fr);
      }
    }

    .stat-item {
      text-align: center;
      padding: 0.8em 0.5em;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: auto;
    }

    .stat-value {
      font-family: 'ywft', var(--mono);
      font-size: 1.4em;
      color: var(--gold);
    }

    .stat-label {
      font-size: 0.7em;
      color: var(--dim);
      margin-top: 0.2em;
    }

    /* Module caption - positioned at bottom of content boxes */
    .module-caption {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 0.8em 1em;
      font-size: 0.75em;
      color: var(--dim);
      background: inherit;
      z-index: 2;
    }

    /* Fiat Currency Section */
    .fiat-section {
      background: transparent;
      border: none;
      border-radius: 0;
      padding: 0;
    }

    .fiat-section.full-width {
      grid-column: 1 / -1;
    }

    .fiat-header {
      display: none;
    }

    .fiat-header h2 {
      font-family: 'ywft', sans-serif;
      font-size: 1em;
      margin: 0;
      color: var(--cyan);
    }

    /* Language and Currency selectors */
    .selector-group {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* Language dropdown (compact, like kidlisp.com) */
    .lang-selector {
      position: relative;
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 12px;
      user-select: none;
      border-radius: 4px;
      transition: background 0.15s;
    }

    .lang-selector:hover {
      background: var(--box-bg);
    }

    .lang-selector .lang-flag { font-size: 14px; }
    .lang-selector .lang-text { 
      font-size: 12px; 
      color: var(--dim);
      font-weight: 500;
    }
    .lang-selector .lang-arrow { 
      font-size: 8px; 
      color: var(--dim); 
      opacity: 0.6;
      margin-left: 2px;
    }

    .lang-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      background: var(--bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 100;
      min-width: 100px;
      margin-top: 2px;
      display: none;
    }

    .lang-selector.open .lang-dropdown {
      display: block;
    }

    .lang-option {
      padding: 8px 12px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text);
      transition: all 0.15s;
    }

    .lang-option:hover {
      background: rgba(232, 74, 138, 0.1);
      color: var(--pink);
    }

    .lang-option:first-child { border-radius: 4px 4px 0 0; }
    .lang-option:last-child { border-radius: 0 0 4px 4px; }

    /* Currency link selector */
    .currency-links {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .curr-link {
      font-size: 13px;
      color: var(--dim);
      cursor: pointer;
      transition: color 0.15s;
      text-decoration: none;
      font-weight: 500;
    }

    .curr-link:hover {
      color: var(--text);
    }

    .curr-link.active {
      color: var(--pink);
    }

    .curr-link .curr-flag { margin-right: 4px; }

    /* Different active colors per currency */
    .curr-link.active[data-curr="usd"] { color: var(--green); }
    .curr-link.active[data-curr="dkk"] { color: var(--cyan); }
    .curr-link.active[data-curr="xtz"] { color: #a78bfa; }
    .curr-link.active[data-curr="eth"] { color: #818cf8; }
    .curr-link.active[data-curr="btc"] { color: #f7931a; }

    @media (max-width: 600px) {
      .currency-links {
        gap: 10px;
      }
      .curr-link {
        font-size: 12px;
      }
      .curr-link .curr-text { display: none; }
      .lang-selector .lang-text { display: none; }
    }

    /* Hide old dropdown styles */
    .dropdown-selector { display: none !important; }
      border: 1px solid var(--box-border);
      border-radius: 4px;
      display: none;
      min-width: 100px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 100;
    }

    .dropdown-selector.open .dropdown-menu {
      display: block;
    }

    .dropdown-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text);
    }

    .dropdown-option:hover {
      background: var(--box-bg);
    }

    .dropdown-option.active {
      color: var(--pink);
      font-weight: bold;
    }

    .currency-pickers {
      width: 100%;
    }

    .currency-picker {
      padding: 0;
    }

    .currency-picker h3 {
      font-family: var(--mono);
      font-size: 0.85em;
      margin: 0 0 0.8em 0;
      color: var(--dim);
    }

    .gift-widget {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .gift-visual {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 2em 1em;
      background: linear-gradient(135deg, rgba(205, 92, 155, 0.1) 0%, rgba(0, 255, 255, 0.05) 100%);
      border: 1px solid var(--box-border);
      border-radius: 8px 8px 0 0;
    }

    .gift-logo-wrap {
      position: relative;
      display: inline-block;
    }

    .gift-logo {
      width: 160px;
      height: 160px;
      opacity: 0.7;
      transition: opacity 0.2s, transform 0.2s;
    }

    .gift-widget:hover .gift-logo {
      opacity: 1;
      transform: scale(1.05);
    }

    .gift-amount {
      position: absolute;
      top: -0.5em;
      right: -2em;
      font-family: 'ywft', var(--mono);
      font-size: 1.3em;
      color: var(--gold);
      background: linear-gradient(135deg, #2a5a3a 0%, #1a3a2a 100%);
      border: 2px solid #4a8a5a;
      border-radius: 4px;
      padding: 0.3em 0.6em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
      white-space: nowrap;
    }

    .gift-controls {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .gift-controls input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 12px;
      background: var(--cyan);
      border-radius: 0 0 8px 8px;
      outline: none;
      cursor: pointer;
      margin: 0;
    }

    .gift-controls input[type="range"] {
      position: relative;
      z-index: 10;
    }

    .gift-controls input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
      position: relative;
      z-index: 20;
    }

    .gift-controls input[type="range"]::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    /* Gift mode checkbox (monthly repeat) */
    .gift-monthly-check {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0.8em 0;
      font-size: 0.85em;
      color: var(--dim);
      cursor: pointer;
      user-select: none;
    }

    .gift-monthly-check input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: var(--gold);
      cursor: pointer;
    }

    .gift-monthly-check:hover {
      color: var(--text);
    }

    .gift-monthly-check.checked {
      color: var(--gold);
    }

    .gift-btn {
      font-family: 'ywft', sans-serif;
      font-size: 1.2em;
      padding: 1em 1.5em;
      background: linear-gradient(180deg, var(--green) 0%, #3a8a4a 100%);
      color: white;
      border: 2px solid #5ab06a;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      transition: all 0.15s;
      font-weight: bold;
      letter-spacing: 0.02em;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.2);
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
      margin-top: 0.5em;
    }

    .gift-btn:hover {
      background: linear-gradient(180deg, var(--pink) 0%, #c83a7a 100%);
      border-color: #ff8ab0;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.2);
    }

    .gift-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1);
    }

    .gift-btn:disabled {
      opacity: 0.7;
      cursor: wait;
    }

    /* Crypto controls */
    .crypto-controls {
      display: flex;
      flex-direction: column;
      gap: 0;
    }

    .crypto-address {
      background: var(--box-bg);
      padding: 1em;
      text-align: center;
      border-left: 1px solid var(--box-border);
      border-right: 1px solid var(--box-border);
      cursor: pointer;
      transition: all 0.15s;
    }

    .crypto-address:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .crypto-address.copied {
      background: var(--gold);
    }

    .crypto-address.copied .crypto-label,
    .crypto-address.copied .crypto-addr {
      color: var(--bg);
    }

    .crypto-label {
      display: block;
      font-family: 'ywft', sans-serif;
      font-size: 1.1em;
      color: var(--cyan);
      margin-bottom: 0.4em;
    }

    .crypto-addr {
      display: block;
      font-family: var(--mono);
      font-size: 0.8em;
      color: var(--dim);
      word-break: break-all;
    }

    .crypto-copy-hint {
      display: block;
      font-size: 0.7em;
      color: var(--dim);
      margin-top: 0.5em;
      opacity: 0.6;
    }

    .crypto-address:hover .crypto-copy-hint {
      opacity: 1;
    }

    .crypto-address.copied .crypto-copy-hint {
      color: var(--bg);
      opacity: 1;
    }

    .crypto-amount {
      background: linear-gradient(135deg, #3a2a5a 0%, #2a1a4a 100%);
      border-color: #6a4a8a;
    }

    .crypto-usd {
      position: absolute;
      bottom: 0.5em;
      right: 0.5em;
      font-family: var(--mono);
      font-size: 0.85em;
      color: var(--gold);
      opacity: 0.9;
    }

    .gift-widget.crypto .gift-visual {
      background: linear-gradient(135deg, rgba(106, 74, 138, 0.2) 0%, rgba(0, 255, 255, 0.05) 100%);
    }

    .crypto-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 12px;
      background: linear-gradient(90deg, var(--pink) 0%, #6a4a8a 100%);
      border-radius: 0;
      outline: none;
      cursor: pointer;
      margin: 0;
      border-left: 1px solid var(--box-border);
      border-right: 1px solid var(--box-border);
    }

    .crypto-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .crypto-slider::-moz-range-thumb {
      width: 24px;
      height: 24px;
      background: var(--text);
      border-radius: 50%;
      cursor: grab;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }

    .crypto-buttons {
      display: flex;
      gap: 0;
    }

    .crypto-send {
      flex: 1;
      border-radius: 0 0 8px 8px;
      background: linear-gradient(135deg, #6a4a8a 0%, #4a2a6a 100%);
    }

    .crypto-send:hover {
      background: linear-gradient(135deg, #8a6aaa 0%, #6a4a8a 100%);
    }

    small {
      display: block;
      font-size: 0.7em;
      color: var(--dim);
      text-align: center;
      grid-column: 1 / -1;
      margin: 0.5em 0;
    }

    hr {
      border: none;
      border-top: 1px dashed var(--box-border);
      grid-column: 1 / -1;
      margin: 0.5em 0;
    }

    .digital-currency {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 1em 1.2em;
    }

    .digital-currency h3 {
      font-family: 'ywft', sans-serif;
      font-size: 0.9em;
      margin: 0 0 0.8em 0;
      color: var(--cyan);
    }

    .crypto-row {
      display: flex;
      gap: 1em;
      flex-wrap: wrap;
    }

    .crypto-item {
      flex: 1;
      min-width: 140px;
    }

    .link-block {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 0;
      display: flex;
      flex-direction: column;
      aspect-ratio: 1;
      overflow: hidden;
      position: relative;
    }

    .link-block strong {
      position: sticky;
      top: 0;
      left: 0;
      background: inherit;
      padding: 0.8em 1em;
      color: var(--pink);
      font-family: 'ywft', sans-serif;
      font-size: 0.9em;
      z-index: 1;
    }

    .link-block a {
      color: var(--cyan);
      font-family: var(--mono);
      font-size: 0.9em;
      padding: 0 1em;
      flex: 1;
      overflow: auto;
    }

    .link-block .link-desc {
      position: sticky;
      bottom: 0;
      left: 0;
      background: inherit;
      padding: 0.8em 1em;
      font-size: 0.75em;
      color: var(--dim);
      z-index: 1;
    }

    /* Distinct link-block colors */
    .link-block.desktop-section {
      background: linear-gradient(135deg, #2d1b4e 0%, #1a1a2e 100%);
      border-color: #3d2b5e;
    }
    .link-block.desktop-section strong,
    .link-block.desktop-section .link-desc { background: transparent; }

    /* Notepat - musical purple/blue */
    .link-block.notepat-section {
      background: linear-gradient(135deg, #1a1a3e 0%, #2a1a4e 100%);
      border-color: #3a2a5e;
    }
    .link-block.notepat-section strong { color: #a090ff; }
    .link-block.notepat-section strong,
    .link-block.notepat-section .link-desc { background: transparent; }

    /* Invest - green/money theme */
    .link-block.invest-section {
      background: linear-gradient(135deg, #0a2a1a 0%, #1a3a2a 100%);
      border-color: #2a4a3a;
    }
    .link-block.invest-section strong { color: #4ecdc4; }
    .link-block.invest-section strong,
    .link-block.invest-section .link-desc { background: transparent; }

    /* Desktop download buttons */
    .desktop-downloads {
      display: flex;
      gap: 0.6em;
      margin-top: 0.8em;
      flex-wrap: wrap;
    }

    .desktop-btn {
      display: flex;
      align-items: center;
      gap: 0.4em;
      padding: 0.5em 0.9em;
      background: rgba(100, 60, 140, 0.3);
      border: 1px solid rgba(180, 100, 255, 0.3);
      border-radius: 6px;
      text-decoration: none;
      transition: all 0.2s ease;
      flex: 1;
      justify-content: center;
      min-width: 80px;
    }

    .desktop-btn:hover {
      background: rgba(120, 80, 180, 0.5);
      border-color: rgba(200, 150, 255, 0.6);
      transform: translateY(-1px);
    }

    .desktop-icon {
      font-size: 1.2em;
    }

    .desktop-label {
      font-family: var(--mono);
      font-size: 0.85em;
      color: var(--text);
    }

    .desktop-btn:hover .desktop-label {
      color: var(--pink);
    }

    .desktop-version {
      font-family: var(--mono);
      font-size: 0.8em;
      color: var(--dim);
      font-weight: normal;
      margin-left: 0.3em;
    }

    .desktop-release-info {
      margin-top: 0.8em;
      padding: 0.6em 0.8em;
      background: rgba(40, 30, 60, 0.5);
      border-radius: 4px;
      font-size: 0.8em;
    }

    .desktop-release-name {
      color: var(--cyan);
      font-weight: bold;
      margin-bottom: 0.4em;
    }

    .desktop-release-date {
      color: var(--dim);
      font-size: 0.9em;
      margin-bottom: 0.5em;
    }

    .desktop-changelog {
      color: var(--text);
      line-height: 1.4;
    }

    .desktop-changelog ul {
      margin: 0.3em 0 0 0;
      padding-left: 1.2em;
    }

    .desktop-changelog li {
      margin-bottom: 0.2em;
    }

    .desktop-changelog strong {
      color: var(--pink);
    }

    .desktop-btn-info {
      display: block;
      font-size: 0.75em;
      color: var(--dim);
      margin-top: 0.2em;
    }

    .feature-module {
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 4px;
      padding: 1em 1.2em;
    }

    .feature-module h3 {
      font-family: 'ywft', sans-serif;
      font-size: 0.95em;
      margin: 0 0 0.7em 0;
      color: var(--cyan);
    }

    .feature-module ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.5em;
    }

    .feature-module li {
      font-size: 0.85em;
      line-height: 1.4;
      padding-left: 0.5em;
      border-left: 2px solid var(--box-border);
    }

    .feature-module li strong {
      color: var(--pink);
    }

    .feature-module li a {
      color: inherit;
      text-decoration: none;
    }

    .feature-module li a:hover {
      text-decoration: underline;
    }

    .feature-module li a strong {
      color: var(--pink);
    }

    .addr {
      font-size: 0.85em;
      background: var(--box-bg);
      padding: 0.3em 0.5em;
      border-radius: 2px;
      display: inline-flex;
      align-items: center;
      gap: 0.5em;
      margin-top: 0.2em;
    }

    .addr button {
      font-family: var(--mono);
      font-size: 0.75em;
      padding: 0.2em 0.4em;
      background: transparent;
      border: 1px solid var(--dim);
      color: var(--dim);
      border-radius: 2px;
      cursor: pointer;
    }

    .addr button:hover {
      border-color: var(--cyan);
      color: var(--cyan);
    }

    /* Shop Section - clean white background like shop.aesthetic.computer */
    .shop-section {
      background: #000;
      border: none;
      border-radius: 8px;
      padding: 0;
      color: #1a1a1a;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .shop-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      z-index: 3;
      background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, transparent 100%);
      padding: 0.8em 1em;
      text-align: left;
    }

    .shop-title {
      font-family: var(--mono);
      font-size: 0.9em;
      font-weight: 600;
      color: #fff;
      text-decoration: none;
      text-shadow: 0 1px 4px rgba(0,0,0,0.5);
    }

    .shop-title:hover {
      color: var(--pink);
    }

    .shop-section .module-caption {
      background: #000;
      color: rgba(255,255,255,0.5);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      z-index: 3;
    }

    .shop-products {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      overflow: hidden;
    }

    .shop-product {
      display: block;
      width: 100%;
      height: 100%;
      text-decoration: none;
      color: #fff;
      position: relative;
      opacity: 0;
      animation: shopFadeIn 0.5s ease forwards;
    }

    .shop-product-img-wrap {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      overflow: hidden;
    }

    .shop-product img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scale(1.15);
      animation: kenBurns 15s ease-in-out infinite alternate;
    }

    @keyframes kenBurns {
      0% { transform: scale(1.15) translate(0, 0); }
      25% { transform: scale(1.25) translate(-3%, -2%); }
      50% { transform: scale(1.2) translate(2%, -3%); }
      75% { transform: scale(1.3) translate(-2%, 2%); }
      100% { transform: scale(1.2) translate(2%, -1%); }
    }

    .shop-product:hover img {
      animation-play-state: paused;
      transform: scale(1.05);
      transition: transform 0.4s ease;
    }

    .shop-product-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, 
        rgba(0,0,0,0.5) 0%, 
        rgba(0,0,0,0.1) 40%,
        rgba(0,0,0,0.1) 60%,
        rgba(0,0,0,0.5) 100%);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 2.8em 1em 1.6em 1em;
      text-align: left;
    }

    .shop-product-title {
      font-family: 'ywft', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 1.4em;
      font-weight: 600;
      color: #fff;
      text-shadow: 0 2px 12px rgba(0,0,0,0.8), 0 0 40px rgba(0,0,0,0.4);
      line-height: 1.2;
      margin-bottom: 0.3em;
    }

    .shop-product-top {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .shop-product-info {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 0.3em;
    }

    .shop-product-vendor {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 1em;
      color: #fff;
      text-shadow: 0 2px 8px rgba(0,0,0,0.7);
    }

    .shop-product-vendor a {
      color: var(--pink);
      text-decoration: none;
    }

    .shop-product-vendor a:hover {
      text-decoration: underline;
    }

    .shop-product-price {
      font-family: var(--mono);
      font-size: 1.1em;
      color: #fff;
      font-weight: 600;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      margin-top: 0.3em;
    }

    .shop-product-sold {
      color: var(--pink);
      font-size: 0.95em;
      font-weight: 700;
      text-transform: uppercase;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
      margin-top: 0.3em;
    }

    @keyframes shopFadeIn {
      to { opacity: 1; }
    }

    .shop-loading {
      color: #999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 0.85em;
      text-align: center;
      padding: 2em;
    }

    /* Shop auto-advance progress bar - inside panel */
    .shop-auto-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.15);
      z-index: 15;
      overflow: hidden;
    }

    .shop-auto-progress-bar {
      height: 100%;
      width: 0%;
      background: var(--pink);
      transition: width 0.05s linear;
    }

    /* TV Section - letterbox video feed */
    .tv-section {
      background: #000;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .tv-header {
      position: sticky;
      top: 0;
      z-index: 1;
      padding: 0.8em 1em;
      text-decoration: none;
      background: #000;
    }

    .tv-header strong {
      color: #fff;
      font-family: 'ywft', sans-serif;
      font-size: 0.9em;
    }

    .tv-header:hover strong {
      color: var(--pink);
    }

    .tv-section .module-caption {
      background: #000;
      color: rgba(255,255,255,0.5);
    }

    .tv-player {
      position: relative;
      width: 100%;
      aspect-ratio: 16 / 9;
      background: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tv-player video {
      width: 100%;
      height: 100%;
      object-fit: contain;
      background: #000;
    }

    .tv-loading {
      font-size: 2em;
      opacity: 0.3;
      animation: tvPulse 1.5s ease-in-out infinite;
    }

    @keyframes tvPulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 0.6; }
    }

    .tv-no-signal {
      color: rgba(255,255,255,0.3);
      font-size: 0.8em;
      font-family: var(--mono);
    }

    .tv-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: rgba(255,255,255,0.2);
    }

    .tv-progress-bar {
      height: 100%;
      background: var(--pink);
      width: 0%;
      /* No transition - smooth continuous updates */
    }

    .tv-info {
      position: absolute;
      bottom: 8px;
      left: 8px;
      right: 8px;
      display: flex;
      justify-content: space-between;
      font-family: var(--mono);
      font-size: 0.7em;
      color: rgba(255,255,255,0.6);
      pointer-events: none;
    }

    /* TV auto-advance progress bar - inside panel */
    .tv-auto-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.15);
      z-index: 15;
      overflow: hidden;
    }

    .tv-auto-progress-bar {
      height: 100%;
      width: 0%;
      background: var(--pink);
      /* No transition - smooth continuous updates from timeupdate */
    }

    /* Flip Card System - Desktop App Style (ghost overlay approach) */
    .chat-flip-container {
      aspect-ratio: 1;
      position: relative;
      perspective: 1200px;
      overflow: hidden;
      border-radius: 8px;
    }

    /* The flipping card - this rotates in 3D */
    .chat-flip-card {
      position: absolute;
      inset: 0;
      transform-style: preserve-3d;
      transition: transform 0.7s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Hover tilt effect - subtle swivel preview */
    .chat-flip-card.tilt-left {
      transform: rotateY(-8deg);
    }

    .chat-flip-card.tilt-right {
      transform: rotateY(8deg);
    }

    .chat-flip-card.flipped {
      transform: rotateY(180deg);
    }

    /* Tilt when flipped (reversed direction since we're looking at the back) */
    .chat-flip-card.flipped.tilt-left {
      transform: rotateY(188deg);
    }

    .chat-flip-card.flipped.tilt-right {
      transform: rotateY(172deg);
    }

    /* Both faces positioned together */
    .chat-flip-face {
      position: absolute;
      inset: 0;
      border-radius: 8px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: opacity 0.1s ease, filter 0.1s ease;
    }

    /* Front face - laer-klokken - active when NOT flipped */
    .chat-flip-front {
      z-index: 1;
      opacity: 1;
      filter: none;
    }

    /* Back face - chat-system - ghost ON TOP when NOT flipped */
    .chat-flip-back {
      z-index: 3;
      transform: rotateY(180deg); /* Shows mirrored when viewed from front */
      opacity: 0.15;
      filter: blur(2px);
      pointer-events: none;
    }

    /* When FLIPPED: front becomes ghost, back becomes active */
    .chat-flip-card.flipped .chat-flip-front {
      z-index: 3;
      opacity: 0.15;
      filter: blur(2px);
      pointer-events: none;
    }

    .chat-flip-card.flipped .chat-flip-back {
      z-index: 1;
      opacity: 1;
      filter: none;
      pointer-events: auto;
    }

    /* Clickable areas for flip */
    .chat-flip-trigger {
      cursor: pointer;
      user-select: none;
    }

    .chat-flip-trigger:hover {
      opacity: 0.85;
    }

    /* Swivel progress bar - at bottom of container */
    .chat-flip-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(0, 0, 0, 0.3);
      z-index: 15;
      overflow: hidden;
    }

    .chat-flip-progress-bar {
      height: 100%;
      width: 0%;
      background: var(--gold);
      transition: width 0.1s linear, background 0.3s ease;
    }

    /* Purple progress when showing chat (flipped) */
    .chat-flip-container.flipped .chat-flip-progress-bar {
      background: #8844ff;
    }

    /* Chat Rolodex - laer-klokken warm gold theme */
    .chat-preview {
      background: linear-gradient(135deg, #2a2010 0%, #1a1508 100%);
      border: 1px solid #3d3520;
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      position: relative;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .chat-preview::-webkit-scrollbar { display: none; }

    .chat-preview-header {
      position: sticky;
      top: 0;
      z-index: 1;
      padding: 0.8em 1em;
      text-decoration: none;
      background: linear-gradient(135deg, #2a2010 0%, #1a1508 100%);
    }

    .chat-preview-header strong {
      color: var(--gold);
      font-family: 'ywft', sans-serif;
      font-size: 0.9em;
    }

    .chat-preview-header:hover strong {
      color: #ffe066;
    }

    .chat-preview .module-caption {
      background: linear-gradient(135deg, #2a2010 0%, #1a1508 100%);
      color: #a08050;
    }

    .chat-messages {
      flex: 1;
      overflow-y: scroll;
      overflow-x: hidden;
      background: #111;
      scroll-behavior: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }

    .chat-messages::-webkit-scrollbar {
      display: none;
    }

    .chat-msg {
      padding: 0.5em 1em;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      animation: chatFadeIn 0.3s ease;
    }

    .chat-msg:last-child {
      border-bottom: none;
    }

    @keyframes chatFadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .chat-msg-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 0.2em;
    }

    .chat-handle {
      font-family: var(--mono);
      font-size: 0.75em;
      color: var(--cyan);
    }

    .chat-handle:hover {
      color: var(--pink);
    }

    .chat-time {
      font-family: var(--mono);
      font-size: 0.6em;
      color: var(--dim);
    }

    .chat-text {
      font-size: 0.8em;
      color: var(--text);
      line-height: 1.4;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .chat-text .chat-link-url {
      color: var(--cyan);
      text-decoration: none;
    }

    .chat-text .chat-link-url:hover {
      text-decoration: underline;
    }

    .chat-text .chat-link-handle {
      color: var(--pink);
      text-decoration: none;
    }

    .chat-text .chat-link-handle:hover {
      text-decoration: underline;
    }

    .chat-text .chat-link-prompt {
      color: var(--gold);
      text-decoration: none;
      font-family: var(--mono);
    }

    .chat-text .chat-link-prompt:hover {
      text-decoration: underline;
    }

    .chat-text .chat-link-painting {
      color: #95E1D3;
      text-decoration: none;
    }

    .chat-text .chat-link-painting:hover {
      text-decoration: underline;
    }

    /* Painting thumbnail previews in chat */
    .chat-painting-thumbs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 6px;
    }

    .chat-painting-thumb {
      width: 48px;
      height: 48px;
      border-radius: 4px;
      overflow: hidden;
      background: #1a1a1a;
      position: relative;
    }

    .chat-painting-thumb a {
      display: block;
      width: 100%;
      height: 100%;
    }

    .chat-painting-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .chat-painting-thumb img.loaded {
      opacity: 1;
    }

    .chat-painting-thumb:hover {
      outline: 2px solid var(--cyan);
    }

    .chat-painting-thumb .thumb-code {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      font-family: var(--mono);
      font-size: 0.5em;
      color: #fff;
      background: rgba(0,0,0,0.7);
      padding: 1px 3px;
      text-align: center;
    }

    /* Chat System (back face) - purple theme (lighter) */
    .chat-preview-system {
      background: linear-gradient(135deg, #252540 0%, #1a1230 100%);
      border: 1px solid rgba(160, 100, 255, 0.35);
    }

    .chat-system-header {
      position: sticky;
      top: 0;
      z-index: 1;
      padding: 0.8em 1em;
      text-decoration: none;
      background: linear-gradient(135deg, #252540 0%, #1a1230 100%);
    }

    .chat-system-header strong {
      color: rgba(180, 140, 255, 0.95);
      font-family: 'ywft', sans-serif;
      font-size: 0.9em;
    }

    .chat-system-header:hover strong {
      color: rgba(210, 170, 255, 1);
    }

    .chat-preview-system .module-caption {
      background: linear-gradient(135deg, #252540 0%, #1a1230 100%);
      color: rgba(160, 120, 255, 0.8);
    }

    .chat-preview-system .chat-messages {
      background: rgba(20, 18, 35, 0.9);
    }

    .chat-preview-system .chat-handle {
      color: rgba(180, 140, 255, 0.95);
    }

    .chat-preview-system .chat-handle:hover {
      color: var(--pink);
    }

    /* KidLisp Preview - Full-bleed animated webp like shop */
    .kidlisp-preview {
      background: #0d0d1a;
      border: none;
      border-radius: 8px;
      overflow: hidden;
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .kidlisp-preview-header:hover .kidlisp-logo {
      filter: brightness(1.2);
    }

    .kidlisp-preview .module-caption {
      background: linear-gradient(135deg, rgba(20,10,30,0.85) 0%, rgba(10,5,20,0.9) 100%);
      color: rgba(200,180,255,0.9);
      z-index: 10;
    }

    /* KidLisp auto-advance progress bar */
    .kidlisp-auto-progress {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: rgba(255, 255, 255, 0.15);
      z-index: 15;
      overflow: hidden;
    }

    .kidlisp-auto-progress-bar {
      height: 100%;
      width: 0%;
      background: #AA96DA;
      transition: width 0.1s linear;
    }

    .kidlisp-preview-header {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      padding: 0.6em 0.8em;
      display: flex;
      align-items: center;
      gap: 0.5em;
      text-decoration: none;
      z-index: 10;
      background: linear-gradient(135deg, rgba(20,10,30,0.85) 0%, rgba(10,5,20,0.8) 100%);
    }

    /* Single rotating KidLisp preview carousel */
    .kidlisp-carousel {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }

    .kidlisp-slide {
      position: absolute;
      inset: 0;
      opacity: 0;
      transform: translateX(30px);
      transition: opacity 0.5s ease, transform 0.5s ease;
      pointer-events: none;
    }

    .kidlisp-slide.active {
      opacity: 1;
      transform: translateX(0);
      pointer-events: auto;
    }

    .kidlisp-slide.exiting {
      opacity: 0;
      transform: translateX(-30px);
    }

    .kidlisp-slide a {
      display: block;
      width: 100%;
      height: 100%;
      position: absolute;
      inset: 0;
    }

    .kidlisp-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.5s ease;
      transform: scale(1.1);
    }

    .kidlisp-slide img.loaded {
      opacity: 0.5;
    }

    .kidlisp-slide:hover img.loaded {
      opacity: 0.7;
    }

    .kidlisp-slide-code {
      position: absolute;
      top: 4.5em;
      left: 1em;
      right: 1em;
      bottom: 4em;
      padding: 0.4em 0.6em;
      font-family: var(--mono);
      font-size: 0.75em;
      line-height: 1.35;
      color: #fff;
      overflow: hidden;
      text-shadow: 0 1px 3px rgba(0,0,0,0.95), 0 0 6px rgba(0,0,0,0.7);
      white-space: pre-wrap;
      word-break: break-word;
      pointer-events: none;
      z-index: 2;
    }

    .kidlisp-slide-plays {
      position: absolute;
      bottom: 4em;
      left: 1em;
      font-family: var(--mono);
      font-size: 0.7em;
      color: var(--gold);
      background: rgba(0,0,0,0.5);
      padding: 0.15em 0.4em;
      border-radius: 3px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.9);
      z-index: 5;
    }

    .kidlisp-slide-author {
      position: absolute;
      bottom: 4em;
      left: 5em;
      font-family: var(--mono);
      font-size: 0.6em;
      color: rgba(255,255,255,0.7);
      background: rgba(0,0,0,0.4);
      padding: 0.15em 0.4em;
      border-radius: 3px;
      text-shadow: 0 1px 2px rgba(0,0,0,0.9);
      z-index: 5;
    }

    .kidlisp-slide-qr-wrap {
      position: absolute;
      bottom: 4em;
      right: 1em;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      z-index: 5;
    }

    .kidlisp-slide-label {
      font-family: var(--mono);
      font-size: 0.55em;
      color: #fff;
      background: #000;
      padding: 0.15em 0.4em;
    }

    .kidlisp-slide-qr {
      background: #fff;
      padding: 2px;
      line-height: 0;
    }

    .kidlisp-slide-qr img {
      display: block;
      image-rendering: pixelated;
    }

    /* KidLisp syntax highlighting - matches kidlisp.com */
    .kidlisp-slide-code .hl-comment { color: #6272a4; font-style: italic; }
    .kidlisp-slide-code .hl-string { color: orange; }
    .kidlisp-slide-code .hl-number { color: lime; }
    .kidlisp-slide-code .hl-keyword { color: pink; }
    .kidlisp-slide-code .hl-api { color: cyan; }
    .kidlisp-slide-code .hl-color { color: magenta; }
    .kidlisp-slide-code .hl-timing { color: #ffb86c; font-weight: bold; }
    .kidlisp-slide-code .hl-paren { color: #888; }

    /* Timing blink animation - elements with this class pulse */
    @keyframes hl-timing-blink {
      0%, 100% { opacity: 1; text-shadow: 0 0 8px currentColor, 0 0 2px rgba(0,0,0,0.9); }
      50% { opacity: 0.4; text-shadow: none; }
    }

    .hl-timing-active {
      animation: hl-timing-blink 0.8s ease-in-out infinite;
    }

    .kidlisp-slide-loading {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      color: #555;
    }

    @keyframes kidlisp-spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .kidlisp-slide-loading::after {
      content: "‚è≥";
      animation: kidlisp-spin 2s linear infinite;
    }

    #pals {
      display: flex;
      align-items: center;
      justify-content: center;
      grid-column: 1 / -1;
    }

    #pals img {
      width: 48px;
      opacity: 0.3;
    }

    #pals:hover img {
      opacity: 1;
    }

    /* Mobile adjustments */
    @media (max-width: 699px) {
      .stats-section {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 400px) {
      .stats-section {
        grid-template-columns: repeat(2, 1fr);
      }
      .stat-item { min-width: unset; }
    }

    /* Thank You Mode */
    .thanks-section {
      display: none;
      grid-column: 1 / -1;
      text-align: center;
      padding: 2em 1em;
    }

    body.thanks-mode .thanks-section {
      display: block;
    }

    body.thanks-mode .fiat-section {
      display: none !important;
    }

    body.thanks-mode .currency-links {
      display: none !important;
    }

    .thanks-canvas-wrap {
      display: inline-block;
      margin-bottom: 1.5em;
    }

    .thanks-canvas {
      width: 280px;
      height: 280px;
      border-radius: 12px;
    }

    .thanks-message {

      font-family: 'ywft', sans-serif;
      font-size: 1.4em;
      color: var(--text);
      max-width: 500px;
      margin: 0 auto 1.5em auto;
      line-height: 1.5;
    }

    .thanks-amount {
      color: var(--green);
      font-weight: bold;
    }

    .thanks-actions {
      display: flex;
      gap: 1em;
      justify-content: center;
      flex-wrap: wrap;
    }

    .thanks-again {
      display: inline-block;
      padding: 0.8em 1.5em;
      background: var(--box-bg);
      border: 1px solid var(--box-border);
      border-radius: 6px;
      color: var(--cyan);
      text-decoration: none;
      transition: all 0.15s;
      font-size: 0.95em;
    }

    .thanks-again:hover {
      background: var(--cyan);
      color: var(--bg);
      text-decoration: none;
    }

    .thanks-share {
      display: inline-block;
      padding: 0.8em 1.5em;
      background: #000;
      border: 1px solid #333;
      border-radius: 6px;
      color: #fff;
      font-family: var(--mono);
      font-size: 0.95em;
      cursor: pointer;
      transition: all 0.15s;
    }

    .thanks-share:hover {
      background: #1da1f2;
      border-color: #1da1f2;
    }
  </style>
</head>

<body>
  <div class="top-bar">
    <div style="display: flex; align-items: center; gap: 8px;">
      <div class="logo" onclick="window.location.href='https://aesthetic.computer'"><span class="logo-give">give</span><span class="logo-sep">‚Äî</span><span class="logo-ac">Aesthetic<span class="logo-dot">.</span>Computer</span></div>
      <div class="lang-selector" id="langSelector">
        <span class="lang-flag" id="lang-flag">üá∫üá∏</span>
        <span class="lang-text" id="lang-text">English</span>
        <span class="lang-arrow">‚ñº</span>
        <div class="lang-dropdown" id="lang-dropdown">
          <div class="lang-option" data-lang="en">üá∫üá∏ English</div>
          <div class="lang-option" data-lang="da">üá©üá∞ Dansk</div>
        </div>
      </div>
    </div>
    <div class="currency-links" id="currSelector">
      <span class="curr-link active" data-curr="usd"><span class="curr-flag">üíµ</span><span class="curr-text">USD</span></span>
      <span class="curr-link" data-curr="dkk"><span class="curr-flag">üí∂</span><span class="curr-text">DKK</span></span>
      <span class="curr-link" data-curr="xtz"><span class="curr-flag">üîÆ</span><span class="curr-text">XTZ</span></span>
      <span class="curr-link" data-curr="eth"><span class="curr-flag">üíé</span><span class="curr-text">ETH</span></span>
      <span class="curr-link" data-curr="btc"><span class="curr-flag">üü†</span><span class="curr-text">BTC</span></span>
    </div>
  </div>

  <main>
    <div class="content-grid">
      <!-- Thank You Section (shown when ?thanks=1) -->
      <div class="thanks-section">
        <div class="thanks-canvas-wrap">
          <canvas class="thanks-canvas" id="thanksCanvas" width="560" height="560"></canvas>
        </div>
        <p class="thanks-message" data-lang="en">
          Thank you for giving <span class="thanks-amount" id="thanksAmountEn">$25</span> and keeping Aesthetic.Computer online and free to use.
        </p>
        <p class="thanks-message" data-lang="da">
          Tak for at give <span class="thanks-amount" id="thanksAmountDa">$25</span> og holde Aesthetic.Computer online og gratis at bruge.
        </p>
        <div class="thanks-actions">
          <a href="./" class="thanks-again" data-lang="en">Give again?</a>
          <a href="./" class="thanks-again" data-lang="da">Giv igen?</a>
          <button class="thanks-share" id="shareBtn" data-lang="en">Share to ùïè</button>
          <button class="thanks-share" id="shareBtnDa" data-lang="da">Del p√• ùïè</button>
        </div>
      </div>

      <div class="fiat-section full-width">
        <div class="currency-pickers">
          <div class="currency-picker" data-for="usd">
            <div class="gift-widget" data-currency="usd">
              <div class="gift-visual">
                <div class="gift-logo-wrap">
                  <img src="https://aesthetic.computer/purple-pals.svg" class="gift-logo" alt="">
                  <div class="gift-amount">$125</div>
                </div>
              </div>
              <div class="gift-controls">
                <input type="range" min="5" max="500" step="5" value="125">
                <button class="gift-btn" data-currency="usd">Give $125</button>
                <label class="gift-monthly-check">
                  <input type="checkbox" class="monthly-checkbox">
                  <span data-lang="en">Repeat monthly</span>
                  <span data-lang="da">Gentag m√•nedligt</span>
                </label>
              </div>
            </div>
          </div>
          <div class="currency-picker" data-for="dkk" style="display: none;">
            <div class="gift-widget" data-currency="dkk">
              <div class="gift-visual">
                <div class="gift-logo-wrap">
                  <img src="https://aesthetic.computer/purple-pals.svg" class="gift-logo" alt="">
                  <div class="gift-amount">200 kr</div>
                </div>
              </div>
              <div class="gift-controls">
                <input type="range" min="25" max="7000" step="25" value="200">
                <button class="gift-btn" data-currency="dkk">Giv 200 kr</button>
                <label class="gift-monthly-check">
                  <input type="checkbox" class="monthly-checkbox">
                  <span data-lang="en">Repeat monthly</span>
                  <span data-lang="da">Gentag m√•nedligt</span>
                </label>
              </div>
            </div>
          </div>
          <div class="currency-picker" data-for="xtz" style="display: none;">
            <div class="gift-widget crypto" data-currency="xtz">
              <div class="gift-visual">
                <div class="gift-logo-wrap">
                  <img src="https://aesthetic.computer/purple-pals.svg" class="gift-logo" alt="">
                  <div class="gift-amount crypto-amount">üîÆ XTZ</div>
                </div>
              </div>
              <div class="crypto-controls">
                <div class="crypto-address copyable" data-copy="tz1WqvhbfEwfqAzMtEGxc7x6tpSqRMCNKPCT">
                  <span class="crypto-label">aesthetic.tez</span>
                  <code class="crypto-addr">tz1WqvhbfEwfqAzMtEGxc7x6tpSqRMCNKPCT</code>
                  <span class="crypto-copy-hint" data-lang="en">üìã tap to copy address</span>
                  <span class="crypto-copy-hint" data-lang="da">üìã tryk for at kopiere adresse</span>
                </div>
              </div>
            </div>
          </div>
          <div class="currency-picker" data-for="eth" style="display: none;">
            <div class="gift-widget crypto" data-currency="eth">
              <div class="gift-visual">
                <div class="gift-logo-wrap">
                  <img src="https://aesthetic.computer/purple-pals.svg" class="gift-logo" alt="">
                  <div class="gift-amount crypto-amount">üíé ETH</div>
                </div>
              </div>
              <div class="crypto-controls">
                <div class="crypto-address copyable" data-copy="0x1D64E3eFa983D945cBFe29Ad5b3C8ABB53Aef023">
                  <span class="crypto-label">4esthetic.eth</span>
                  <code class="crypto-addr">0x1D64E3eFa983D945cBFe29Ad5b3C8ABB53Aef023</code>
                  <span class="crypto-copy-hint" data-lang="en">üìã tap to copy address</span>
                  <span class="crypto-copy-hint" data-lang="da">üìã tryk for at kopiere adresse</span>
                </div>
              </div>
            </div>
          </div>
          <div class="currency-picker" data-for="btc" style="display: none;">
            <div class="gift-widget crypto" data-currency="btc">
              <div class="gift-visual">
                <div class="gift-logo-wrap">
                  <img src="https://aesthetic.computer/purple-pals.svg" class="gift-logo" alt="">
                  <div class="gift-amount crypto-amount">üü† BTC</div>
                </div>
              </div>
              <div class="crypto-controls">
                <div class="crypto-address copyable" data-copy="bc1q699gnqr92gvgv62nla82typpj3wls5a8xf59as">
                  <span class="crypto-label">Bitcoin</span>
                  <code class="crypto-addr">bc1q699gnqr92gvgv62nla82typpj3wls5a8xf59as</code>
                  <span class="crypto-copy-hint" data-lang="en">üìã tap to copy address</span>
                  <span class="crypto-copy-hint" data-lang="da">üìã tryk for at kopiere adresse</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <small class="fiat-note fiat-only" data-lang="en">Card payments processed via Stripe. Not tax-deductible.</small>
        <small class="fiat-note fiat-only" data-lang="da">Kortbetalinger behandles via Stripe. Ikke fradragsberettiget.</small>
        <small class="fiat-note crypto-only" data-lang="en" style="display:none;">Crypto sent directly to wallet. Not tax-deductible.</small>
        <small class="fiat-note crypto-only" data-lang="da" style="display:none;">Crypto sendes direkte til wallet. Ikke fradragsberettiget.</small>
      </div>

      <div class="prose full-width" data-lang="en">
        <a href="https://aesthetic.computer">Aesthetic<span style="color: var(--cyan);">.</span>Computer</a> is a culture of its users and the full-time software engineering practice of <a href="https://aesthetic.computer/@jeffrey" class="handle-link">@jeffrey</a>, who has been building experimental software instruments for over a decade. He lives in Echo Park, Los Angeles, and regularly demos the software at the <a href="https://nelacomputer.club">NELA Computer Club</a> in Chinatown.
      </div>
      <div class="prose full-width" data-lang="da">
        <a href="https://aesthetic.computer">Aesthetic<span style="color: var(--cyan);">.</span>Computer</a> er en kultur af sine brugere og den fuldtids softwareudviklingspraksis af <a href="https://aesthetic.computer/@jeffrey" class="handle-link">@jeffrey</a>, som har bygget eksperimentelle software-instrumenter i over et √•rti. Han bor i Echo Park, Los Angeles, og demonstrerer regelm√¶ssigt softwaren ved <a href="https://nelacomputer.club">NELA Computer Club</a> i Chinatown.
      </div>

      <div class="stats-section">
        <div class="stat-item">
          <div class="stat-value">4,217</div>
          <div class="stat-label">users</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">4,108</div>
          <div class="stat-label">paintings</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">2,827</div>
          <div class="stat-label">moods</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">12,933</div>
          <div class="stat-label">kidlisp</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">847</div>
          <div class="stat-label">pieces</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">156</div>
          <div class="stat-label">prompts</div>
        </div>
      </div>

      <div class="kidlisp-preview">
        <a href="https://kidlisp.com" class="kidlisp-preview-header">
          <strong class="kidlisp-logo" style="font-family: 'Comic Sans MS', cursive; font-size: 1.1em;"><span style="color:#FF6B6B">K</span><span style="color:#4ECDC4">i</span><span style="color:#FFE66D">d</span><span style="color:#95E1D3">L</span><span style="color:#F38181">i</span><span style="color:#AA96DA">s</span><span style="color:#70D6FF">p</span><span style="color:var(--dim)">.</span><span style="color:#70D6FF">com</span></strong>
        </a>
        <div class="kidlisp-carousel" id="kidlispCarousel">
          <div class="kidlisp-slide-loading"></div>
        </div>
        <!-- Auto-advance progress bar -->
        <div class="kidlisp-auto-progress">
          <div class="kidlisp-auto-progress-bar" id="kidlispAutoProgress"></div>
        </div>
        <div class="module-caption">
          <span data-lang="en">A creative coding language for all ages</span>
          <span data-lang="da">Et kreativt kodesprog for alle aldre</span>
        </div>
      </div>

      <div class="chat-flip-container">
        <div class="chat-flip-card" id="chatFlipCard">
          <!-- Front: laer-klokken (active when not flipped) -->
          <div class="chat-flip-face chat-flip-front chat-preview">
            <div class="chat-preview-header chat-flip-trigger" onclick="toggleChatFlip()">
              <strong>üïê laer-klokken</strong>
            </div>
            <div class="chat-messages" id="chatMessages">
              <div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Loading...</div></div>
            </div>
            <div class="module-caption chat-flip-trigger" onclick="toggleChatFlip()">
              <span data-lang="en">Goodiepal's Danish music community</span>
              <span data-lang="da">Goodiepals danske musikf√¶llesskab</span>
            </div>
          </div>
          
          <!-- Back: chat-system (ghost overlay when not flipped, active when flipped) -->
          <div class="chat-flip-face chat-flip-back chat-preview-system">
            <div class="chat-system-header chat-flip-trigger" onclick="toggleChatFlip()">
              <strong>üí¨ chat</strong>
            </div>
            <div class="chat-messages" id="chatSystemMessages">
              <div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Loading...</div></div>
            </div>
            <div class="module-caption chat-flip-trigger" onclick="toggleChatFlip()">
              <span data-lang="en">Global Aesthetic Computer chat</span>
              <span data-lang="da">Global Aesthetic Computer chat</span>
            </div>
          </div>
        </div>
        <!-- Progress bar for swivel timer - outside flip card, at bottom of container -->
        <div class="chat-flip-progress">
          <div class="chat-flip-progress-bar" id="chatFlipProgress"></div>
        </div>
      </div>

      <div class="link-block notepat-section">
        <strong>üéπ notepat</strong>
        <a href="https://aesthetic.computer/notepat">aesthetic.computer/notepat</a>
        <span class="link-desc" data-lang="en">Musical keyboard</span>
        <span class="link-desc" data-lang="da">Musikkeyboard</span>
      </div>

      <div class="tv-section">
        <a href="https://aesthetic.computer/tapes" class="tv-header">
          <strong>üìº tapes</strong>
        </a>
        <div class="tv-player" id="tvPlayer">
          <div class="tv-loading">üì∫</div>
        </div>
        <!-- Auto-advance progress bar -->
        <div class="tv-auto-progress">
          <div class="tv-auto-progress-bar" id="tvAutoProgress"></div>
        </div>
        <div class="module-caption">
          <span data-lang="en">Community video feed</span>
          <span data-lang="da">F√¶llesskabets video-feed</span>
        </div>
      </div>

      <div class="link-block desktop-section">
        <strong>üñ•Ô∏è desktop <span class="desktop-version" id="desktopVersion">v0.1.0</span></strong>
        <a href="https://aesthetic.computer/desktop">aesthetic.computer/desktop</a>
        <span class="link-desc" data-lang="en">Native apps for Mac, Windows & Linux</span>
        <span class="link-desc" data-lang="da">Native apps til Mac, Windows & Linux</span>
        <div class="desktop-downloads" id="desktopDownloads">
          <a href="https://aesthetic.computer/desktop/mac" class="desktop-btn" title="Download for macOS (Universal)">
            <span class="desktop-icon">üçé</span>
            <span class="desktop-label">Mac</span>
            <span class="desktop-btn-info" id="macInfo"></span>
          </a>
          <a href="https://aesthetic.computer/desktop/win" class="desktop-btn" title="Download for Windows (64-bit)">
            <span class="desktop-icon">ü™ü</span>
            <span class="desktop-label">Windows</span>
            <span class="desktop-btn-info" id="winInfo"></span>
          </a>
          <a href="https://aesthetic.computer/desktop/linux" class="desktop-btn" title="Download for Linux (AppImage)">
            <span class="desktop-icon">üêß</span>
            <span class="desktop-label">Linux</span>
            <span class="desktop-btn-info" id="linuxInfo"></span>
          </a>
        </div>
        <div class="desktop-release-info" id="desktopReleaseInfo" style="display: none;">
          <div class="desktop-release-name" id="releaseName"></div>
          <div class="desktop-release-date" id="releaseDate"></div>
          <div class="desktop-changelog" id="releaseChangelog"></div>
        </div>
      </div>

      <div class="shop-section">
        <div class="shop-header">
          <a href="https://shop.aesthetic.computer" class="shop-title">shop</a>
        </div>
        <div class="shop-products" id="shopProducts">
          <div class="shop-loading">Loading...</div>
        </div>
        <!-- Auto-advance progress bar -->
        <div class="shop-auto-progress">
          <div class="shop-auto-progress-bar" id="shopAutoProgress"></div>
        </div>
      </div>

      <div class="link-block invest-section">
        <strong>üìà</strong> <span data-lang="en"><strong>Invest</strong></span><span data-lang="da"><strong>Invest√©r</strong></span>
        <a href="https://aesthetic.direct">aesthetic.direct</a>
        <span class="link-desc" data-lang="en">Equity investment opportunities</span>
        <span class="link-desc" data-lang="da">Aktieinvesteringsmuligheder</span>
      </div>

      <a id="pals" href="https://aesthetic.computer">
        <img src="https://aesthetic.computer/purple-pals.svg" alt="AC">
      </a>
    </div>
  </main>

  <script>
    // Language selector (dropdown)
    const langSelector = document.getElementById('langSelector');
    const langFlag = document.getElementById('lang-flag');
    const langText = document.getElementById('lang-text');
    const langDropdown = document.getElementById('lang-dropdown');
    const langOptions = langDropdown.querySelectorAll('.lang-option');
    
    // Currency selector (pills)
    const currSelector = document.getElementById('currSelector');
    const currOptions = currSelector.querySelectorAll('.curr-link');
    const currencyPickers = document.querySelectorAll('.currency-picker');

    // Language dropdown toggle
    langSelector.addEventListener('click', (e) => {
      if (e.target.closest('.lang-option')) return;
      e.stopPropagation();
      langSelector.classList.toggle('open');
    });
    
    // Close dropdown on outside click
    document.addEventListener('click', () => {
      langSelector.classList.remove('open');
    });

    // Language selection
    langOptions.forEach(opt => {
      opt.addEventListener('click', (e) => {
        e.stopPropagation();
        const lang = opt.dataset.lang;
        setLanguage(lang);
        updateLangUI(lang);
        langSelector.classList.remove('open');
        localStorage.setItem('gift-lang', lang);
      });
    });
    
    function updateLangUI(lang) {
      const langData = { en: { flag: 'üá∫üá∏', text: 'English' }, da: { flag: 'üá©üá∞', text: 'Dansk' } };
      const info = langData[lang] || langData.en;
      langFlag.textContent = info.flag;
      langText.textContent = info.text;
    }

    // Currency selection (pills)
    currOptions.forEach(opt => {
      opt.addEventListener('click', (e) => {
        e.stopPropagation();
        const curr = opt.dataset.curr;
        setCurrency(curr);
        localStorage.setItem('gift-curr', curr);
      });
    });
    
    function setCurrency(curr) {
      currOptions.forEach(opt => opt.classList.toggle('active', opt.dataset.curr === curr));
      currencyPickers.forEach(picker => {
        picker.style.display = picker.dataset.for === curr ? '' : 'none';
      });
      
      // Toggle fiat vs crypto notes
      const isCrypto = ['xtz', 'eth', 'btc'].includes(curr);
      document.querySelectorAll('.fiat-only').forEach(el => el.style.display = isCrypto ? 'none' : '');
      document.querySelectorAll('.crypto-only').forEach(el => el.style.display = isCrypto ? '' : 'none');
    }

    // Check for thank-you mode
    const urlParams = new URLSearchParams(window.location.search);
    const isThanksMode = urlParams.has('thanks') || urlParams.get('thanks') === '1';
    const thanksAmount = urlParams.get('amount');
    const thanksCurrency = urlParams.get('currency') || 'usd';
    
    if (isThanksMode) {
      document.body.classList.add('thanks-mode');
      // Update amount display
      const amountEn = document.getElementById('thanksAmountEn');
      const amountDa = document.getElementById('thanksAmountDa');
      const formattedAmount = thanksAmount 
        ? (thanksCurrency === 'dkk' ? `${thanksAmount} kr` : `$${thanksAmount}`)
        : '$25';
      if (thanksAmount) {
        if (amountEn) amountEn.textContent = formattedAmount;
        if (amountDa) amountDa.textContent = formattedAmount;
      }
      
      // üåà PSYCHO THANKS CANVAS with pals.svg + heart
      const canvas = document.getElementById('thanksCanvas');
      if (canvas) {
        const ctx = canvas.getContext('2d');
        const W = canvas.width, H = canvas.height;
        let t = 0;
        let palsImg = null;
        let palsLoaded = false;
        
        // Load pals.svg
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = () => { palsImg = img; palsLoaded = true; };
        img.src = 'https://aesthetic.computer/purple-pals.svg';
        
        function hslToRgb(h, s, l) {
          let r, g, b;
          if (s === 0) { r = g = b = l; }
          else {
            const hue2rgb = (p, q, t) => {
              if (t < 0) t += 1;
              if (t > 1) t -= 1;
              if (t < 1/6) return p + (q - p) * 6 * t;
              if (t < 1/2) return q;
              if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
              return p;
            };
            const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
            const p = 2 * l - q;
            r = hue2rgb(p, q, h + 1/3);
            g = hue2rgb(p, q, h);
            b = hue2rgb(p, q, h - 1/3);
          }
          return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }
        
        function drawHeart(cx, cy, size, color, glow = 0) {
          ctx.save();
          ctx.translate(cx, cy);
          ctx.beginPath();
          const s = size;
          ctx.moveTo(0, s * 0.3);
          ctx.bezierCurveTo(-s * 0.5, -s * 0.3, -s, s * 0.1, 0, s);
          ctx.bezierCurveTo(s, s * 0.1, s * 0.5, -s * 0.3, 0, s * 0.3);
          ctx.closePath();
          if (glow > 0) {
            ctx.shadowColor = color;
            ctx.shadowBlur = glow;
          }
          ctx.fillStyle = color;
          ctx.fill();
          ctx.restore();
        }
        
        function animate() {
          t += 0.025;
          
          // Background gradient that shifts
          const bgHue = (t * 0.02) % 1;
          const [bgr, bgg, bgb] = hslToRgb(bgHue, 0.15, 0.12);
          const [bgr2, bgg2, bgb2] = hslToRgb((bgHue + 0.5) % 1, 0.2, 0.08);
          const grad = ctx.createRadialGradient(W/2, H/2, 0, W/2, H/2, W * 0.7);
          grad.addColorStop(0, `rgb(${bgr},${bgg},${bgb})`);
          grad.addColorStop(1, `rgb(${bgr2},${bgg2},${bgb2})`);
          ctx.fillStyle = grad;
          ctx.fillRect(0, 0, W, H);
          
          // Main color cycling
          const hue = (t * 0.08) % 1;
          
          // Floating particles in background
          for (let i = 0; i < 20; i++) {
            const px = (W * 0.1 + (i * 137.5 + t * 30) % (W * 0.8));
            const py = (H * 0.1 + (i * 89.3 + t * 20 + Math.sin(t + i) * 30) % (H * 0.8));
            const psize = 3 + Math.sin(t * 2 + i) * 2;
            const phue = (hue + i * 0.05) % 1;
            const [pr, pg, pb] = hslToRgb(phue, 0.8, 0.6);
            ctx.beginPath();
            ctx.arc(px, py, psize, 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${pr},${pg},${pb},${0.3 + Math.sin(t * 3 + i) * 0.2})`;
            ctx.fill();
          }
          
          // Draw pals.svg with animation
          if (palsLoaded && palsImg) {
            const palsPulse = 1 + Math.sin(t * 2) * 0.03;
            const palsWobble = Math.sin(t * 1.5) * 0.02;
            const palsSize = 320 * palsPulse;
            
            ctx.save();
            ctx.translate(W/2, H/2 + 20);
            ctx.rotate(palsWobble);
            ctx.drawImage(palsImg, -palsSize/2, -palsSize/2, palsSize, palsSize);
            ctx.restore();
          }
          
          // Heart in top right corner
          const heartX = W - 90;
          const heartY = 85;
          const heartPulse = 1 + Math.sin(t * 4) * 0.18;
          const heartWobble = Math.sin(t * 6) * 0.08;
          
          const [r, g, b] = hslToRgb(hue, 0.9, 0.55);
          const mainColor = `rgb(${r},${g},${b})`;
          const glowHue = (hue + 0.1) % 1;
          const [gr, gg, gb] = hslToRgb(glowHue, 1, 0.6);
          const glowColor = `rgba(${gr},${gg},${gb},0.6)`;
          
          ctx.save();
          ctx.translate(heartX, heartY);
          ctx.rotate(heartWobble);
          ctx.scale(heartPulse, heartPulse);
          
          // Outer glow heart
          drawHeart(0, 0, 55, glowColor, 25);
          // Main heart
          drawHeart(0, 0, 45, mainColor, 10);
          // Inner highlight
          const [hr, hg, hb] = hslToRgb((hue + 0.5) % 1, 0.8, 0.75);
          drawHeart(-8, -12, 18, `rgba(${hr},${hg},${hb},0.7)`);
          
          ctx.restore();
          
          // Sparkles around heart
          for (let i = 0; i < 8; i++) {
            const angle = t * 1.5 + i * 0.78;
            const dist = 70 + Math.sin(t * 2.5 + i) * 15;
            const sx = heartX + Math.cos(angle) * dist;
            const sy = heartY + Math.sin(angle) * dist;
            const sparkSize = 4 + Math.sin(t * 4 + i * 2) * 3;
            const sparkHue = (hue + i * 0.125) % 1;
            const [sr, sg, sb] = hslToRgb(sparkHue, 1, 0.7);
            ctx.beginPath();
            ctx.arc(sx, sy, Math.max(1, sparkSize), 0, Math.PI * 2);
            ctx.fillStyle = `rgba(${sr},${sg},${sb},${0.6 + Math.sin(t * 3 + i) * 0.3})`;
            ctx.fill();
          }
          
          // Amount text at bottom
          ctx.save();
          ctx.font = 'bold 32px "ywft", sans-serif';
          ctx.textAlign = 'center';
          ctx.textBaseline = 'middle';
          const textHue = (hue + 0.3) % 1;
          const [tr, tg, tb] = hslToRgb(textHue, 0.9, 0.65);
          ctx.fillStyle = `rgb(${tr},${tg},${tb})`;
          ctx.shadowColor = `rgba(${tr},${tg},${tb},0.5)`;
          ctx.shadowBlur = 15;
          ctx.fillText(`gave ${formattedAmount}`, W/2, H - 60);
          ctx.restore();
          
          // "give.aesthetic.computer" watermark
          ctx.save();
          ctx.font = '18px "berkeley", monospace';
          ctx.textAlign = 'center';
          ctx.fillStyle = 'rgba(255,255,255,0.4)';
          ctx.fillText('give.aesthetic.computer', W/2, H - 25);
          ctx.restore();
          
          requestAnimationFrame(animate);
        }
        animate();
        
        // Share to X functionality
        const shareBtn = document.getElementById('shareBtn');
        const shareBtnDa = document.getElementById('shareBtnDa');
        
        async function shareToX() {
          // Capture current canvas frame
          const dataUrl = canvas.toDataURL('image/png');
          
          // Try Web Share API first (mobile)
          if (navigator.share && navigator.canShare) {
            try {
              const blob = await (await fetch(dataUrl)).blob();
              const file = new File([blob], 'aesthetic-computer-gift.png', { type: 'image/png' });
              if (navigator.canShare({ files: [file] })) {
                await navigator.share({
                  text: `I just gave ${formattedAmount} to Aesthetic.Computer! üíñ give.aesthetic.computer`,
                  files: [file]
                });
                return;
              }
            } catch (e) {
              console.log('Web Share failed, falling back to Twitter intent');
            }
          }
          
          // Fallback: Download image + open Twitter
          const link = document.createElement('a');
          link.download = 'aesthetic-computer-gift.png';
          link.href = dataUrl;
          link.click();
          
          // Open Twitter intent
          const tweetText = encodeURIComponent(`I just gave ${formattedAmount} to Aesthetic.Computer! üíñ\n\ngive.aesthetic.computer`);
          window.open(`https://twitter.com/intent/tweet?text=${tweetText}`, '_blank');
        }
        
        if (shareBtn) shareBtn.addEventListener('click', shareToX);
        if (shareBtnDa) shareBtnDa.addEventListener('click', shareToX);
      }
    }

    // Load saved language or detect from browser
    let currentLang = localStorage.getItem('gift-lang');
    if (!currentLang) {
      currentLang = navigator.language.startsWith('da') ? 'da' : 'en';
    }
    setLanguage(currentLang);
    updateLangUI(currentLang);
    
    // Restore saved currency
    const savedCurr = localStorage.getItem('gift-curr');
    if (savedCurr) {
      setCurrency(savedCurr);
    } else if (currentLang === 'da') {
      setCurrency('dkk');
    } else {
      setCurrency('usd');
    }

    function setLanguage(lang) {
      currentLang = lang;
      document.body.classList.toggle('lang-da', lang === 'da');

      // Update fiat button text (skip crypto widgets)
      document.querySelectorAll('.gift-widget:not(.crypto)').forEach(widget => {
        const currency = widget.dataset.currency;
        const slider = widget.querySelector('input[type="range"]');
        if (!slider) return;
        const value = parseInt(slider.value);
        const btn = widget.querySelector('.gift-btn');
        const isMonthly = widget._isMonthly ? widget._isMonthly() : false;
        if (currency === 'dkk') {
          btn.textContent = lang === 'da' ? `Giv ${value} kr` : `Give ${value} kr`;
        } else if (isMonthly) {
          btn.textContent = lang === 'da' ? `Giv $${value}/m√•ned` : `Give $${value}/month`;
        } else {
          btn.textContent = lang === 'da' ? `Giv $${value}` : `Give $${value}`;
        }
      });
      
      // Update crypto send button text
      document.querySelectorAll('.gift-widget.crypto').forEach(widget => {
        const slider = widget.querySelector('.crypto-slider');
        const sendBtn = widget.querySelector('.crypto-send');
        if (slider && sendBtn) {
          const currency = slider.dataset.currency;
          const value = currency === 'eth' ? parseFloat(slider.value).toFixed(2) : parseInt(slider.value);
          const symbol = currency === 'eth' ? 'Œû' : 'Íú©';
          sendBtn.textContent = lang === 'da' ? `Send ${value} ${symbol}` : `Send ${value} ${symbol}`;
        }
      });
    }

    // Slider functionality
    document.querySelectorAll('.gift-widget:not(.crypto)').forEach(widget => {
      const currency = widget.dataset.currency;
      const slider = widget.querySelector('input[type="range"]');
      const amountEl = widget.querySelector('.gift-amount');
      const btn = widget.querySelector('.gift-btn');
      const monthlyCheck = widget.querySelector('.monthly-checkbox');
      const monthlyLabel = widget.querySelector('.gift-monthly-check');
      let isMonthly = false;

      // Monthly checkbox
      if (monthlyCheck) {
        monthlyCheck.addEventListener('change', () => {
          isMonthly = monthlyCheck.checked;
          monthlyLabel.classList.toggle('checked', isMonthly);
          
          // Adjust slider range for monthly vs one-time
          if (isMonthly) {
            slider.min = 5;
            slider.max = 100;
            slider.step = 5;
            if (parseInt(slider.value) > 100) slider.value = 25;
          } else {
            slider.min = 5;
            slider.max = 500;
            slider.step = 5;
          }
          update();
        });
      }

      function format(v) {
        return currency === 'dkk' ? `${v} kr` : `$${v}`;
      }

      function update() {
        const value = parseInt(slider.value);
        const suffix = isMonthly ? '/mo' : '';
        amountEl.textContent = format(value) + suffix;
        const lang = document.body.classList.contains('lang-da') ? 'da' : 'en';
        if (currency === 'dkk') {
          btn.textContent = lang === 'da' ? `Giv ${format(value)}` : `Give ${format(value)}`;
        } else if (isMonthly) {
          btn.textContent = lang === 'da' ? `Giv ${format(value)}/m√•ned` : `Give ${format(value)}/month`;
        } else {
          btn.textContent = lang === 'da' ? `Giv ${format(value)}` : `Give ${format(value)}`;
        }
      }

      slider.addEventListener('input', update);
      update();
      
      // Store isMonthly state on widget for button handler
      widget._isMonthly = () => isMonthly;
    });

    document.querySelectorAll('.gift-widget:not(.crypto) .gift-btn').forEach(btn => {
      btn.onclick = async () => {
        const currency = btn.dataset.currency;
        const widget = btn.closest('.gift-widget');
        const slider = widget.querySelector('input[type="range"]');
        const value = parseInt(slider.value);
        const isMonthly = widget._isMonthly ? widget._isMonthly() : false;
        
        btn.textContent = currentLang === 'da' ? 'Omdirigerer...' : 'Redirecting...';
        btn.disabled = true;

        try {
          const res = await fetch('https://aesthetic.computer/api/give', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ amount: value * 100, currency, recurring: isMonthly })
          });
          const data = await res.json();
          if (data.url) window.location.href = data.url;
          else throw new Error(data.error || 'No URL returned');
        } catch (err) {
          console.error('Give error:', err);
          const fmt = currency === 'dkk' ? `${value} kr` : `$${value}`;
          const suffix = isMonthly ? '/month' : '';
          btn.textContent = currentLang === 'da' ? `Giv ${fmt}${isMonthly ? '/m√•ned' : ''}` : `Give ${fmt}${suffix}`;
          btn.disabled = false;
          alert(currentLang === 'da' ? 'Noget gik galt' : 'Something went wrong');
        }
      };
    });

    function copyAddress(el) {
      const text = el.dataset.copy;
      navigator.clipboard.writeText(text);
      el.classList.add('copied');
      
      // Update hint text to "Copied!"
      const hints = el.querySelectorAll('.crypto-copy-hint');
      hints.forEach(hint => {
        const origText = hint.textContent;
        hint.textContent = '‚úì ' + (hint.dataset.lang === 'da' ? 'Kopieret!' : 'Copied!');
        setTimeout(() => hint.textContent = origText, 1200);
      });
      
      setTimeout(() => el.classList.remove('copied'), 1200);
    }

    // Make crypto addresses/labels copyable
    document.querySelectorAll('.copyable').forEach(el => {
      el.addEventListener('click', () => copyAddress(el));
    });

    // Crypto prices
    let cryptoPrices = { xtz: null, eth: null };
    
    async function fetchCryptoPrices() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=tezos,ethereum&vs_currencies=usd');
        const data = await res.json();
        cryptoPrices.xtz = data.tezos?.usd || null;
        cryptoPrices.eth = data.ethereum?.usd || null;
        updateAllCryptoDisplays();
      } catch (e) {
        console.log('Could not fetch crypto prices');
      }
    }
    
    function updateAllCryptoDisplays() {
      document.querySelectorAll('.crypto-slider').forEach(slider => {
        const currency = slider.dataset.currency;
        const widget = slider.closest('.gift-widget');
        updateCryptoDisplay(widget, slider, currency);
      });
    }
    
    function updateCryptoDisplay(widget, slider, currency) {
      const amountEl = widget.querySelector('.gift-amount');
      const sendBtn = widget.querySelector('.crypto-send');
      const usdEl = widget.querySelector('.crypto-usd');
      
      const value = currency === 'eth' ? parseFloat(slider.value).toFixed(2) : parseInt(slider.value);
      const symbol = currency === 'eth' ? 'Œû' : 'Íú©';
      const emoji = currency === 'eth' ? 'üíé' : 'üîÆ';
      
      amountEl.textContent = `${emoji} ${value} ${symbol}`;
      sendBtn.textContent = `Send ${value} ${symbol}`;
      
      const price = cryptoPrices[currency];
      if (price && usdEl) {
        const usdValue = (parseFloat(value) * price).toFixed(2);
        usdEl.textContent = `‚âà $${usdValue}`;
      }
    }

    // Crypto slider functionality
    document.querySelectorAll('.crypto-slider').forEach(slider => {
      const widget = slider.closest('.gift-widget');
      const currency = slider.dataset.currency;
      
      slider.addEventListener('input', () => updateCryptoDisplay(widget, slider, currency));
      updateCryptoDisplay(widget, slider, currency);
    });
    
    // Fetch prices on load
    fetchCryptoPrices();

    // Tezos wallet connect (Beacon)
    async function sendTezos(amount) {
      const btn = document.querySelector('[data-currency="xtz"].crypto-send');
      const origText = btn.textContent;
      
      try {
        btn.textContent = currentLang === 'da' ? 'Forbinder...' : 'Connecting...';
        btn.disabled = true;
        
        // Use Beacon SDK via script tag approach
        if (!window.beacon) {
          // Load Beacon SDK
          await new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = 'https://unpkg.com/@airgap/beacon-sdk@4.0.12/dist/walletbeacon.min.js';
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
          });
        }
        
        const client = new window.beacon.DAppClient({ name: 'Aesthetic Computer Gift' });
        
        btn.textContent = currentLang === 'da' ? 'V√¶lg tegnebog...' : 'Select wallet...';
        await client.requestPermissions();
        
        btn.textContent = currentLang === 'da' ? 'Bekr√¶ft i tegnebog...' : 'Confirm in wallet...';
        const response = await client.requestOperation({
          operationDetails: [{
            kind: 'transaction',
            destination: 'tz1WqvhbfEwfqAzMtEGxc7x6tpSqRMCNKPCT',
            amount: String(Math.floor(amount * 1000000)), // mutez
            fee: '1500',        // suggested fee in mutez (~0.0015 XTZ)
            gasLimit: '10600',  // typical gas for simple transfer
            storageLimit: '300' // typical storage for simple transfer
          }]
        });
        
        btn.textContent = currentLang === 'da' ? '‚úì Sendt!' : '‚úì Sent!';
        console.log('TX:', response.transactionHash);
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 3000);
        
      } catch (err) {
        console.error('Tezos error:', err);
        btn.textContent = err.message?.includes('Aborted') 
          ? (currentLang === 'da' ? 'Annulleret' : 'Cancelled')
          : (currentLang === 'da' ? 'Fejl - pr√∏v igen' : 'Error - try again');
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 2000);
      }
    }

    // Ethereum wallet connect
    async function sendEthereum(amount) {
      const btn = document.querySelector('[data-currency="eth"].crypto-send');
      const origText = btn.textContent;
      
      try {
        btn.textContent = currentLang === 'da' ? 'Forbinder...' : 'Connecting...';
        btn.disabled = true;
        
        if (!window.ethereum) {
          alert(currentLang === 'da' ? 'Install√©r MetaMask eller en anden Ethereum-tegnebog' : 'Please install MetaMask or another Ethereum wallet');
          throw new Error('No wallet');
        }
        
        btn.textContent = currentLang === 'da' ? 'Godkend forbindelse...' : 'Approve connection...';
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        
        if (!accounts.length) throw new Error('No account');
        
        const amountWei = '0x' + (BigInt(Math.floor(amount * 1e18))).toString(16);
        
        btn.textContent = currentLang === 'da' ? 'Bekr√¶ft i tegnebog...' : 'Confirm in wallet...';
        const txHash = await window.ethereum.request({
          method: 'eth_sendTransaction',
          params: [{
            from: accounts[0],
            to: '0x1D64E3eFa983D945cBFe29Ad5b3C8ABB53Aef023',
            value: amountWei
          }]
        });
        
        btn.textContent = currentLang === 'da' ? '‚úì Sendt!' : '‚úì Sent!';
        console.log('TX:', txHash);
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 3000);
        
      } catch (err) {
        console.error('Ethereum error:', err);
        if (err.message !== 'No wallet') {
          btn.textContent = currentLang === 'da' ? 'Annulleret' : 'Cancelled';
        }
        setTimeout(() => {
          btn.textContent = origText;
          btn.disabled = false;
        }, 2000);
      }
    }

    // Wire up crypto send buttons
    document.querySelectorAll('.crypto-send').forEach(btn => {
      btn.addEventListener('click', () => {
        const widget = btn.closest('.gift-widget');
        const slider = widget.querySelector('.crypto-slider');
        const currency = slider.dataset.currency;
        const value = currency === 'eth' ? parseFloat(slider.value) : parseInt(slider.value);
        
        if (currency === 'xtz') {
          sendTezos(value);
        } else if (currency === 'eth') {
          sendEthereum(value);
        }
      });
    });

    // Live reload in dev mode
    if (location.hostname === 'localhost' || location.hostname.includes('local')) {
      const wsUrl = location.protocol === 'https:' 
        ? 'wss://localhost:8889' 
        : 'ws://localhost:8889';
      
      function connectWS() {
        const ws = new WebSocket(wsUrl);
        ws.onopen = () => console.log('üîÑ Live reload connected');
        ws.onmessage = (e) => {
          try {
            const msg = JSON.parse(e.data);
            if (msg.type === 'reload' && msg.content?.piece === '*refresh*') {
              console.log('üîÑ Reloading...');
              location.reload();
            }
          } catch {}
        };
        ws.onclose = () => setTimeout(connectWS, 2000);
        ws.onerror = () => ws.close();
      }
      connectWS();
    }

    // Fetch shop products - single rotating display
    let shopProducts = [];
    let shopIndex = 0;
    let shopProgressAnim = null;
    const SHOP_INTERVAL = 4000; // 4 seconds between products
    
    function animateShopProgress() {
      const progressBar = document.getElementById('shopAutoProgress');
      if (!progressBar) return;
      
      let startTime = null;
      
      function step(timestamp) {
        if (!startTime) startTime = timestamp;
        const elapsed = timestamp - startTime;
        const pct = Math.min((elapsed / SHOP_INTERVAL) * 100, 100);
        progressBar.style.width = pct + '%';
        
        if (elapsed < SHOP_INTERVAL) {
          shopProgressAnim = requestAnimationFrame(step);
        }
      }
      
      if (shopProgressAnim) cancelAnimationFrame(shopProgressAnim);
      progressBar.style.width = '0%';
      shopProgressAnim = requestAnimationFrame(step);
    }
    
    async function loadShopProducts() {
      const container = document.getElementById('shopProducts');
      try {
        const res = await fetch('https://aesthetic.computer/api/shop');
        const data = await res.json();
        
        if (!data.products?.length) {
          container.innerHTML = '<div class="shop-loading">No products available</div>';
          return;
        }
        
        shopProducts = data.products;
        showShopProduct(0);
        animateShopProgress();
        
        // Rotate every 4 seconds
        setInterval(() => {
          shopIndex = (shopIndex + 1) % shopProducts.length;
          showShopProduct(shopIndex);
          animateShopProgress();
        }, SHOP_INTERVAL);
      } catch (e) {
        console.error('Shop load error:', e);
        container.innerHTML = '<a href="https://shop.aesthetic.computer" class="shop-loading">Visit shop ‚Üí</a>';
      }
    }
    
    function showShopProduct(index) {
      const container = document.getElementById('shopProducts');
      const p = shopProducts[index];
      if (!p) return;
      
      // Extract vendor from product data if available
      const vendor = p.vendor || '';
      const vendorHtml = vendor ? `<div class="shop-product-vendor"><a href="https://aesthetic.computer/@${vendor.replace('@', '')}" target="_blank">${vendor.startsWith('@') ? vendor : '@' + vendor}</a></div>` : '';
      
      container.innerHTML = `
        <a href="${p.shopUrl}" class="shop-product" target="_blank">
          <div class="shop-product-img-wrap">
            <img src="${p.imageUrl || ''}" alt="${p.title}" loading="lazy">
          </div>
          <div class="shop-product-overlay">
            <div class="shop-product-top">
              <div class="shop-product-title">${p.title}</div>
              ${vendorHtml}
            </div>
            <div class="shop-product-info">
              ${p.available 
                ? `<div class="shop-product-price">${p.price}</div>`
                : `<div class="shop-product-sold">SOLD</div>`
              }
            </div>
          </div>
        </a>
      `;
    }
    loadShopProducts();

    // Determine API base URL (relative for local dev, absolute for production)
    const apiBase = window.location.hostname === 'localhost' || window.location.hostname.includes('local.')
      ? '' // Use relative URLs in dev
      : 'https://aesthetic.computer';

    // TV video feed - load and cycle through tape videos
    let tvTapes = [];
    let tvIndex = 0;
    let tvPlayer = null;
    let tvErrorCount = 0;
    const TV_MAX_ERRORS = 5; // Stop trying after too many consecutive errors
    
    async function loadTVFeed() {
      const container = document.getElementById('tvPlayer');
      try {
        const res = await fetch(`${apiBase}/api/tv?types=tape&limit=20&filter=recent`);
        const data = await res.json();
        
        // Get tapes from mixed array or media.tapes
        const tapes = data.mixed || data.media?.tapes || [];
        // Filter for tapes with completed MP4s (most reliable), then any with videoUrl
        tvTapes = tapes.filter(item => 
          item.media?.videoUrl && item.media?.mp4Status === "complete"
        );
        
        // Fallback to any tape with videoUrl if no complete MP4s
        if (!tvTapes.length) {
          tvTapes = tapes.filter(item => item.media?.videoUrl);
        }
        
        if (!tvTapes.length) {
          container.innerHTML = '<div class="tv-no-signal">No signal</div>';
          return;
        }
        
        playTVVideo(0);
      } catch (e) {
        console.error('TV load error:', e);
        container.innerHTML = '<div class="tv-no-signal">No signal</div>';
      }
    }
    
    function playTVVideo(index) {
      const container = document.getElementById('tvPlayer');
      const autoProgressBar = document.getElementById('tvAutoProgress');
      const tape = tvTapes[index];
      if (!tape) {
        container.innerHTML = '<div class="tv-no-signal">No signal</div>';
        return;
      }
      
      // Show tape code if available
      const tapeCode = tape.code ? `!${tape.code}` : '';
      
      container.innerHTML = `
        <video 
          src="${tape.media.videoUrl}" 
          muted 
          playsinline 
          autoplay
          loop="false"
        ></video>
        <div class="tv-progress"><div class="tv-progress-bar"></div></div>
        <div class="tv-info">
          <span>${tapeCode}</span>
          <span>${tvIndex + 1}/${tvTapes.length}</span>
        </div>
      `;
      
      tvPlayer = container.querySelector('video');
      const progressBar = container.querySelector('.tv-progress-bar');
      
      // Attach all event listeners once
      function attachListeners() {
        // Update both progress bars - playback and auto-advance
        tvPlayer.addEventListener('timeupdate', () => {
          if (tvPlayer.duration) {
            const pct = (tvPlayer.currentTime / tvPlayer.duration) * 100;
            progressBar.style.width = pct + '%';
            // Also update auto-advance bar
            if (autoProgressBar) autoProgressBar.style.width = pct + '%';
          }
        });
        
        tvPlayer.addEventListener('ended', () => {
          tvErrorCount = 0; // Reset error count on successful play
          tvIndex = (tvIndex + 1) % tvTapes.length;
          if (autoProgressBar) autoProgressBar.style.width = '0%';
          playTVVideo(tvIndex);
        });
        tvPlayer.addEventListener('canplay', () => {
          tvErrorCount = 0; // Reset error count when video loads successfully
        });
        tvPlayer.addEventListener('error', () => {
          tvErrorCount++;
          if (tvErrorCount >= TV_MAX_ERRORS) {
            container.innerHTML = '<div class="tv-no-signal">No signal</div>';
            return;
          }
          // Skip broken videos
          tvIndex = (tvIndex + 1) % tvTapes.length;
          if (autoProgressBar) autoProgressBar.style.width = '0%';
          setTimeout(() => playTVVideo(tvIndex), 500);
        });
      }
      
      attachListeners();
      
      tvPlayer.play().catch(() => {
        // Autoplay blocked - add click overlay (keep video and listeners intact)
        const overlay = document.createElement('div');
        overlay.className = 'tv-loading';
        overlay.style.cursor = 'pointer';
        overlay.textContent = '‚ñ∂Ô∏è';
        overlay.onclick = () => {
          tvPlayer.play();
          overlay.remove();
        };
        container.insertBefore(overlay, container.firstChild);
      });
    }
    loadTVFeed();
    
    // Linkify text - parse URLs, @handles, 'prompts', #paintings
    // Works on raw text, escapes only plain text segments
    function linkifyText(text) {
      // Parse elements with positions on RAW text (before escaping)
      const elements = [];
      
      // URLs (http://, https://, www.)
      const urlRegex = /(https?:\/\/[^\s<]+|www\.[^\s<]+)/gi;
      let match;
      while ((match = urlRegex.exec(text)) !== null) {
        elements.push({ type: 'url', text: match[0], start: match.index, end: match.index + match[0].length });
      }
      
      // @handles
      const handleRegex = /@[a-z0-9]+([._][a-z0-9]+)*/gi;
      while ((match = handleRegex.exec(text)) !== null) {
        // Don't match inside URLs
        const inUrl = elements.some(e => e.type === 'url' && match.index >= e.start && match.index < e.end);
        if (!inUrl) {
          elements.push({ type: 'handle', text: match[0], start: match.index, end: match.index + match[0].length });
        }
      }
      
      // 'prompts' (single-quoted words)
      const promptRegex = /'([^']+)'/g;
      while ((match = promptRegex.exec(text)) !== null) {
        const inUrl = elements.some(e => e.type === 'url' && match.index >= e.start && match.index < e.end);
        if (!inUrl) {
          elements.push({ type: 'prompt', text: match[0], inner: match[1], start: match.index, end: match.index + match[0].length });
        }
      }
      
      // #paintings (hashtag codes)
      const paintingRegex = /#[a-z0-9]+/gi;
      while ((match = paintingRegex.exec(text)) !== null) {
        const inUrl = elements.some(e => e.type === 'url' && match.index >= e.start && match.index < e.end);
        if (!inUrl) {
          elements.push({ type: 'painting', text: match[0], start: match.index, end: match.index + match[0].length });
        }
      }
      
      // Sort by position
      elements.sort((a, b) => a.start - b.start);
      
      // Build result string - escape plain text, but not the HTML links we create
      let result = '';
      let lastEnd = 0;
      
      for (const el of elements) {
        // Add escaped text before this element
        result += escapeHtml(text.slice(lastEnd, el.start));
        
        // Add linked element (escape the display text)
        if (el.type === 'url') {
          const href = el.text.startsWith('www.') ? 'https://' + el.text : el.text;
          result += `<a href="${escapeHtml(href)}" class="chat-link-url" target="_blank" rel="noopener">${escapeHtml(el.text)}</a>`;
        } else if (el.type === 'handle') {
          result += `<a href="https://aesthetic.computer/${escapeHtml(el.text)}" class="chat-link-handle" target="_blank">${escapeHtml(el.text)}</a>`;
        } else if (el.type === 'prompt') {
          result += `<a href="https://aesthetic.computer/${escapeHtml(el.inner)}" class="chat-link-prompt" target="_blank">${escapeHtml(el.text)}</a>`;
        } else if (el.type === 'painting') {
          const code = el.text.slice(1); // Remove #
          result += `<a href="https://aesthetic.computer/painting~${escapeHtml(code)}" class="chat-link-painting" target="_blank">${escapeHtml(el.text)}</a>`;
        }
        
        lastEnd = el.end;
      }
      
      // Add remaining escaped text
      result += escapeHtml(text.slice(lastEnd));
      
      return result;
    }
    
    // Extract painting codes from text and generate thumbnail HTML
    function getPaintingThumbnails(text) {
      const codes = [];
      const paintingRegex = /#([a-z0-9]+)/gi;
      let match;
      while ((match = paintingRegex.exec(text)) !== null) {
        codes.push(match[1]);
      }
      if (!codes.length) return '';
      
      const thumbs = codes.map(code => `
        <div class="chat-painting-thumb">
          <a href="https://aesthetic.computer/painting~${escapeHtml(code)}" target="_blank">
            <img 
              src="https://art.aesthetic.computer/${escapeHtml(code)}.png" 
              alt="#${escapeHtml(code)}"
              loading="lazy"
              onload="this.classList.add('loaded')"
              onerror="this.parentElement.parentElement.style.display='none'"
            >
            <span class="thumb-code">#${escapeHtml(code)}</span>
          </a>
        </div>
      `).join('');
      
      return `<div class="chat-painting-thumbs">${thumbs}</div>`;
    }
    
    // Chat Messages - L√¶er-Klokken messages (scrolling list)
    async function loadChatMessages() {
      const container = document.getElementById('chatMessages');
      try {
        const res = await fetch(`${apiBase}/api/chat/messages?instance=clock&limit=25`);
        const data = await res.json();
        const messages = data.messages || [];
        
        if (!messages.length) {
          container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">No messages yet</div></div>';
          return;
        }
        
        // Messages come oldest-first from API, we want newest at top
        const html = messages.map(msg => {
          const when = new Date(msg.when);
          const ago = formatTimeAgo(when);
          // API returns 'from' field with '@' prefix if handle exists
          const handle = msg.from || 'anon';
          const thumbs = getPaintingThumbnails(msg.text || '');
          return `
            <div class="chat-msg">
              <div class="chat-msg-header">
                <a href="https://aesthetic.computer/${handle}" class="chat-handle">${handle}</a>
                <span class="chat-time">${ago}</span>
              </div>
              <div class="chat-text">${linkifyText(msg.text || '')}</div>
              ${thumbs}
            </div>
          `;
        }).reverse().join('');
        
        container.innerHTML = html;
        
      } catch (e) {
        console.error('Chat load error:', e);
        container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Could not load</div></div>';
      }
    }
    
    function formatTimeAgo(date) {
      const now = new Date();
      const diff = now - date;
      const mins = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (mins < 1) return 'just now';
      if (mins < 60) return `${mins}m ago`;
      if (hours < 24) return `${hours}h ago`;
      if (days < 7) return `${days}d ago`;
      return date.toLocaleDateString();
    }
    
    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    
    loadChatMessages();
    
    // Auto-scroll chat messages
    function autoScrollChat(containerId, speed = 0.5) {
      const container = document.getElementById(containerId);
      if (!container) return;
      
      let scrollPos = 0;
      let isPaused = false;
      
      // Pause on hover
      container.addEventListener('mouseenter', () => isPaused = true);
      container.addEventListener('mouseleave', () => isPaused = false);
      
      function scroll() {
        if (!isPaused && container.scrollHeight > container.clientHeight) {
          scrollPos += speed;
          // Reset to top when reaching bottom
          if (scrollPos >= container.scrollHeight - container.clientHeight) {
            scrollPos = 0;
          }
          container.scrollTop = scrollPos;
        }
        requestAnimationFrame(scroll);
      }
      requestAnimationFrame(scroll);
    }
    
    // Start auto-scroll for both chat containers at different speeds
    setTimeout(() => {
      autoScrollChat('chatMessages', 0.25);      // laer-klokken: slower
      autoScrollChat('chatSystemMessages', 0.35); // chat: slightly faster
    }, 2000); // Wait for content to load
    
    // Chat System Messages (back face of flip card)
    async function loadChatSystemMessages() {
      const container = document.getElementById('chatSystemMessages');
      if (!container) return;
      try {
        const res = await fetch(`${apiBase}/api/chat/messages?instance=system&limit=25`);
        const data = await res.json();
        const messages = data.messages || [];
        
        if (!messages.length) {
          container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">No messages yet</div></div>';
          return;
        }
        
        // Messages come oldest-first from API, we want newest at top
        const html = messages.map(msg => {
          const when = new Date(msg.when);
          const ago = formatTimeAgo(when);
          const handle = msg.from || 'anon';
          const thumbs = getPaintingThumbnails(msg.text || '');
          return `
            <div class="chat-msg">
              <div class="chat-msg-header">
                <a href="https://aesthetic.computer/${handle}" class="chat-handle">${handle}</a>
                <span class="chat-time">${ago}</span>
              </div>
              <div class="chat-text">${linkifyText(msg.text || '')}</div>
              ${thumbs}
            </div>
          `;
        }).reverse().join('');
        
        container.innerHTML = html;
        
      } catch (e) {
        console.error('Chat system load error:', e);
        container.innerHTML = '<div class="chat-msg"><div class="chat-text" style="color: var(--dim);">Could not load</div></div>';
      }
    }
    
    loadChatSystemMessages();
    
    // Flip card toggle function with direction support
    function toggleChatFlip(direction) {
      const card = document.getElementById('chatFlipCard');
      const container = document.querySelector('.chat-flip-container');
      if (card && container) {
        const isFlipped = card.classList.contains('flipped');
        // If direction specified, only flip if it makes sense
        if (direction === 'left' && isFlipped) {
          card.classList.remove('flipped');
          container.classList.remove('flipped');
          resetFlipProgress();
        } else if (direction === 'right' && !isFlipped) {
          card.classList.add('flipped');
          container.classList.add('flipped');
          resetFlipProgress();
        } else if (!direction) {
          card.classList.toggle('flipped');
          container.classList.toggle('flipped');
          resetFlipProgress();
        }
      }
    }
    // Expose to global scope for onclick
    window.toggleChatFlip = toggleChatFlip;
    
    // Hover tilt effect for swivel preview
    function setupHoverTilt() {
      const container = document.querySelector('.chat-flip-container');
      const card = document.getElementById('chatFlipCard');
      if (!container || !card) return;
      
      container.addEventListener('mousemove', (e) => {
        if (card.classList.contains('flipped')) return; // Don't tilt when flipped
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const width = rect.width;
        const third = width / 3;
        
        card.classList.remove('tilt-left', 'tilt-right');
        if (x < third) {
          card.classList.add('tilt-left');
        } else if (x > third * 2) {
          card.classList.add('tilt-right');
        }
      });
      
      container.addEventListener('mouseleave', () => {
        card.classList.remove('tilt-left', 'tilt-right');
      });
      
      // Click zones for directional swivel
      container.addEventListener('click', (e) => {
        // Don't trigger if clicking on a link or explicit trigger
        if (e.target.closest('a') || e.target.closest('.chat-flip-trigger')) return;
        
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const width = rect.width;
        const isFlipped = card.classList.contains('flipped');
        
        if (x < width / 2) {
          // Left side - swivel to show front (unflip)
          if (isFlipped) toggleChatFlip('left');
        } else {
          // Right side - swivel to show back (flip)
          if (!isFlipped) toggleChatFlip('right');
        }
      });
    }
    setTimeout(setupHoverTilt, 100);
    
    // Auto-flip with progress bar
    const FLIP_INTERVAL = 12000; // 12 seconds between flips
    let flipProgress = 0;
    let flipPaused = false;
    
    function resetFlipProgress() {
      flipProgress = 0;
      const bar = document.getElementById('chatFlipProgress');
      if (bar) bar.style.width = '0%';
    }
    
    function updateFlipProgress() {
      const bar = document.getElementById('chatFlipProgress');
      const container = document.querySelector('.chat-flip-container');
      
      // Pause on hover
      if (container && !container.dataset.hoverBound) {
        container.dataset.hoverBound = 'true';
        container.addEventListener('mouseenter', () => flipPaused = true);
        container.addEventListener('mouseleave', () => flipPaused = false);
      }
      
      if (!flipPaused) {
        flipProgress += 100 / (FLIP_INTERVAL / 100); // Update every 100ms
        if (bar) bar.style.width = flipProgress + '%';
        
        if (flipProgress >= 100) {
          toggleChatFlip();
          // resetFlipProgress is called inside toggleChatFlip
        }
      }
      
      setTimeout(updateFlipProgress, 100);
    }
    
    // Start auto-flip after a short delay
    setTimeout(updateFlipProgress, 3000);
    
    // KidLisp Carousel - Single rotating preview with animated WebP and syntax highlighting
    const OVEN_URL = 'https://oven.aesthetic.computer';
    
    async function loadKidlispCarousel() {
      const carousel = document.getElementById('kidlispCarousel');
      try {
        // Fetch top hits from the TV API
        const res = await fetch(`${apiBase}/api/tv?types=kidlisp&sort=hits&limit=8`);
        const data = await res.json();
        const hits = data.media?.kidlisp || data.mixed || [];
        
        if (!hits.length) {
          carousel.innerHTML = '<div style="text-align: center; color: #555; padding: 2em;">No pieces found</div>';
          return;
        }
        
        // KidLisp syntax highlighter - matches kidlisp.com/index.html
        function highlightKidlisp(code) {
          if (!code) return '';
          // Escape HTML first
          let html = code
            .replace(/&/g, '&amp;')
            .replace(/</g, '&lt;')
            .replace(/>/g, '&gt;');
          
          // Use token placeholders to prevent double-replacement
          const tokens = [];
          function token(match, cls) {
            const idx = tokens.length;
            tokens.push(`<span class="${cls}">${match}</span>`);
            return `\x00${idx}\x00`;
          }
          
          // Order matters - most specific first
          // Comments (lines starting with ;)
          html = html.replace(/(^|\n)(;[^\n]*)/g, (m, pre, comment) => pre + token(comment, 'hl-comment'));
          // Timing patterns like 1s, 0.5s, 2s..., 1s! etc - MUST come before numbers
          html = html.replace(/(\d+\.?\d*s\.{0,3}!?)/g, m => token(m, 'hl-timing hl-timing-active'));
          // Strings
          html = html.replace(/("[^"]*")/g, m => token(m, 'hl-string'));
          // Numbers (now safe since timing already tokenized)
          html = html.replace(/\b(\d+\.?\d*)\b/g, m => token(m, 'hl-number'));
          // Keywords (control flow)
          const keywords = ['def', 'fn', 'if', 'cond', 'let', 'loop', 'repeat', 'later', 'tap', 'drag', 'lift', 'key', 'draw', 'frame', 'now', 'once'];
          keywords.forEach(kw => {
            html = html.replace(new RegExp(`\\b(${kw})\\b`, 'g'), m => token(m, 'hl-keyword'));
          });
          // API calls (drawing/commands)
          const apiCalls = ['wipe', 'ink', 'line', 'box', 'circle', 'text', 'pan', 'zoom', 'blur', 'noise', 'width', 'height', 'rainbow', 'wiggle', 'grid', 'plot', 'stamp', 'scroll', 'contrast', 'fps'];
          apiCalls.forEach(api => {
            html = html.replace(new RegExp(`\\b(${api})\\b`, 'g'), m => token(m, 'hl-api'));
          });
          // Colors
          const colors = ['black', 'white', 'red', 'green', 'blue', 'yellow', 'cyan', 'magenta', 'orange', 'purple', 'pink', 'brown', 'gray', 'grey', 'lime'];
          colors.forEach(c => {
            html = html.replace(new RegExp(`\\b(${c})\\b`, 'g'), m => token(m, 'hl-color'));
          });
          // Parens
          html = html.replace(/([()])/g, m => token(m, 'hl-paren'));
          
          // Replace tokens back
          html = html.replace(/\x00(\d+)\x00/g, (_, idx) => tokens[parseInt(idx)]);
          return html;
        }
        
        // Create all slides (hidden initially)
        const slides = hits.slice(0, 8);
        let currentSlide = 0;
        let slideInterval = null;
        
        carousel.innerHTML = slides.map((item, i) => {
          const code = item.code || 'unknown';
          const hitCount = item.hits || 0;
          const source = item.source || '';
          const author = item.handle || item.author || '';
          const pieceUrl = `https://aesthetic.computer/$${code}`;
          
          // Truncate source to fit in preview (more generous for single view)
          const truncatedSource = source.length > 400 ? source.slice(0, 400) + '...' : source;
          const highlighted = highlightKidlisp(truncatedSource);
          
          const authorHtml = author && author !== 'anon' ? `<div class="kidlisp-slide-author">@${escapeHtml(author)}</div>` : '';
          
          return `
            <div class="kidlisp-slide${i === 0 ? ' active' : ''}" data-index="${i}" data-code="${escapeHtml(code)}" data-hits="${hitCount}">
              <a href="${pieceUrl}" target="_blank" title="Play $${escapeHtml(code)}">
                <div class="kidlisp-slide-loading"></div>
              </a>
              <div class="kidlisp-slide-code">${highlighted}</div>
              <div class="kidlisp-slide-qr-wrap">
                <div class="kidlisp-slide-label">$${escapeHtml(code)}</div>
                <div class="kidlisp-slide-qr" data-url="${pieceUrl}"></div>
              </div>
              <div class="kidlisp-slide-plays">‚ñ∂ ${hitCount.toLocaleString()}</div>
              ${authorHtml}
            </div>
          `;
        }).join('');
        
        // Advance to next slide
        function nextSlide() {
          const slideEls = carousel.querySelectorAll('.kidlisp-slide');
          if (slideEls.length <= 1) return;
          
          const current = slideEls[currentSlide];
          currentSlide = (currentSlide + 1) % slideEls.length;
          const next = slideEls[currentSlide];
          
          // Transition
          current.classList.remove('active');
          current.classList.add('exiting');
          next.classList.add('active');
          
          // Clean up exiting class after transition
          setTimeout(() => current.classList.remove('exiting'), 500);
          
          // Restart progress bar
          animateKidlispProgress();
        }
        
        // Progress bar animation
        const KIDLISP_INTERVAL = 6000;
        let kidlispProgressAnim = null;
        
        function animateKidlispProgress() {
          const progressBar = document.getElementById('kidlispAutoProgress');
          if (!progressBar) return;
          
          let startTime = null;
          
          function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = timestamp - startTime;
            const pct = Math.min((elapsed / KIDLISP_INTERVAL) * 100, 100);
            progressBar.style.width = pct + '%';
            
            if (elapsed < KIDLISP_INTERVAL) {
              kidlispProgressAnim = requestAnimationFrame(step);
            }
          }
          
          if (kidlispProgressAnim) cancelAnimationFrame(kidlispProgressAnim);
          progressBar.style.width = '0%';
          kidlispProgressAnim = requestAnimationFrame(step);
        }
        
        // Start initial progress animation
        animateKidlispProgress();
        
        // Start rotation every 6 seconds (match webp duration)
        slideInterval = setInterval(nextSlide, KIDLISP_INTERVAL);
        
        // Pause on hover
        carousel.addEventListener('mouseenter', () => {
          clearInterval(slideInterval);
          if (kidlispProgressAnim) cancelAnimationFrame(kidlispProgressAnim);
        });
        carousel.addEventListener('mouseleave', () => {
          animateKidlispProgress();
          slideInterval = setInterval(nextSlide, KIDLISP_INTERVAL);
        });
        
        // Load webp images for all slides (staggered to not overwhelm oven)
        const slideEls = carousel.querySelectorAll('.kidlisp-slide');
        for (let i = 0; i < slideEls.length; i++) {
          const slide = slideEls[i];
          const code = slide.dataset.code;
          // Stagger each request by 300ms
          if (i > 0) await new Promise(r => setTimeout(r, 300));
          
          const webpUrl = `${OVEN_URL}/grab/webp/400/300/$${code}?duration=6000&fps=10&quality=80`;
          const img = document.createElement('img');
          img.src = webpUrl;
          img.alt = code;
          img.loading = i === 0 ? 'eager' : 'lazy';
          img.onload = () => {
            img.classList.add('loaded');
            const loader = slide.querySelector('.kidlisp-slide-loading');
            if (loader) loader.remove();
          };
          img.onerror = () => {
            const link = slide.querySelector('a');
            if (link) link.innerHTML = '<div style="color:#444;font-size:0.8em;padding:2em;">‚ö†Ô∏è</div>';
          };
          
          const link = slide.querySelector('a');
          if (link) {
            link.innerHTML = '';
            link.appendChild(img);
          }
          
          // Generate QR code for this slide
          const qrContainer = slide.querySelector('.kidlisp-slide-qr');
          if (qrContainer && typeof qrcode !== 'undefined') {
            try {
              const qrUrl = `https://prompt.ac/$${code}`;
              const qrGen = qrcode(0, 'L');
              qrGen.addData(qrUrl);
              qrGen.make();
              // Use SVG for better rendering
              const svg = qrGen.createSvgTag(2, 0);
              qrContainer.innerHTML = svg;
              const svgEl = qrContainer.querySelector('svg');
              if (svgEl) {
                svgEl.style.display = 'block';
                svgEl.style.width = '32px';
                svgEl.style.height = '32px';
              }
            } catch (e) {
              console.error('QR generation error:', e);
            }
          }
        }
        
      } catch (e) {
        console.error('KidLisp carousel load error:', e);
        carousel.innerHTML = '<div style="text-align: center; color: #555; padding: 2em;">Could not load</div>';
      }
    }
    
    loadKidlispCarousel();
    
    // Desktop Release Info - Fetch from GitHub
    async function loadDesktopReleaseInfo() {
      try {
        const res = await fetch('https://api.github.com/repos/whistlegraph/aesthetic-computer/releases/latest');
        if (!res.ok) return;
        
        const release = await res.json();
        
        // Update version badge
        const versionEl = document.getElementById('desktopVersion');
        if (versionEl) versionEl.textContent = release.tag_name;
        
        // Find download counts and sizes for each platform
        const assets = release.assets || [];
        
        // Mac: .dmg (universal preferred)
        const macAsset = assets.find(a => a.name.includes('universal.dmg') && !a.name.includes('blockmap')) 
          || assets.find(a => a.name.endsWith('.dmg') && !a.name.includes('blockmap'));
        // Windows: .exe
        const winAsset = assets.find(a => a.name.endsWith('.exe') && !a.name.includes('blockmap'));
        // Linux: .AppImage
        const linuxAsset = assets.find(a => a.name.endsWith('.AppImage'));
        
        function formatSize(bytes) {
          const mb = bytes / (1024 * 1024);
          return `${mb.toFixed(0)} MB`;
        }
        
        if (macAsset) {
          const el = document.getElementById('macInfo');
          if (el) el.textContent = formatSize(macAsset.size);
        }
        if (winAsset) {
          const el = document.getElementById('winInfo');
          if (el) el.textContent = formatSize(winAsset.size);
        }
        if (linuxAsset) {
          const el = document.getElementById('linuxInfo');
          if (el) el.textContent = formatSize(linuxAsset.size);
        }
        
        // Show release info
        const infoEl = document.getElementById('desktopReleaseInfo');
        if (infoEl && release.body) {
          infoEl.style.display = 'block';
          
          // Parse release name
          const nameEl = document.getElementById('releaseName');
          if (nameEl) nameEl.textContent = release.name || release.tag_name;
          
          // Format date
          const dateEl = document.getElementById('releaseDate');
          if (dateEl && release.published_at) {
            const date = new Date(release.published_at);
            dateEl.textContent = date.toLocaleDateString('en-US', { 
              year: 'numeric', month: 'short', day: 'numeric' 
            });
          }
          
          // Parse changelog - convert markdown to simple HTML
          const changelogEl = document.getElementById('releaseChangelog');
          if (changelogEl && release.body) {
            const body = release.body;
            // Simple markdown parsing
            let html = body
              .replace(/^## (.+)$/gm, '') // Remove headers
              .replace(/^### (.+)$/gm, '<strong>$1</strong>') // Subheaders to bold
              .replace(/^\- \*\*(.+?)\*\* ?[-‚Äì] ?(.+)$/gm, '<li><strong>$1</strong> ‚Äî $2</li>') // Bold items
              .replace(/^\- \*\*(.+?)\*\*(.*)$/gm, '<li><strong>$1</strong>$2</li>') // Bold only items
              .replace(/^\- (.+)$/gm, '<li>$1</li>') // List items
              .replace(/\n+/g, '\n')
              .trim();
            
            // Wrap in ul if has list items
            if (html.includes('<li>')) {
              html = '<ul>' + html + '</ul>';
            }
            changelogEl.innerHTML = html;
          }
        }
        
      } catch (e) {
        console.warn('Could not load release info:', e);
      }
    }
    
    loadDesktopReleaseInfo();
  </script>
  
  <!-- üîÑ Development live reload via session-server -->
  <script>
    (function() {
      // Only run in development (localhost)
      if (window.location.hostname !== 'localhost' && !window.location.hostname.includes('local.')) return;
      
      let sessionWs = null;
      let reconnectInterval = null;
      
      function connect() {
        if (sessionWs && sessionWs.readyState === WebSocket.OPEN) return;
        if (reconnectInterval) {
          clearInterval(reconnectInterval);
          reconnectInterval = null;
        }
        
        const connectionUrl = window.location.hostname.includes('local.') 
          ? 'wss://session.local.aesthetic.computer' 
          : 'wss://localhost:8889';
        
        console.log('üîÑ [give] Connecting to session server for live reload...');
        
        try {
          sessionWs = new WebSocket(connectionUrl);
        } catch (error) {
          console.warn('üîÑ [give] Connection failed:', error.message);
          scheduleReconnect();
          return;
        }

        sessionWs.onopen = () => {
          console.log('üîÑ [give] Connected to session server');
        };

        sessionWs.onmessage = (e) => {
          try {
            const msg = JSON.parse(e.data);
            if (msg.type === 'reload') {
              const piece = msg.content?.piece;
              if (piece === '*refresh*' || piece === 'give.aesthetic.computer' || piece?.includes('give')) {
                console.log('üîÑ [give] Reloading page...');
                setTimeout(() => window.location.reload(), 150);
              }
            }
          } catch (error) {
            // Ignore parse errors
          }
        };

        sessionWs.onerror = () => {
          console.warn('üîÑ [give] WebSocket error');
        };

        sessionWs.onclose = () => {
          console.log('üîÑ [give] Disconnected from session server');
          sessionWs = null;
          scheduleReconnect();
        };
      }
      
      function scheduleReconnect() {
        if (!reconnectInterval) {
          reconnectInterval = setInterval(connect, 3000);
        }
      }
      
      // Connect on load
      connect();
    })();
  </script>
</body>
</html>
