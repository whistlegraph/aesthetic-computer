<!DOCTYPE html>
<!-- KidLisp.com Web Bluetooth FF1 Pairing Prototype -->
<!-- Test page for pairing FF1 devices via Web Bluetooth API -->
<html>
<head>
  <meta charset="utf-8">
  <title>KidLisp Â· FF1 Bluetooth Pairing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: system-ui, -apple-system, sans-serif;
      background: #111;
      color: #fff;
      min-height: 100vh;
      padding: 2rem;
    }
    
    h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
      color: #8ff;
    }
    
    .subtitle {
      color: #888;
      margin-bottom: 2rem;
      font-size: 0.9rem;
    }
    
    .warning {
      background: #331;
      border: 1px solid #663;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 2rem;
      font-size: 0.85rem;
      color: #fc8;
    }
    
    .section {
      background: #1a1a1a;
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .section h2 {
      font-size: 1rem;
      color: #aaa;
      margin-bottom: 1rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    button {
      background: #333;
      color: #fff;
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.15s;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    button:hover:not(:disabled) {
      background: #444;
    }
    
    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    button.primary {
      background: #28a;
      color: #fff;
    }
    
    button.primary:hover:not(:disabled) {
      background: #39b;
    }
    
    button.success {
      background: #282;
    }
    
    button.danger {
      background: #822;
    }
    
    .status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 1rem;
      font-size: 0.9rem;
    }
    
    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #444;
    }
    
    .status-dot.connected { background: #4c4; }
    .status-dot.connecting { background: #cc4; animation: pulse 1s infinite; }
    .status-dot.error { background: #c44; }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
    
    #log {
      background: #0a0a0a;
      border-radius: 8px;
      padding: 1rem;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 0.8rem;
      line-height: 1.6;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }
    
    .log-entry {
      padding: 2px 0;
    }
    
    .log-info { color: #8cf; }
    .log-success { color: #8f8; }
    .log-error { color: #f88; }
    .log-data { color: #fc8; }
    
    input, select {
      background: #222;
      border: 1px solid #444;
      color: #fff;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      font-size: 0.9rem;
      width: 100%;
      margin-bottom: 0.75rem;
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #28a;
    }
    
    label {
      display: block;
      color: #888;
      font-size: 0.8rem;
      margin-bottom: 0.25rem;
    }
    
    .input-group {
      margin-bottom: 1rem;
    }
    
    .device-info {
      background: #0a0a0a;
      border-radius: 8px;
      padding: 1rem;
      font-size: 0.85rem;
    }
    
    .device-info div {
      display: flex;
      justify-content: space-between;
      padding: 0.25rem 0;
      border-bottom: 1px solid #222;
    }
    
    .device-info div:last-child {
      border-bottom: none;
    }
    
    .device-info .label { color: #888; }
    .device-info .value { color: #fff; font-family: monospace; }
    
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <h1>ğŸ”µ FF1 Bluetooth Pairing</h1>
  <p class="subtitle">Web Bluetooth API prototype for Feral File FF1 devices</p>
  
  <div class="warning">
    âš ï¸ <strong>Chrome/Edge only</strong> â€” Web Bluetooth is not supported in Safari or Firefox.
    Device must be in pairing mode (showing setup screen).
  </div>
  
  <!-- Connection Section -->
  <div class="section">
    <h2>1. Connect to FF1</h2>
    <button id="btn-scan" class="primary">ğŸ” Scan for FF1 Devices</button>
    <button id="btn-disconnect" disabled>Disconnect</button>
    
    <div class="status">
      <div class="status-dot" id="status-dot"></div>
      <span id="status-text">Not connected</span>
    </div>
    
    <div id="device-info" class="device-info hidden" style="margin-top: 1rem;">
      <div><span class="label">Device Name</span><span class="value" id="info-name">â€”</span></div>
      <div><span class="label">Device ID</span><span class="value" id="info-id">â€”</span></div>
      <div><span class="label">Service UUID</span><span class="value" id="info-service">â€”</span></div>
    </div>
  </div>
  
  <!-- WiFi Configuration Section -->
  <div class="section" id="wifi-section">
    <h2>2. Configure WiFi</h2>
    <div class="input-group">
      <label for="wifi-ssid">WiFi Network (SSID)</label>
      <input type="text" id="wifi-ssid" placeholder="Enter WiFi name">
    </div>
    <div class="input-group">
      <label for="wifi-password">Password</label>
      <input type="password" id="wifi-password" placeholder="Enter WiFi password">
    </div>
    <button id="btn-scan-wifi" disabled>ğŸ“¶ Scan Networks</button>
    <button id="btn-send-wifi" class="primary" disabled>Send WiFi Credentials</button>
  </div>
  
  <!-- Commands Section -->
  <div class="section" id="commands-section">
    <h2>3. Device Commands</h2>
    <button id="btn-get-info" disabled>ğŸ“Š Get Info</button>
    <button id="btn-keep-wifi" disabled>ğŸ”— Keep WiFi (Get TopicID)</button>
    <button id="btn-set-time" disabled>ğŸ• Set Timezone</button>
  </div>
  
  <!-- Topic ID Result -->
  <div class="section hidden" id="topic-section">
    <h2>âœ… Pairing Complete</h2>
    <div class="device-info">
      <div><span class="label">Topic ID</span><span class="value" id="topic-id">â€”</span></div>
    </div>
    <p style="margin-top: 1rem; color: #888; font-size: 0.85rem;">
      Use this Topic ID with the HTTP casting API: 
      <code style="color: #fc8;">POST /api/cast?topicID={id}</code>
    </p>
  </div>
  
  <!-- Log Section -->
  <div class="section">
    <h2>Debug Log</h2>
    <div id="log"></div>
    <button id="btn-clear-log" style="margin-top: 0.75rem;">Clear Log</button>
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // FF1 Bluetooth Protocol Constants (from feralfile-app source)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const FF1_SERVICE_UUID = 'f7826da6-4fa2-4e98-8024-bc5b71e0893e';
    const FF1_CHAR_UUID = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';
    
    // Commands (from BluetoothCommand enum)
    const COMMANDS = {
      CONNECT_WIFI: 'connect_wifi',
      SCAN_WIFI: 'scan_wifi',
      KEEP_WIFI: 'keep_wifi',
      FACTORY_RESET: 'factory_reset',
      SEND_LOG: 'send_log',
      SET_TIME: 'set_time',
      GET_INFO: 'get_info'
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // State
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let device = null;
    let server = null;
    let service = null;
    let characteristic = null;
    let pendingCallbacks = new Map(); // replyId -> callback
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI Elements
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const $ = id => document.getElementById(id);
    const btnScan = $('btn-scan');
    const btnDisconnect = $('btn-disconnect');
    const btnScanWifi = $('btn-scan-wifi');
    const btnSendWifi = $('btn-send-wifi');
    const btnGetInfo = $('btn-get-info');
    const btnKeepWifi = $('btn-keep-wifi');
    const btnSetTime = $('btn-set-time');
    const btnClearLog = $('btn-clear-log');
    const statusDot = $('status-dot');
    const statusText = $('status-text');
    const logDiv = $('log');
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Logging
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function log(msg, type = 'info') {
      const time = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = `log-entry log-${type}`;
      entry.textContent = `[${time}] ${msg}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[${type}] ${msg}`);
    }
    
    btnClearLog.onclick = () => logDiv.innerHTML = '';
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Protocol Encoder (matches Flutter app's _buildCommandMessage)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // Write a varint (protobuf-style variable-length integer)
    function writeVarint(value) {
      const bytes = [];
      while (value > 0x7f) {
        bytes.push((value & 0x7f) | 0x80);
        value >>>= 7;
      }
      bytes.push(value & 0x7f);
      return bytes;
    }
    
    // Generate random 4-char reply ID (a-z)
    function generateReplyId() {
      const chars = 'abcdefghijklmnopqrstuvwxyz';
      return Array.from({ length: 4 }, () => 
        chars[Math.floor(Math.random() * chars.length)]
      ).join('');
    }
    
    // Build command message matching Flutter protocol
    function buildCommand(command, params = {}) {
      const encoder = new TextEncoder();
      const bytes = [];
      
      // 1. Command name (length-prefixed)
      const cmdBytes = encoder.encode(command);
      bytes.push(...writeVarint(cmdBytes.length), ...cmdBytes);
      
      // 2. Reply ID (length-prefixed)
      const replyId = generateReplyId();
      const replyBytes = encoder.encode(replyId);
      bytes.push(...writeVarint(replyBytes.length), ...replyBytes);
      
      // 3. Parameters (each length-prefixed)
      for (const [key, value] of Object.entries(params)) {
        const valBytes = encoder.encode(String(value));
        bytes.push(...writeVarint(valBytes.length), ...valBytes);
      }
      
      log(`Built command: ${command} [replyId: ${replyId}]`, 'data');
      return { bytes: new Uint8Array(bytes), replyId };
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Protocol Decoder (parse notification responses)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function readVarint(data, offset) {
      let value = 0;
      let shift = 0;
      let pos = offset;
      while (pos < data.length) {
        const byte = data[pos++];
        value |= (byte & 0x7f) << shift;
        if ((byte & 0x80) === 0) break;
        shift += 7;
      }
      return { value, nextOffset: pos };
    }
    
    function parseResponse(data) {
      const decoder = new TextDecoder();
      const fields = [];
      let offset = 0;
      
      while (offset < data.length) {
        const { value: len, nextOffset } = readVarint(data, offset);
        offset = nextOffset;
        if (offset + len > data.length) break;
        fields.push(decoder.decode(data.slice(offset, offset + len)));
        offset += len;
      }
      
      // Fields: [replyId, errorCode, ...data]
      return {
        replyId: fields[0],
        errorCode: parseInt(fields[1]) || 0,
        data: fields.slice(2)
      };
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Connection Management
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function updateStatus(state, text) {
      statusDot.className = 'status-dot ' + state;
      statusText.textContent = text;
      
      const connected = state === 'connected';
      btnDisconnect.disabled = !connected;
      btnScanWifi.disabled = !connected;
      btnSendWifi.disabled = !connected;
      btnGetInfo.disabled = !connected;
      btnKeepWifi.disabled = !connected;
      btnSetTime.disabled = !connected;
      
      if (connected) {
        $('device-info').classList.remove('hidden');
      }
    }
    
    async function scanAndConnect() {
      try {
        log('Requesting Bluetooth device...', 'info');
        updateStatus('connecting', 'Scanning...');
        
        // Request device with FF1 service filter
        device = await navigator.bluetooth.requestDevice({
          filters: [{ services: [FF1_SERVICE_UUID] }],
          optionalServices: [FF1_SERVICE_UUID]
        });
        
        log(`Found device: ${device.name || 'Unknown'} (${device.id})`, 'success');
        $('info-name').textContent = device.name || 'Unknown';
        $('info-id').textContent = device.id.substring(0, 20) + '...';
        
        // Handle disconnection
        device.addEventListener('gattserverdisconnected', () => {
          log('Device disconnected', 'error');
          updateStatus('', 'Disconnected');
          device = null;
          server = null;
          service = null;
          characteristic = null;
        });
        
        // Connect to GATT server
        log('Connecting to GATT server...', 'info');
        updateStatus('connecting', 'Connecting...');
        server = await device.gatt.connect();
        
        // Get service
        log(`Getting service ${FF1_SERVICE_UUID}...`, 'info');
        service = await server.getPrimaryService(FF1_SERVICE_UUID);
        $('info-service').textContent = FF1_SERVICE_UUID.substring(0, 8) + '...';
        
        // Get characteristic
        log(`Getting characteristic ${FF1_CHAR_UUID}...`, 'info');
        characteristic = await service.getCharacteristic(FF1_CHAR_UUID);
        
        // Start notifications for responses
        log('Starting notifications...', 'info');
        await characteristic.startNotifications();
        characteristic.addEventListener('characteristicvaluechanged', handleNotification);
        
        log('âœ… Connected and ready!', 'success');
        updateStatus('connected', `Connected: ${device.name || device.id}`);
        
      } catch (err) {
        log(`Error: ${err.message}`, 'error');
        updateStatus('error', 'Connection failed');
        console.error(err);
      }
    }
    
    async function disconnect() {
      if (device?.gatt?.connected) {
        device.gatt.disconnect();
        log('Disconnected', 'info');
      }
      updateStatus('', 'Not connected');
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Notification Handler
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function handleNotification(event) {
      const data = new Uint8Array(event.target.value.buffer);
      log(`ğŸ“¨ Received ${data.length} bytes`, 'data');
      
      try {
        const response = parseResponse(data);
        log(`Response: replyId=${response.replyId}, error=${response.errorCode}, data=[${response.data.join(', ')}]`, 'data');
        
        // Call pending callback if exists
        const callback = pendingCallbacks.get(response.replyId);
        if (callback) {
          pendingCallbacks.delete(response.replyId);
          callback(response);
        }
      } catch (err) {
        log(`Parse error: ${err.message}`, 'error');
        log(`Raw data: ${Array.from(data).map(b => b.toString(16).padStart(2, '0')).join(' ')}`, 'data');
      }
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Command Senders
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function sendCommand(command, params = {}, timeout = 10000) {
      if (!characteristic) {
        log('Not connected!', 'error');
        return null;
      }
      
      const { bytes, replyId } = buildCommand(command, params);
      
      return new Promise(async (resolve, reject) => {
        // Set up response callback
        const timer = setTimeout(() => {
          pendingCallbacks.delete(replyId);
          log(`Timeout waiting for response (${command})`, 'error');
          resolve(null);
        }, timeout);
        
        pendingCallbacks.set(replyId, (response) => {
          clearTimeout(timer);
          if (response.errorCode !== 0) {
            log(`Command error: ${response.errorCode}`, 'error');
          }
          resolve(response);
        });
        
        // Send command
        try {
          log(`ğŸ“¤ Sending ${command} (${bytes.length} bytes)...`, 'info');
          await characteristic.writeValue(bytes);
          log(`Sent ${command}`, 'success');
        } catch (err) {
          clearTimeout(timer);
          pendingCallbacks.delete(replyId);
          log(`Write error: ${err.message}`, 'error');
          resolve(null);
        }
      });
    }
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Button Handlers
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    btnScan.onclick = scanAndConnect;
    btnDisconnect.onclick = disconnect;
    
    btnScanWifi.onclick = async () => {
      log('Scanning for WiFi networks...', 'info');
      const response = await sendCommand(COMMANDS.SCAN_WIFI);
      if (response?.data) {
        log(`Found networks: ${response.data.join(', ')}`, 'success');
        // Could populate a dropdown here
      }
    };
    
    btnSendWifi.onclick = async () => {
      const ssid = $('wifi-ssid').value.trim();
      const password = $('wifi-password').value;
      
      if (!ssid) {
        log('Please enter WiFi SSID', 'error');
        return;
      }
      
      log(`Sending WiFi credentials for "${ssid}"...`, 'info');
      const response = await sendCommand(COMMANDS.CONNECT_WIFI, {
        ssid,
        password
      }, 30000); // 30s timeout for WiFi connection
      
      if (response?.data?.[0]) {
        const topicId = response.data[0];
        log(`âœ… WiFi connected! TopicID: ${topicId}`, 'success');
        $('topic-id').textContent = topicId;
        $('topic-section').classList.remove('hidden');
      }
    };
    
    btnGetInfo.onclick = async () => {
      log('Getting device info...', 'info');
      const response = await sendCommand(COMMANDS.GET_INFO);
      if (response?.data) {
        log(`Device info: ${JSON.stringify(response.data)}`, 'success');
      }
    };
    
    btnKeepWifi.onclick = async () => {
      log('Requesting TopicID (keep_wifi)...', 'info');
      const response = await sendCommand(COMMANDS.KEEP_WIFI);
      if (response?.data?.[0]) {
        const topicId = response.data[0];
        log(`âœ… TopicID: ${topicId}`, 'success');
        $('topic-id').textContent = topicId;
        $('topic-section').classList.remove('hidden');
      }
    };
    
    btnSetTime.onclick = async () => {
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const time = new Date().toISOString().replace('T', ' ').substring(0, 19);
      log(`Setting timezone: ${timezone}, time: ${time}`, 'info');
      await sendCommand(COMMANDS.SET_TIME, { timezone, time }, 5000);
    };
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Check Web Bluetooth Support
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    if (!navigator.bluetooth) {
      log('âŒ Web Bluetooth is NOT supported in this browser!', 'error');
      btnScan.disabled = true;
      btnScan.textContent = 'âŒ Not Supported';
    } else {
      log('âœ… Web Bluetooth is supported', 'success');
    }
  </script>
</body>
</html>
