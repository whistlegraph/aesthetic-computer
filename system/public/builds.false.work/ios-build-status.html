<!DOCTYPE html>
<html>
<head>
  <title>iOS Build Status - SpiderLily | builds.false.work</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Courier New', monospace;
      background: #1a1a1a;
      color: #ccc;
      line-height: 1.7;
      padding: 2rem;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #242424;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 2rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.5);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #333;
    }
    header h1 {
      font-size: 1.3rem;
      color: #fff;
    }
    .platform-tag {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      margin-right: 0.5rem;
      background: #333;
      border: 1px solid #f0f;
      border-radius: 3px;
      font-size: 0.75rem;
      font-weight: bold;
      color: #f0f;
    }
    .back-link {
      color: #666;
      text-decoration: none;
      font-size: 0.9rem;
    }
    .back-link:hover {
      color: #fa0;
    }
    
    /* Status Banner */
    .status-banner {
      padding: 1rem 1.25rem;
      margin-bottom: 2rem;
      border-radius: 4px;
      font-weight: bold;
      font-size: 0.95rem;
    }
    .status-warning {
      background: linear-gradient(135deg, #2a2000 0%, #1a1500 100%);
      border-left: 4px solid #fa0;
      color: #fa0;
    }
    
    /* Sections */
    section {
      background: #2a2a2a;
      border: 1px solid #3a3a3a;
      border-radius: 4px;
      margin-bottom: 1.5rem;
    }
    section h2 {
      font-size: 1rem;
      padding: 0.85rem 1.25rem;
      background: #303030;
      border-bottom: 1px solid #3a3a3a;
      color: #fa0;
    }
    .content {
      padding: 1.25rem;
    }
    
    /* Meta Grid */
    .meta-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.75rem;
    }
    .meta-item {
      background: #222;
      padding: 0.6rem 0.85rem;
      border-radius: 3px;
      border-left: 2px solid #444;
    }
    .meta-label {
      color: #666;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .meta-value {
      color: #fff;
      font-size: 0.9rem;
    }
    
    /* Priority Fix Steps */
    .fix-step {
      background: #222;
      border: 1px solid #333;
      border-radius: 4px;
      margin-bottom: 1rem;
      overflow: hidden;
    }
    .fix-header {
      display: flex;
      align-items: center;
      padding: 0.85rem 1rem;
      background: #282828;
      border-bottom: 1px solid #333;
    }
    .fix-priority {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      font-weight: bold;
      font-size: 0.9rem;
      margin-right: 0.75rem;
      flex-shrink: 0;
    }
    .priority-1 { background: #500; color: #f88; border: 2px solid #f00; }
    .priority-2 { background: #530; color: #fa8; border: 2px solid #fa0; }
    .priority-3 { background: #550; color: #ff8; border: 2px solid #ff0; }
    .priority-4 { background: #353; color: #8f8; border: 2px solid #0f0; }
    
    .fix-title {
      color: #fff;
      font-weight: bold;
      font-size: 0.95rem;
    }
    .fix-severity {
      margin-left: auto;
      font-size: 0.7rem;
      text-transform: uppercase;
      padding: 0.2rem 0.5rem;
      border-radius: 3px;
      font-weight: bold;
    }
    .severity-critical { background: #400; color: #f66; }
    .severity-high { background: #430; color: #fa6; }
    .severity-medium { background: #440; color: #ff6; }
    .severity-low { background: #343; color: #6f6; }
    
    .fix-body {
      padding: 1rem;
    }
    .fix-body p {
      margin-bottom: 0.75rem;
      color: #aaa;
    }
    .fix-body h4 {
      color: #888;
      font-size: 0.8rem;
      text-transform: uppercase;
      margin: 1rem 0 0.5rem;
    }
    .fix-body h4:first-child {
      margin-top: 0;
    }
    
    /* Steps List */
    ol.steps {
      margin-left: 1.25rem;
      color: #bbb;
    }
    ol.steps li {
      margin-bottom: 0.5rem;
      padding-left: 0.25rem;
    }
    ol.steps li::marker {
      color: #fa0;
      font-weight: bold;
    }
    
    /* Code Blocks */
    pre {
      background: #1a1a1a;
      padding: 0.85rem 1rem;
      border-radius: 3px;
      overflow-x: auto;
      font-size: 0.8rem;
      line-height: 1.5;
      border: 1px solid #333;
      margin: 0.5rem 0;
    }
    code {
      color: #ddd;
    }
    .error { color: #f88; }
    .warning { color: #fa8; }
    .path { color: #8af; }
    .setting { color: #af8; }
    
    /* Checklist */
    ul.checklist {
      list-style: none;
    }
    ul.checklist li {
      padding: 0.35rem 0;
      padding-left: 1.75rem;
      position: relative;
    }
    ul.checklist li::before {
      position: absolute;
      left: 0;
      width: 1.25rem;
    }
    ul.checklist li.done::before { content: "‚úÖ"; }
    ul.checklist li.fail::before { content: "‚ùå"; }
    ul.checklist li.pending::before { content: "üîÑ"; }
    
    /* Two Column */
    .two-col {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.25rem;
    }
    @media (max-width: 600px) {
      .two-col { grid-template-columns: 1fr; }
      body { padding: 1rem; }
      .container { padding: 1rem; }
    }
    
    /* Commands */
    .cmd {
      background: #1a1a1a;
      padding: 0.75rem 1rem;
      margin: 0.5rem 0;
      border-radius: 3px;
      font-size: 0.8rem;
      border-left: 2px solid #fa0;
    }
    .cmd-label {
      color: #666;
      font-size: 0.7rem;
      margin-bottom: 0.25rem;
      text-transform: uppercase;
    }
    .cmd code {
      color: #fff;
    }
    
    /* Links */
    a {
      color: #fa0;
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 1.5rem;
      color: #555;
      font-size: 0.8rem;
      border-top: 1px solid #333;
      margin-top: 1rem;
    }
    
    /* Summary Box */
    .summary {
      background: #222;
      border: 1px solid #333;
      border-radius: 4px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }
    .summary-title {
      color: #fa0;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }
    .summary-text {
      color: #999;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><span class="platform-tag">üì± iOS</span> SpiderLily Build Status</h1>
      <a href="/" class="back-link">‚Üê Back to Builds</a>
    </header>

    <div class="status-banner status-warning">
      ‚ö†Ô∏è BUILD RUNS BUT DISPLAYS INCORRECTLY ‚Äî Post-process shaders failing to compile for iOS Metal
    </div>

    <div class="summary">
      <div class="summary-title">üìã Quick Summary</div>
      <div class="summary-text">
        The iOS build packages successfully and launches on device, but the screen appears broken (gray/incorrect rendering). 
        Root cause: Two post-process material shaders (M_FishHealth_PP, CelShadePP_Mat) are not compiling for Metal ES3.1, 
        causing the engine to use fallback materials. Follow the prioritized steps below to fix in Unreal Engine.
      </div>
    </div>

    <section>
      <h2>üìä Build Information</h2>
      <div class="content">
        <div class="meta-grid">
          <div class="meta-item">
            <div class="meta-label">Project</div>
            <div class="meta-value">SpiderLily</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Last Updated</div>
            <div class="meta-value">November 26, 2025</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Engine</div>
            <div class="meta-value">UE 5.6.1</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Build Config</div>
            <div class="meta-value">Development</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Bundle ID</div>
            <div class="meta-value">work.false.SpiderLily</div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Target</div>
            <div class="meta-value">iOS Device (ARM64)</div>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2>üîß Issues to Fix (Priority Order)</h2>
      <div class="content">
        
        <!-- Priority 1 -->
        <div class="fix-step">
          <div class="fix-header">
            <span class="fix-priority priority-1">1</span>
            <span class="fix-title">Fix Post-Process Material Shaders (M_FishHealth_PP)</span>
            <span class="fix-severity severity-critical">CRITICAL</span>
          </div>
          <div class="fix-body">
            <p>The M_FishHealth_PP material is failing to compile for Metal ES3.1. This is the player health overlay and is likely causing the broken display.</p>
            
            <h4>Error from Runtime Log</h4>
            <pre><code class="error">LogMaterial: Error: Loading a material resource with an invalid ShaderMap!
LogMaterial: Warning: Invalid shader map ID caching shaders for 'M_FishHealth_PP'
LogMaterial: Can't compile with cooked content, will use default material</code></pre>
            
            <h4>Steps in Unreal Engine</h4>
            <ol class="steps">
              <li>Open <code class="path">Content Browser ‚Üí LIB/Materials/PostProcess/M_FishHealth_PP</code></li>
              <li>In the Material Editor, check <code class="setting">Details ‚Üí Material ‚Üí Shader Model</code></li>
              <li>Ensure it's set to <code class="setting">SM5</code> or <code class="setting">Default</code> (NOT SM6)</li>
              <li>Check for any <strong>custom nodes</strong> using HLSL that isn't Metal-compatible</li>
              <li>Look for <strong>texture sampling</strong> that uses features not in ES3.1</li>
              <li>Right-click ‚Üí <code class="setting">Asset Actions ‚Üí Reload</code></li>
              <li>Save and recook for iOS</li>
            </ol>
            
            <h4>Quick Test (Disable to Confirm)</h4>
            <ol class="steps">
              <li>Open the Post Process Volume using M_FishHealth_PP</li>
              <li>Temporarily disable this material in the PP settings</li>
              <li>Recook and deploy to see if display works</li>
            </ol>
          </div>
        </div>

        <!-- Priority 2 -->
        <div class="fix-step">
          <div class="fix-header">
            <span class="fix-priority priority-1">2</span>
            <span class="fix-title">Fix Post-Process Material Shaders (CelShadePP_Mat)</span>
            <span class="fix-severity severity-critical">CRITICAL</span>
          </div>
          <div class="fix-body">
            <p>The cel-shading post-process material is also failing. This stylizes the entire game's rendering.</p>
            
            <h4>Error from Runtime Log</h4>
            <pre><code class="error">LogMaterial: Warning: Invalid shader map ID caching shaders for 'CelShadePP_Mat'
LogMaterial: Can't compile with cooked content, will use default material</code></pre>
            
            <h4>Steps in Unreal Engine</h4>
            <ol class="steps">
              <li>Open <code class="path">Content Browser ‚Üí (search) CelShadePP_Mat</code></li>
              <li>Check <code class="setting">Material Domain</code> is set to <code class="setting">Post Process</code></li>
              <li>Check <code class="setting">Blendable Location</code> ‚Äî try <code class="setting">Before Tonemapping</code></li>
              <li>Look for any Scene Texture nodes using unsupported buffers on iOS</li>
              <li>Verify no <strong>Custom HLSL expressions</strong> with desktop-only syntax</li>
              <li>Consider simplifying the shader for mobile (fewer texture lookups)</li>
              <li>Save and recook for iOS</li>
            </ol>
          </div>
        </div>

        <!-- Priority 3 -->
        <div class="fix-step">
          <div class="fix-header">
            <span class="fix-priority priority-2">3</span>
            <span class="fix-title">Verify iOS Shader Format is Enabled</span>
            <span class="fix-severity severity-high">HIGH</span>
          </div>
          <div class="fix-body">
            <p>Make sure the project is actually cooking shaders for iOS Metal.</p>
            
            <h4>Steps in Unreal Engine</h4>
            <ol class="steps">
              <li>Open <code class="setting">Edit ‚Üí Project Settings</code></li>
              <li>Go to <code class="path">Platforms ‚Üí iOS ‚Üí Rendering</code></li>
              <li>Ensure <code class="setting">Target iOS Hardware</code> includes your target devices</li>
              <li>Go to <code class="path">Project ‚Üí Packaging ‚Üí Shader Formats</code></li>
              <li>Verify <code class="setting">SF_METAL_SM5</code> or <code class="setting">METAL_ES3_1</code> is checked</li>
              <li>Go to <code class="path">Engine ‚Üí Rendering ‚Üí Mobile</code></li>
              <li>Check <code class="setting">Mobile Shaders</code> settings</li>
            </ol>
          </div>
        </div>

        <!-- Priority 4 -->
        <div class="fix-step">
          <div class="fix-header">
            <span class="fix-priority priority-3">4</span>
            <span class="fix-title">Fix FMOD Audio Bank Paths</span>
            <span class="fix-severity severity-medium">MEDIUM</span>
          </div>
          <div class="fix-body">
            <p>FMOD expects banks in a <code>Mobile/</code> subfolder, but iOS cooking flattens the structure.</p>
            
            <h4>Error from Runtime Log</h4>
            <pre><code class="error">LogFMOD: Error: Failed to open file '../../../SpiderLily/Content/FMOD/Mobile/Master.bank'
LogFMOD: Warning: Failed to load bank (File does not exist)</code></pre>
            
            <h4>Option A: Post-Build Script Fix</h4>
            <p>Add this after the iOS build completes:</p>
            <pre><code># Create the subfolder FMOD expects
FMOD_PATH="$APP_PATH/cookeddata/spiderlily/content/fmod"
mkdir -p "$FMOD_PATH/Desktop"
cp "$FMOD_PATH/master.bank" "$FMOD_PATH/Desktop/"
cp "$FMOD_PATH/master.strings.bank" "$FMOD_PATH/Desktop/"</code></pre>
            
            <h4>Option B: FMOD Config Fix</h4>
            <ol class="steps">
              <li>Open <code class="path">Project Settings ‚Üí Plugins ‚Üí FMOD Studio</code></li>
              <li>Set <code class="setting">Force Platform Name</code> to empty string</li>
              <li>Or set <code class="setting">Bank Output Directory</code> without subfolders</li>
            </ol>
          </div>
        </div>

        <!-- Priority 5 -->
        <div class="fix-step">
          <div class="fix-header">
            <span class="fix-priority priority-4">5</span>
            <span class="fix-title">Fix BP_Player Component Warning</span>
            <span class="fix-severity severity-low">LOW</span>
          </div>
          <div class="fix-body">
            <p>Blueprint trying to access an empty array at startup. Not blocking but should be fixed.</p>
            
            <h4>Warning from Runtime Log</h4>
            <pre><code class="warning">LogScript: Warning: Attempted to access index 0 from array of length 0
  in '/Game/LIB/Characters/Player/BP_Player.BP_Player_C'</code></pre>
            
            <h4>Steps in Unreal Engine</h4>
            <ol class="steps">
              <li>Open <code class="path">Content/LIB/Characters/Player/BP_Player</code></li>
              <li>Search the Event Graph for array access (Get node with index 0)</li>
              <li>Add an <code class="setting">Is Valid Index</code> or <code class="setting">Length > 0</code> check</li>
              <li>Or ensure the array is populated before access (check initialization order)</li>
            </ol>
          </div>
        </div>

      </div>
    </section>

    <section>
      <h2>‚úÖ Component Status</h2>
      <div class="content">
        <div class="two-col">
          <div>
            <h4 style="color:#8f8;margin-bottom:0.5rem;">‚úì Working</h4>
            <ul class="checklist">
              <li class="done">Code signing &amp; provisioning</li>
              <li class="done">App packaging (.app bundle)</li>
              <li class="done">Device installation</li>
              <li class="done">App launches successfully</li>
              <li class="done">Level loads (L_VerticalSlice_Demo)</li>
              <li class="done">Touch input detected</li>
              <li class="done">Device rotation</li>
              <li class="done">FMOD binaries linked (98MB)</li>
            </ul>
          </div>
          <div>
            <h4 style="color:#f88;margin-bottom:0.5rem;">‚úó Failing</h4>
            <ul class="checklist">
              <li class="fail">M_FishHealth_PP shader</li>
              <li class="fail">CelShadePP_Mat shader</li>
              <li class="fail">FMOD bank loading</li>
              <li class="pending">BP_Player array access</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2>üíª Deployment Commands</h2>
      <div class="content">
        <div class="cmd">
          <div class="cmd-label">Install to device:</div>
          <code>xcrun devicectl device install app --device 46720BDD-... ~/path/SpiderLily.app</code>
        </div>
        <div class="cmd">
          <div class="cmd-label">Launch app:</div>
          <code>xcrun devicectl device process launch --device 46720BDD-... work.false.SpiderLily</code>
        </div>
        <div class="cmd">
          <div class="cmd-label">Check FMOD files in package:</div>
          <code>ls -laR SpiderLily.app/cookeddata/spiderlily/content/fmod/</code>
        </div>
      </div>
    </section>

    <footer>
      <a href="https://false.work">false.work</a> ‚Ä¢ Updated November 26, 2025
    </footer>
  </div>
</body>
</html>
